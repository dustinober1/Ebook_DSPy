
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Extreme Multi-Label Classification: Scaling to Millions of Labels &#8212; DSPy: The Complete Guide</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/06_real_world_applications/08_extreme_multilabel_classification';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Long-form Article Generation with DSPy" href="08a_long_form_generation.html" />
    <link rel="prev" title="Perspective-Driven Research for Article Generation" href="07a_perspective_driven_research.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../00_frontmatter/00_preface.html">
  
  
  
  
  
  
    <p class="title logo__title">DSPy: The Complete Guide</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/01_how_to_use_this_book.html">How to Use This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/02_prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/03_setup_instructions.html">Setup Instructions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Fundamentals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01_fundamentals/00_chapter_intro.html">Chapter 1: DSPy Fundamentals</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/01_what_is_dspy.html">What is DSPy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/02_programming_vs_prompting.html">Programming vs. Prompting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/03_installation_setup.html">Installation and Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/04_first_dspy_program.html">Your First DSPy Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/05_language_models.html">Language Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/06_exercises.html">Chapter 1 Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Signatures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../02_signatures/00_chapter_intro.html">Chapter 2: Signatures</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/01_understanding_signatures.html">Understanding Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/02_signature_syntax.html">Signature Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/03_typed_signatures.html">Typed Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/04_advanced_signatures.html">Advanced Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/05_practical_examples.html">Practical Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/06_exercises.html">Chapter 2 Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Modules</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../03_modules/00_chapter_intro.html">Chapter 3: Modules</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/01_module_basics.html">Module Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/02_predict_module.html">The Predict Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/02a_typed_predictor.html">TypedPredictor: Type-Safe Language Model Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/03_chainofthought.html">Chain of Thought Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/04_react_agents.html">ReAct Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/05_custom_modules.html">Custom Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/06_composing_modules.html">Composing Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/07_exercises.html">Chapter 3 Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/08_assertions.html">Assertions Module</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 4 - Evaluation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_evaluation/00_chapter_intro.html">Chapter 4: Evaluation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/01_why_evaluation_matters.html">Why Evaluation Matters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/02_creating_datasets.html">Creating Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/03_defining_metrics.html">Defining Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/04_evaluation_loops.html">Evaluation Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/05_best_practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/06_exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/07_structured_prompting.html">Structured Prompting for Robust Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/08_llm_as_a_judge.html">LLM-as-a-Judge for Context-Sensitive Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/09_human_aligned_evaluation.html">Human-Aligned Evaluation: Capturing What Really Matters</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 5 - Optimizers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../05_optimizers/00_chapter_intro.html">Chapter 5: Optimizers &amp; Compilation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/01_compilation_concept.html">The Compilation Concept in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/02_bootstrapfewshot.html">BootstrapFewShot: Automatic Few-Shot Example Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/02a_copro.html">COPRO: Chain-of-Thought Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/03_mipro.html">MIPRO: Multi-step Instruction and Demonstration Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/04_knnfewshot.html">KNNFewShot: Similarity-Based Example Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/05_finetuning.html">Fine-Tuning Small Language Models in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/06_choosing_optimizers.html">Choosing Optimizers: Decision Guide and Trade-offs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/07_constraint_driven_optimization.html">Constraint-Driven Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/07_exercises.html">Chapter 5 Exercises: Optimizers &amp; Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/08_reflective_prompt_evolution.html">Reflective Prompt Evolution (RPE): Evolutionary Optimization Without Gradients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/09_copa_compiler_method.html">COPA: Compiler and Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/09a_copa_method.html">COPA: Combined Fine-Tuning and Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/10_joint_optimization.html">Joint Optimization: Fine-Tuning and Prompt Synergy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/11_monte_carlo_optimization.html">Monte Carlo Optimization in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/12_bayesian_optimization.html">Bayesian Optimization for Prompt Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/13_comprehensive_examples.html">Comprehensive Examples and Implementation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/14_multistage_optimization_theory.html">Multi-stage Optimization Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/15_instruction_tuning_frameworks.html">Instruction Tuning Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/16_demonstration_optimization.html">Demonstration Optimization Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/17_multistage_architectures.html">Multi-stage Program Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/18_complex_pipeline_optimization.html">Optimization Strategies for Complex Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/19_instruction_demonstration_interactions.html">Instruction and Demonstration Interaction Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/20_prompts_as_hyperparameters.html">Prompts as Auto-Optimized Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/21_minimal_data_pipelines.html">Minimal Data Training Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/22_gepa_genetic_pareto_optimization.html">GEPA: Genetic-Pareto Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/23_state_space_prompt_optimization.html">State-Space Search for Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/24_inpars_plus_synthetic_data_ir.html">InPars+: Advanced Synthetic Data Generation for Information Retrieval</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/25_custom_mipro_enhanced_optimization.html">CustomMIPROv2: Enhanced Multi-Stage Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/26_automatic_prompt_optimization_research.html">Automatic Prompt Optimization: When AI Outperforms Humans</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 6 - Real-World Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="00_chapter_intro.html">Chapter 6: Building Real-World Applications</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_rag_systems.html">RAG Systems: Building Intelligent Document Q&amp;A</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_multi_hop_search.html">Multi-hop Search: Complex Reasoning Across Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_classification_tasks.html">Classification Tasks: Building Robust Text Categorization Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_entity_extraction.html">Entity Extraction: Mining Structured Information from Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_intelligent_agents.html">Intelligent Agents: Building Autonomous Problem-Solving Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_code_generation.html">Code Generation: Building Automated Programming Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_exercises.html">Chapter 6 Exercises: Building Real-World Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="07a_perspective_driven_research.html">Perspective-Driven Research for Article Generation</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Extreme Multi-Label Classification: Scaling to Millions of Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="08a_long_form_generation.html">Long-form Article Generation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_outline_generation.html">Outline Generation for Structured Article Writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_extreme_few_shot_learning.html">Extreme Few-Shot Learning: Training with 10 Gold Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_ir_model_training_scratch.html">IR Model Training from Scratch: Methodology and Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_lingvarbench_healthcare_synthetic_data.html">LingVarBench: Synthetic Healthcare Transcript Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_scientific_figure_caption_generation.html">Scientific Figure Caption Generation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_retrieval_augmented_guardrails.html">Retrieval-Augmented Guardrails for AI Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_graphrag_wikipedia_tidb_tutorial.html">GraphRAG from Wikipedia: Building with DSPy, OpenAI, and TiDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_framework_comparisons_dspy_ecosystem.html">Framework Comparisons in the DSPy Ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="18_multi_agent_rag_systems.html">Multi-Agent RAG Systems with DSPy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 7 - Advanced Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../07_advanced_topics/00_chapter_intro.html">Chapter 7: Advanced Topics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/01_adapters_tools.html">Adapters and Tools: Extending DSPy Capabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/02_caching_performance.html">Caching and Performance: Building High-Performance DSPy Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/03_async_streaming.html">Async and Streaming: Building Real-Time DSPy Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/04_debugging_tracing.html">Debugging and Tracing: Mastering DSPy Application Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/05_deployment_strategies.html">Deployment Strategies: Taking DSPy Applications to Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/06_exercises.html">Chapter 7 Exercises: Advanced Topics Mastery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/07_self_refining_pipelines.html">Self-Refining Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/08_declarative_compilation.html">Declarative Language Model Compilation Techniques</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 8 - Case Studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../08_case_studies/00_introduction.html">Chapter 8: Case Studies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/01_enterprise_rag_system.html">Case Study 1: Building an Enterprise RAG System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/01a_healthcare_clinical_notes.html">Case Study 1: Clinical Notes Analysis with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/02_customer_support_chatbot.html">Case Study 2: Developing a Customer Support Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/03_ai_code_assistant.html">Case Study 3: Creating an AI-Powered Code Assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/04_automated_data_analysis.html">Case Study 4: Building an Automated Data Analysis Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/05_exercises.html">Chapter 8 Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/05a_storm_writing_assistant.html">Case Study 5: STORM - AI-Powered Writing Assistant for Wikipedia-like Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/06_assertion_driven_applications.html">Case Study: Assertion-Driven Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/07_databricks_jetblue_llm_optimization.html">Case Study 7: Databricks &amp; JetBlue LLM Pipeline Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/08_replit_code_repair_dspy.html">Case Study 8: Replit Code Repair with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/09_databricks_dspy_platform_integration.html">Case Study 9: Databricks Platform Integration with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/10_ddi_behavioral_simulation_automation.html">Case Study 10: DDI Behavioral Simulation Automation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/11_salomatic_medical_report_generation.html">Case Study 11: Salomatic Medical Report Generation with DSPy and Langtrace</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../09_appendices/00_introduction.html">Chapter 9: Appendices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/01_api_reference_quick.html">API Reference Quick Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/02_troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/03_resources.html">Additional Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/04_glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/05_community_resources.html">Community Resources and Perspectives</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/06_real_world_applications/08_extreme_multilabel_classification.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Extreme Multi-Label Classification: Scaling to Millions of Labels</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-xml-fundamentals-and-challenges">Understanding XML: Fundamentals and Challenges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-makes-xml-extreme">What Makes XML “Extreme”?</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scale-dimensions">Scale Dimensions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-xml-applications">Real-World XML Applications</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-xml-challenges">Core XML Challenges</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-complexity">1. Computational Complexity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sparsity">2. Data Sparsity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-constraints">3. Memory Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-complexity">4. Evaluation Complexity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#label-space-representation-and-indexing">Label Space Representation and Indexing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-label-representation">Efficient Label Representation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#label-embeddings">Label Embeddings</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-label-organization">Hierarchical Label Organization</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-label-structure">Tree-based Label Structure</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#label-clustering-for-scalability">Label Clustering for Scalability</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-label-clustering">Dynamic Label Clustering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dspy-xml-implementation">DSPy XML Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-xml-classifier-architecture">Core XML Classifier Architecture</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scalable-xml-classifier-with-dspy">Scalable XML Classifier with DSPy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-xml-capabilities">Zero-Shot XML Capabilities</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-label-prediction">Zero-Shot Label Prediction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xml-evaluation-metrics-and-methodologies">XML Evaluation Metrics and Methodologies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specialized-xml-metrics">Specialized XML Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-xml-evaluation-metrics">Implementation of XML Evaluation Metrics</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#propensity-scored-evaluation">Propensity Scored Evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-label-imbalance-in-evaluation">Handling Label Imbalance in Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-xml-techniques">Advanced XML Techniques</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-context-learning-for-xml">In-Context Learning for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-in-context-example-selection">Dynamic In-Context Example Selection</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learning-for-xml">Meta-Learning for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adaptation-to-new-domains">Adaptation to New Domains</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-techniques-for-xml">Optimization Techniques for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-training-strategies">Efficient Training Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bootstrap-optimization">Hierarchical Bootstrap Optimization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-efficient-inference">Memory-Efficient Inference</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#streaming-label-processing">Streaming Label Processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Real-World XML Applications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wikipedia-article-tagging-system">Wikipedia Article Tagging System</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="extreme-multi-label-classification-scaling-to-millions-of-labels">
<h1>Extreme Multi-Label Classification: Scaling to Millions of Labels<a class="headerlink" href="#extreme-multi-label-classification-scaling-to-millions-of-labels" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Extreme Multi-Label Classification (XML) represents one of the most challenging frontiers in machine learning and natural language processing. Unlike traditional multi-label classification where you might deal with tens or hundreds of labels, XML tasks involve thousands, millions, or even tens of millions of potential labels. This extreme scale introduces unique computational, statistical, and algorithmic challenges that require specialized approaches.</p>
<p>DSPy, with its modular architecture and optimization capabilities, provides powerful tools for tackling XML problems effectively. In this section, we’ll explore the fundamentals of XML, dive into specialized techniques for handling massive label spaces, and learn how to implement scalable XML solutions using DSPy.</p>
</section>
<section id="understanding-xml-fundamentals-and-challenges">
<h2>Understanding XML: Fundamentals and Challenges<a class="headerlink" href="#understanding-xml-fundamentals-and-challenges" title="Link to this heading">#</a></h2>
<section id="what-makes-xml-extreme">
<h3>What Makes XML “Extreme”?<a class="headerlink" href="#what-makes-xml-extreme" title="Link to this heading">#</a></h3>
<p>XML differs from traditional multi-label classification in several key dimensions:</p>
<section id="scale-dimensions">
<h4>Scale Dimensions<a class="headerlink" href="#scale-dimensions" title="Link to this heading">#</a></h4>
<ol class="arabic simple">
<li><p><strong>Label Cardinality</strong>: Number of labels per instance (typically 1-100)</p></li>
<li><p><strong>Label Space Size</strong>: Total number of unique labels (thousands to millions)</p></li>
<li><p><strong>Instance Features</strong>: High-dimensional input representations</p></li>
<li><p><strong>Data Volume</strong>: Massive training datasets</p></li>
</ol>
</section>
<section id="real-world-xml-applications">
<h4>Real-World XML Applications<a class="headerlink" href="#real-world-xml-applications" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><strong>E-commerce</strong>: Product categorization (millions of product categories)</p></li>
<li><p><strong>Content Tagging</strong>: Wikipedia article tagging (over 2 million categories)</p></li>
<li><p><strong>Advertising</strong>: Ad targeting with millions of keywords</p></li>
<li><p><strong>Document Classification</strong>: Legal documents with thousands of topics</p></li>
<li><p><strong>Bioinformatics</strong>: Gene function annotation with tens of thousands of GO terms</p></li>
</ul>
</section>
</section>
<section id="core-xml-challenges">
<h3>Core XML Challenges<a class="headerlink" href="#core-xml-challenges" title="Link to this heading">#</a></h3>
<section id="computational-complexity">
<h4>1. Computational Complexity<a class="headerlink" href="#computational-complexity" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Traditional approach complexity: O(|L|) per instance</span>
<span class="c1"># Where |L| is the number of labels (millions!)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NaiveXMLClassifier</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>  <span class="c1"># Could be millions!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">BinaryClassifier</span><span class="p">()</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="c1"># O(|L|) complexity - infeasible for XML</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifiers</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pred</span><span class="o">.</span><span class="n">confidence</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</section>
<section id="data-sparsity">
<h4>2. Data Sparsity<a class="headerlink" href="#data-sparsity" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Most label pairs co-occur rarely</p></li>
<li><p>Long-tail distribution of label frequencies</p></li>
<li><p>Few training examples for rare labels</p></li>
</ul>
</section>
<section id="memory-constraints">
<h4>3. Memory Constraints<a class="headerlink" href="#memory-constraints" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Storing millions of label embeddings</p></li>
<li><p>Maintaining classifier parameters for all labels</p></li>
<li><p>Caching predictions and intermediate results</p></li>
</ul>
</section>
<section id="evaluation-complexity">
<h4>4. Evaluation Complexity<a class="headerlink" href="#evaluation-complexity" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Computing precision&#64;k becomes expensive</p></li>
<li><p>Hierarchical evaluation requires tree traversal</p></li>
<li><p>Real-time inference constraints</p></li>
</ul>
</section>
</section>
</section>
<section id="label-space-representation-and-indexing">
<h2>Label Space Representation and Indexing<a class="headerlink" href="#label-space-representation-and-indexing" title="Link to this heading">#</a></h2>
<section id="efficient-label-representation">
<h3>Efficient Label Representation<a class="headerlink" href="#efficient-label-representation" title="Link to this heading">#</a></h3>
<section id="label-embeddings">
<h4>Label Embeddings<a class="headerlink" href="#label-embeddings" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="k">class</span><span class="w"> </span><span class="nc">XMLEmbeddingIndex</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">embedding_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">768</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an efficient embedding index for XML labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels: List of all possible labels</span>
<span class="sd">            embedding_dim: Dimension for label embeddings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_to_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span> <span class="o">=</span> <span class="n">embedding_dim</span>

        <span class="c1"># Initialize label embeddings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_embeddings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">embedding_dim</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Build search index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_search_index</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_search_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build efficient search structures for label lookup.&quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">faiss</span>  <span class="c1"># Facebook AI Similarity Search</span>

        <span class="c1"># Normalize embeddings for cosine similarity</span>
        <span class="n">norms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_embeddings</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalized_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_embeddings</span> <span class="o">/</span> <span class="p">(</span><span class="n">norms</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>

        <span class="c1"># Build FAISS index for fast similarity search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">faiss</span><span class="o">.</span><span class="n">IndexFlatIP</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalized_embeddings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search_similar_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                            <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find k most similar labels to query embedding.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_embedding: Query text embedding</span>
<span class="sd">            k: Number of similar labels to retrieve</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of (label, similarity_score) tuples</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize query embedding</span>
        <span class="n">query_norm</span> <span class="o">=</span> <span class="n">query_embedding</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-8</span><span class="p">)</span>
        <span class="n">query_norm</span> <span class="o">=</span> <span class="n">query_norm</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Search index</span>
        <span class="n">similarities</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query_norm</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># Convert to label-similarity pairs</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sim</span><span class="p">,</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">similarities</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># Valid index</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">sim</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update embedding for a specific label.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_to_id</span><span class="p">:</span>
            <span class="n">label_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_to_id</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_embeddings</span><span class="p">[</span><span class="n">label_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_embedding</span>
            <span class="c1"># Rebuild index periodically for efficiency</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># 1% chance to rebuild</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_search_index</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="hierarchical-label-organization">
<h3>Hierarchical Label Organization<a class="headerlink" href="#hierarchical-label-organization" title="Link to this heading">#</a></h3>
<section id="tree-based-label-structure">
<h4>Tree-based Label Structure<a class="headerlink" href="#tree-based-label-structure" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">XMLHierarchy</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hierarchy_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Organize labels in a hierarchical structure.</span>

<span class="sd">        Args:</span>
<span class="sd">            hierarchy_data: Nested dictionary representing label hierarchy</span>
<span class="sd">            Example: {</span>
<span class="sd">                &quot;Technology&quot;: {</span>
<span class="sd">                    &quot;AI&quot;: [&quot;Machine Learning&quot;, &quot;Deep Learning&quot;, &quot;NLP&quot;],</span>
<span class="sd">                    &quot;Web&quot;: [&quot;Frontend&quot;, &quot;Backend&quot;, &quot;DevOps&quot;]</span>
<span class="sd">                },</span>
<span class="sd">                &quot;Science&quot;: {</span>
<span class="sd">                    &quot;Physics&quot;: [&quot;Quantum&quot;, &quot;Classical&quot;, &quot;Particle&quot;],</span>
<span class="sd">                    &quot;Biology&quot;: [&quot;Molecular&quot;, &quot;Cellular&quot;, &quot;Ecological&quot;]</span>
<span class="sd">                }</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">hierarchy_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flattened_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flatten_hierarchy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_parent_map</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_depth_map</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_flatten_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all labels from hierarchical structure.&quot;&quot;&quot;</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">extract_labels</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">new_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">path</span> <span class="k">else</span> <span class="n">key</span>
                    <span class="n">extract_labels</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">new_path</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">extract_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_parent_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map each label to its parent category.&quot;&quot;&quot;</span>
        <span class="n">parent_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">build_map</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="n">parent_map</span><span class="p">[</span><span class="n">leaf</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">build_map</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
                        <span class="n">parent_map</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="n">build_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parent_map</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_depth_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate depth of each label in hierarchy.&quot;&quot;&quot;</span>
        <span class="n">depth_map</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">calculate_depth</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">current_depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="n">depth_map</span><span class="p">[</span><span class="n">leaf</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_depth</span> <span class="o">+</span> <span class="mi">2</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">calculate_depth</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">current_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">depth_map</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_depth</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">calculate_depth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depth_map</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_label_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get contextual labels including parents and siblings.&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Add parent</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
            <span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

            <span class="c1"># Add siblings (labels with same parent)</span>
            <span class="n">siblings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">l</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">parent</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">label</span>
            <span class="p">]</span>
            <span class="n">context</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">siblings</span><span class="p">[:</span><span class="n">context_size</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">context</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_path_to_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the complete path from label to root.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">while</span> <span class="n">current</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_map</span><span class="p">[</span><span class="n">current</span><span class="p">]</span>
            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">parent</span>

        <span class="k">return</span> <span class="n">path</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Reverse to get root-to-leaf path</span>
</pre></div>
</div>
</section>
</section>
<section id="label-clustering-for-scalability">
<h3>Label Clustering for Scalability<a class="headerlink" href="#label-clustering-for-scalability" title="Link to this heading">#</a></h3>
<section id="dynamic-label-clustering">
<h4>Dynamic Label Clustering<a class="headerlink" href="#dynamic-label-clustering" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_distances_argmin_min</span>

<span class="k">class</span><span class="w"> </span><span class="nc">XMLLabelClusterer</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cluster labels for efficient candidate selection.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_clusters: Number of label clusters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">n_clusters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_clusters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_representatives</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_embeddings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit clustering model on label embeddings.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_embeddings: Embedding matrix for all labels</span>
<span class="sd">            labels: List of label names</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Perform clustering</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">cluster_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">label_embeddings</span><span class="p">)</span>

        <span class="c1"># Organize labels by cluster</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">cluster_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_clusters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_clusters</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_clusters</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="c1"># Find cluster representatives (closest to centroid)</span>
        <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">):</span>
            <span class="n">cluster_mask</span> <span class="o">=</span> <span class="n">cluster_labels</span> <span class="o">==</span> <span class="n">cluster_id</span>
            <span class="n">cluster_embeddings</span> <span class="o">=</span> <span class="n">label_embeddings</span><span class="p">[</span><span class="n">cluster_mask</span><span class="p">]</span>
            <span class="n">cluster_labels_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">)[</span><span class="n">cluster_mask</span><span class="p">]</span>

            <span class="c1"># Find label closest to centroid</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_model</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span>
            <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cluster_embeddings</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">closest_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cluster_representatives</span><span class="p">[</span><span class="n">cluster_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">cluster_labels_list</span><span class="p">[</span><span class="n">closest_idx</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_candidate_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                             <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get most relevant clusters for a query.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_embedding: Query text embedding</span>
<span class="sd">            top_k: Number of clusters to retrieve</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of cluster IDs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find closest cluster centroids</span>
        <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">query_embedding</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">top_clusters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:</span><span class="n">top_k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">top_clusters</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cluster_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all labels in a specific cluster.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_clusters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="dspy-xml-implementation">
<h2>DSPy XML Implementation<a class="headerlink" href="#dspy-xml-implementation" title="Link to this heading">#</a></h2>
<section id="core-xml-classifier-architecture">
<h3>Core XML Classifier Architecture<a class="headerlink" href="#core-xml-classifier-architecture" title="Link to this heading">#</a></h3>
<section id="scalable-xml-classifier-with-dspy">
<h4>Scalable XML Classifier with DSPy<a class="headerlink" href="#scalable-xml-classifier-with-dspy" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">DSPyXMLClassifier</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extreme Multi-Label Classification system using DSPy.</span>

<span class="sd">    Features:</span>
<span class="sd">    - Efficient candidate label selection</span>
<span class="sd">    - Hierarchical prediction</span>
<span class="sd">    - Zero-shot and few-shot capabilities</span>
<span class="sd">    - Optimized inference pipeline</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">label_index</span><span class="p">:</span> <span class="n">XMLEmbeddingIndex</span><span class="p">,</span>
                 <span class="n">hierarchy</span><span class="p">:</span> <span class="n">XMLHierarchy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">clusterer</span><span class="p">:</span> <span class="n">XMLLabelClusterer</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">max_candidates</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
                 <span class="n">max_predictions</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize XML Classifier.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_index: Pre-built label embedding index</span>
<span class="sd">            hierarchy: Optional label hierarchy</span>
<span class="sd">            clusterer: Optional label clusterer</span>
<span class="sd">            max_candidates: Maximum candidate labels to consider</span>
<span class="sd">            max_predictions: Maximum predictions to return</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="o">=</span> <span class="n">label_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span> <span class="o">=</span> <span class="n">clusterer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_candidates</span> <span class="o">=</span> <span class="n">max_candidates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_predictions</span> <span class="o">=</span> <span class="n">max_predictions</span>

        <span class="c1"># DSPy modules for different prediction stages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_modules</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_initialize_modules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DSPy prediction modules.&quot;&quot;&quot;</span>

        <span class="c1"># Module for generating text embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_encoder</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;text -&gt; embedding&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Module for candidate selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">candidate_selector</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;text, candidate_labels -&gt; relevant_candidates, selection_reasoning&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Module for final classification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_classifier</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;text, candidate_labels, context -&gt; predictions, confidence_scores, reasoning&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Module for zero-shot classification</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zero_shot_classifier</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;text, label_description, examples -&gt; relevant, confidence&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform XML classification.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text to classify</span>
<span class="sd">            candidates: Optional pre-selected candidate labels</span>
<span class="sd">            context: Additional context information</span>

<span class="sd">        Returns:</span>
<span class="sd">            Prediction with labels, scores, and metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Generate text embedding</span>
        <span class="n">text_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_embedding</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Step 2: Select candidate labels</span>
        <span class="k">if</span> <span class="n">candidates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_candidates</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">text_embedding</span><span class="p">)</span>

        <span class="c1"># Step 3: Get contextual information</span>
        <span class="n">label_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_context</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>

        <span class="c1"># Step 4: Perform final classification</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_classify_with_candidates</span><span class="p">(</span>
            <span class="n">text</span><span class="p">,</span> <span class="n">candidates</span><span class="p">,</span> <span class="n">label_context</span>
        <span class="p">)</span>

        <span class="c1"># Step 5: Post-process and organize results</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_predictions</span><span class="p">(</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">text_embedding</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">],</span>
            <span class="n">confidence_scores</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;scores&quot;</span><span class="p">],</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">reasoning</span><span class="p">,</span>
            <span class="n">candidates_used</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span>
            <span class="n">context_used</span><span class="o">=</span><span class="n">label_context</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_text_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embedding for input text.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_encoder</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
        <span class="c1"># Convert string representation to numpy array</span>
        <span class="n">embedding_str</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">embedding</span>
        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_embedding</span><span class="p">(</span><span class="n">embedding_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embedding</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_select_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">text_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select relevant candidate labels efficiently.&quot;&quot;&quot;</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Method 1: Embedding-based similarity search</span>
        <span class="n">similar_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span><span class="o">.</span><span class="n">search_similar_labels</span><span class="p">(</span>
            <span class="n">text_embedding</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_candidates</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">candidates</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">similar_labels</span><span class="p">])</span>

        <span class="c1"># Method 2: Cluster-based selection (if available)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span><span class="p">:</span>
            <span class="n">relevant_clusters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span><span class="o">.</span><span class="n">get_candidate_clusters</span><span class="p">(</span>
                <span class="n">text_embedding</span><span class="p">,</span> <span class="n">top_k</span><span class="o">=</span><span class="mi">20</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">cluster_id</span> <span class="ow">in</span> <span class="n">relevant_clusters</span><span class="p">:</span>
                <span class="n">cluster_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clusterer</span><span class="o">.</span><span class="n">get_cluster_labels</span><span class="p">(</span><span class="n">cluster_id</span><span class="p">)</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cluster_labels</span><span class="p">[:</span><span class="mi">50</span><span class="p">])</span>  <span class="c1"># Limit per cluster</span>

        <span class="c1"># Method 3: Use DSPy for intelligent selection</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_candidates</span><span class="p">:</span>
            <span class="n">dspy_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidate_selector</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">candidate_labels</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Parse and add selected candidates</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_candidates</span><span class="p">(</span><span class="n">dspy_result</span><span class="o">.</span><span class="n">relevant_candidates</span><span class="p">)</span>
            <span class="n">candidates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span>

        <span class="c1"># Remove duplicates and limit</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">candidates</span><span class="p">))[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_candidates</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">candidates</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_label_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate contextual information for candidates.&quot;&quot;&quot;</span>
        <span class="n">context_parts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Hierarchical context</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">candidates</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>  <span class="c1"># Limit for efficiency</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">get_path_to_root</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="s1">&#39; &gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Co-occurrence patterns</span>
        <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total candidates: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">context_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample candidates: </span><span class="si">{</span><span class="n">candidates</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_parts</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_classify_with_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">candidates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                <span class="n">context</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Classify text using pre-selected candidates.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_classifier</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">candidate_labels</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_post_process_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">result</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">,</span>
                                 <span class="n">text_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post-process and organize predictions.&quot;&quot;&quot;</span>
        <span class="c1"># Parse predictions and scores</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_predictions</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">predictions</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_scores</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">confidence_scores</span><span class="p">)</span>

        <span class="c1"># Combine predictions with scores</span>
        <span class="n">labeled_scores</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">scores</span><span class="p">))</span>

        <span class="c1"># Sort by confidence and limit</span>
        <span class="n">labeled_scores</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">labeled_scores</span> <span class="o">=</span> <span class="n">labeled_scores</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_predictions</span><span class="p">]</span>

        <span class="c1"># Add hierarchical boost if available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="p">:</span>
            <span class="n">labeled_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_hierarchical_boost</span><span class="p">(</span>
                <span class="n">labeled_scores</span><span class="p">,</span> <span class="n">text_embedding</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">labeled_scores</span><span class="p">],</span>
            <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">score</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">labeled_scores</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">embedding_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse embedding from string representation.&quot;&quot;&quot;</span>
        <span class="c1"># Implementation depends on how embeddings are encoded</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">embedding_str</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Fallback: generate embedding using external method</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_fallback_embedding</span><span class="p">(</span><span class="n">embedding_str</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">candidates_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse candidate labels from string.&quot;&quot;&quot;</span>
        <span class="c1"># Simple parsing - can be made more sophisticated</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">candidates_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse predictions from string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scores_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse confidence scores from string.&quot;&quot;&quot;</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">scores_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_hierarchical_boost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">labeled_scores</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]],</span>
                                 <span class="n">text_embedding</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply hierarchical boosting to scores.&quot;&quot;&quot;</span>
        <span class="n">boosted_scores</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">labeled_scores</span><span class="p">:</span>
            <span class="n">boosted_score</span> <span class="o">=</span> <span class="n">score</span>

            <span class="c1"># Boost if similar to parent/children labels</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="ow">and</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">parent_map</span><span class="p">:</span>
                <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">parent_map</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="c1"># Check if parent is also predicted</span>
                <span class="k">for</span> <span class="n">other_label</span><span class="p">,</span> <span class="n">other_score</span> <span class="ow">in</span> <span class="n">labeled_scores</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">other_label</span> <span class="o">==</span> <span class="n">parent</span><span class="p">:</span>
                        <span class="n">boosted_score</span> <span class="o">*=</span> <span class="mf">1.2</span>  <span class="c1"># Boost parent-child combinations</span>
                        <span class="k">break</span>

            <span class="n">boosted_scores</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="p">,</span> <span class="n">boosted_score</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">boosted_scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_fallback_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate embedding using fallback method.&quot;&quot;&quot;</span>
        <span class="c1"># This would typically use a sentence transformer or similar</span>
        <span class="c1"># For now, return a random embedding</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span><span class="o">.</span><span class="n">embedding_dim</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="zero-shot-xml-capabilities">
<h3>Zero-Shot XML Capabilities<a class="headerlink" href="#zero-shot-xml-capabilities" title="Link to this heading">#</a></h3>
<section id="zero-shot-label-prediction">
<h4>Zero-Shot Label Prediction<a class="headerlink" href="#zero-shot-label-prediction" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ZeroShotXML</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Zero-shot XML classification for new/unseen labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_descriptions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with label descriptions.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_descriptions: Mapping of label names to descriptions</span>
<span class="sd">            Example: {</span>
<span class="sd">                &quot;Machine Learning&quot;: &quot;Algorithms that learn patterns from data&quot;,</span>
<span class="sd">                &quot;Quantum Computing&quot;: &quot;Computing using quantum mechanical phenomena&quot;</span>
<span class="sd">            }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_descriptions</span> <span class="o">=</span> <span class="n">label_descriptions</span>

        <span class="c1"># Initialize zero-shot modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description_matcher</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;text, label_description -&gt; relevance_score, explanation&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">few_shot_learner</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;text, examples, new_label -&gt; is_relevant, confidence&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">predict_new_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">label_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">label_description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">examples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Predict relevance for a new/unseen label.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text</span>
<span class="sd">            label_name: Name of the new label</span>
<span class="sd">            label_description: Optional description of the label</span>
<span class="sd">            examples: Optional few-shot examples</span>

<span class="sd">        Returns:</span>
<span class="sd">            Prediction with relevance score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">label_description</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_descriptions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label_name</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Method 1: Description-based matching</span>
        <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
            <span class="n">desc_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description_matcher</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">label_description</span><span class="o">=</span><span class="n">description</span>
            <span class="p">)</span>
            <span class="n">desc_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">desc_result</span><span class="o">.</span><span class="n">relevance_score</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desc_score</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Method 2: Few-shot learning (if examples provided)</span>
        <span class="k">if</span> <span class="n">examples</span><span class="p">:</span>
            <span class="n">examples_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="sa">f</span><span class="s2">&quot;Example </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">Relevant to </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">relevant</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">examples</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
            <span class="p">])</span>

            <span class="n">fs_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">few_shot_learner</span><span class="p">(</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">examples_text</span><span class="p">,</span>
                <span class="n">new_label</span><span class="o">=</span><span class="n">label_name</span>
            <span class="p">)</span>
            <span class="n">fs_score</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fs_result</span><span class="o">.</span><span class="n">confidence</span><span class="p">)</span> <span class="k">if</span> <span class="n">fs_result</span><span class="o">.</span><span class="n">is_relevant</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span> <span class="k">else</span> <span class="mf">0.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs_score</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Combine scores</span>
        <span class="n">final_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">desc_score</span><span class="p">,</span> <span class="n">fs_score</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label_name</span><span class="p">,</span>
            <span class="n">relevance_score</span><span class="o">=</span><span class="n">final_score</span><span class="p">,</span>
            <span class="n">description_based_score</span><span class="o">=</span><span class="n">desc_score</span><span class="p">,</span>
            <span class="n">few_shot_score</span><span class="o">=</span><span class="n">fs_score</span><span class="p">,</span>
            <span class="n">explanation</span><span class="o">=</span><span class="n">desc_result</span><span class="o">.</span><span class="n">explanation</span> <span class="k">if</span> <span class="n">description</span> <span class="k">else</span> <span class="s2">&quot;No description provided&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">batch_predict_new_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                               <span class="n">new_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Batch predict multiple new labels.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text</span>
<span class="sd">            new_labels: List of (label_name, description) tuples</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of predictions for each new label</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">label_name</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">new_labels</span><span class="p">:</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_new_label</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">label_name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>

        <span class="c1"># Sort by relevance score</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">relevance_score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predictions</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="xml-evaluation-metrics-and-methodologies">
<h2>XML Evaluation Metrics and Methodologies<a class="headerlink" href="#xml-evaluation-metrics-and-methodologies" title="Link to this heading">#</a></h2>
<section id="specialized-xml-metrics">
<h3>Specialized XML Metrics<a class="headerlink" href="#specialized-xml-metrics" title="Link to this heading">#</a></h3>
<section id="implementation-of-xml-evaluation-metrics">
<h4>Implementation of XML Evaluation Metrics<a class="headerlink" href="#implementation-of-xml-evaluation-metrics" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">XMLEvaluator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Comprehensive evaluation suite for Extreme Multi-Label Classification.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize evaluator.</span>

<span class="sd">        Args:</span>
<span class="sd">            k_values: Values of k for precision@k and nDCG@k</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_values</span> <span class="o">=</span> <span class="n">k_values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">precision_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                      <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Precision@k.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_labels: Set of ground truth labels</span>
<span class="sd">            predicted_labels: Ordered list of predicted labels</span>
<span class="sd">            k: Cut-off position</span>

<span class="sd">        Returns:</span>
<span class="sd">            Precision@k score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">top_k_predictions</span> <span class="o">=</span> <span class="n">predicted_labels</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
        <span class="n">relevant_in_top_k</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">top_k_predictions</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">true_labels</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">relevant_in_top_k</span> <span class="o">/</span> <span class="n">k</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recall_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                   <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                   <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Recall@k.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_labels: Set of ground truth labels</span>
<span class="sd">            predicted_labels: Ordered list of predicted labels</span>
<span class="sd">            k: Cut-off position</span>

<span class="sd">        Returns:</span>
<span class="sd">            Recall@k score</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">top_k_predictions</span> <span class="o">=</span> <span class="n">predicted_labels</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
        <span class="n">relevant_in_top_k</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">top_k_predictions</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">true_labels</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">relevant_in_top_k</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_labels</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">f1_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
               <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
               <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate F1@k score.&quot;&quot;&quot;</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall_at_k</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ndcg_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Normalized Discounted Cumulative Gain@k.</span>

<span class="sd">        For binary relevance (relevant = 1, irrelevant = 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">dcg_at_k</span><span class="p">(</span><span class="n">relevances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Calculate DCG@k.&quot;&quot;&quot;</span>
            <span class="n">dcg</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rel</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">relevances</span><span class="p">[:</span><span class="n">k</span><span class="p">]):</span>
                <span class="n">dcg</span> <span class="o">+=</span> <span class="n">rel</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># i+2 because log2(1) = 0</span>
            <span class="k">return</span> <span class="n">dcg</span>

        <span class="c1"># Calculate actual DCG</span>
        <span class="n">actual_relevances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">true_labels</span> <span class="k">else</span> <span class="mi">0</span>
                           <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">predicted_labels</span><span class="p">]</span>
        <span class="n">actual_dcg</span> <span class="o">=</span> <span class="n">dcg_at_k</span><span class="p">(</span><span class="n">actual_relevances</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="c1"># Calculate ideal DCG (perfect ordering)</span>
        <span class="n">ideal_relevances</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_labels</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span> <span class="o">+</span> \
                          <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_labels</span><span class="p">))</span>
        <span class="n">ideal_dcg</span> <span class="o">=</span> <span class="n">dcg_at_k</span><span class="p">(</span><span class="n">ideal_relevances</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ideal_dcg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">actual_dcg</span> <span class="o">/</span> <span class="n">ideal_dcg</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ps_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
               <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
               <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Propensity Scored Precision@k.</span>

<span class="sd">        Accounts for label frequency bias in evaluation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This would require label frequency statistics</span>
        <span class="c1"># Simplified implementation shown here</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                         <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate a single instance with all metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_labels: Ground truth labels</span>
<span class="sd">            predicted_labels: Predicted labels (ordered by confidence)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of metric scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_values</span><span class="p">:</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;precision@</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision_at_k</span><span class="p">(</span>
                <span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span>
            <span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;recall@</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recall_at_k</span><span class="p">(</span>
                <span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span>
            <span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;f1@</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f1_at_k</span><span class="p">(</span>
                <span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span>
            <span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ndcg@</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndcg_at_k</span><span class="p">(</span>
                <span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span>
            <span class="p">)</span>
            <span class="n">metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ps@</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps_at_k</span><span class="p">(</span>
                <span class="n">true_labels</span><span class="p">,</span> <span class="n">predicted_labels</span><span class="p">,</span> <span class="n">k</span>
            <span class="p">)</span>

        <span class="c1"># Add macro and micro averaged metrics for multiple instances</span>
        <span class="k">return</span> <span class="n">metrics</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">test_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Evaluate entire dataset.</span>

<span class="sd">        Args:</span>
<span class="sd">            test_data: List of instances with &#39;true_labels&#39; and &#39;predicted_labels&#39;</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of average metric scores</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_metrics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">test_data</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_instance</span><span class="p">(</span>
                <span class="n">instance</span><span class="p">[</span><span class="s1">&#39;true_labels&#39;</span><span class="p">],</span>
                <span class="n">instance</span><span class="p">[</span><span class="s1">&#39;predicted_labels&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">all_metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>

        <span class="c1"># Calculate averages</span>
        <span class="n">avg_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">]</span>
            <span class="n">avg_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;avg_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="n">avg_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;std_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avg_metrics</span>
</pre></div>
</div>
</section>
</section>
<section id="propensity-scored-evaluation">
<h3>Propensity Scored Evaluation<a class="headerlink" href="#propensity-scored-evaluation" title="Link to this heading">#</a></h3>
<section id="handling-label-imbalance-in-evaluation">
<h4>Handling Label Imbalance in Evaluation<a class="headerlink" href="#handling-label-imbalance-in-evaluation" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">PropensityScoredEvaluator</span><span class="p">(</span><span class="n">XMLEvaluator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluator with propensity scoring for imbalanced XML datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">label_frequencies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                 <span class="n">k_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with label frequency information.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_frequencies: Frequency of each label in training data</span>
<span class="sd">            k_values: Values of k for evaluation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">k_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_frequencies</span> <span class="o">=</span> <span class="n">label_frequencies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propensity_scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_propensity_scores</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_propensity_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate propensity scores for each label.</span>

<span class="sd">        Propensity score ~ (frequency + 1)^(-0.55) as per Jain et al. 2016</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_freq</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_frequencies</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">propensity_scores</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_frequencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Normalize frequency</span>
            <span class="n">norm_freq</span> <span class="o">=</span> <span class="n">freq</span> <span class="o">/</span> <span class="n">max_freq</span>
            <span class="c1"># Calculate propensity</span>
            <span class="n">propensity</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm_freq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.55</span><span class="p">)</span>
            <span class="n">propensity_scores</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">propensity</span>

        <span class="k">return</span> <span class="n">propensity_scores</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">inv_psr_at_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">true_labels</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                    <span class="n">predicted_labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                    <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate Inverse Propensity Scored Precision@k.</span>

<span class="sd">        Gives more weight to rare labels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="n">top_k_predictions</span> <span class="o">=</span> <span class="n">predicted_labels</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
        <span class="n">weighted_relevant</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">total_weight</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_k_predictions</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">true_labels</span><span class="p">:</span>
                <span class="c1"># Get inverse propensity score</span>
                <span class="n">inv_propensity</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">propensity_scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="n">weighted_relevant</span> <span class="o">+=</span> <span class="n">inv_propensity</span>

            <span class="n">total_weight</span> <span class="o">+=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">propensity_scores</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">total_weight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">weighted_relevant</span> <span class="o">/</span> <span class="n">total_weight</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="advanced-xml-techniques">
<h2>Advanced XML Techniques<a class="headerlink" href="#advanced-xml-techniques" title="Link to this heading">#</a></h2>
<section id="in-context-learning-for-xml">
<h3>In-Context Learning for XML<a class="headerlink" href="#in-context-learning-for-xml" title="Link to this heading">#</a></h3>
<section id="dynamic-in-context-example-selection">
<h4>Dynamic In-Context Example Selection<a class="headerlink" href="#dynamic-in-context-example-selection" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">XMLInContextLearner</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    In-context learning system specifically designed for XML tasks.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">example_database</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">],</span>
                 <span class="n">max_examples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                 <span class="n">similarity_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with example database.</span>

<span class="sd">        Args:</span>
<span class="sd">            example_database: Collection of labeled examples</span>
<span class="sd">            max_examples: Maximum examples to include in context</span>
<span class="sd">            similarity_threshold: Minimum similarity for example selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_database</span> <span class="o">=</span> <span class="n">example_database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_examples</span> <span class="o">=</span> <span class="n">max_examples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span> <span class="o">=</span> <span class="n">similarity_threshold</span>

        <span class="c1"># Initialize modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_selector</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;query_text, examples -&gt; selected_examples, selection_scores&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">context_learner</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;text, examples, label_space -&gt; predictions, confidence&quot;</span>
        <span class="p">)</span>

        <span class="c1"># Pre-compute example embeddings for efficient retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">example_embeddings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precompute_embeddings</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_precompute_embeddings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pre-compute embeddings for all examples.&quot;&quot;&quot;</span>
        <span class="n">embeddings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># In practice, use an efficient embedding model</span>
        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">example_database</span><span class="p">:</span>
            <span class="c1"># Simplified - would use actual embedding model</span>
            <span class="n">embeddings</span><span class="p">[</span><span class="n">ex</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">768</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">embeddings</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select_relevant_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select most relevant examples for the query.</span>

<span class="sd">        Uses multiple strategies:</span>
<span class="sd">        1. Label overlap</span>
<span class="sd">        2. Text similarity</span>
<span class="sd">        3. Label co-occurrence patterns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Strategy 1: Exact label matches</span>
        <span class="n">query_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_embedding</span><span class="p">(</span><span class="n">query_text</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">example_database</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_examples</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="c1"># Calculate similarity</span>
            <span class="n">ex_embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example_embeddings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ex_embedding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">similarity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">,</span> <span class="n">ex_embedding</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">query_embedding</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ex_embedding</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">similarity</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">similarity_threshold</span><span class="p">:</span>
                    <span class="n">selected</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ex</span><span class="p">,</span> <span class="n">similarity</span><span class="p">))</span>

        <span class="c1"># Sort by similarity and select top examples</span>
        <span class="n">selected</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ex</span> <span class="k">for</span> <span class="n">ex</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">max_examples</span><span class="p">]]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">label_space</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform in-context learning for XML.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: Input text to classify</span>
<span class="sd">            label_space: Available labels for this instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            Prediction with labels and confidence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Select relevant examples</span>
        <span class="n">selected_examples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_relevant_examples</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Format examples for prompt</span>
        <span class="n">formatted_examples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_examples</span><span class="p">(</span><span class="n">selected_examples</span><span class="p">)</span>

        <span class="c1"># Perform in-context learning</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context_learner</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">examples</span><span class="o">=</span><span class="n">formatted_examples</span><span class="p">,</span>
            <span class="n">label_space</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">label_space</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Parse and filter predictions</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_predictions</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span> <span class="n">label_space</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">predictions</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">],</span>
            <span class="n">confidence</span><span class="o">=</span><span class="n">predictions</span><span class="p">[</span><span class="s2">&quot;confidence&quot;</span><span class="p">],</span>
            <span class="n">examples_used</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_examples</span><span class="p">),</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get embedding for text.&quot;&quot;&quot;</span>
        <span class="c1"># Simplified - would use actual embedding model</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">768</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_examples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">examples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format examples for the prompt.&quot;&quot;&quot;</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Example </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">Text: </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">Labels: </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">labels</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">predictions_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                         <span class="n">label_space</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse and filter predictions to valid labels.&quot;&quot;&quot;</span>
        <span class="c1"># Parse predictions</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">predictions_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

        <span class="c1"># Filter to valid labels</span>
        <span class="n">valid_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">all_predictions</span><span class="p">:</span>
            <span class="c1"># Find closest match in label space</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_closest_label</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label_space</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">closest</span> <span class="ow">and</span> <span class="n">closest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_predictions</span><span class="p">:</span>
                <span class="n">valid_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">closest</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;labels&quot;</span><span class="p">:</span> <span class="n">valid_predictions</span><span class="p">,</span>
            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_predictions</span><span class="p">))</span>  <span class="c1"># Simple confidence</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_closest_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">prediction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">label_space</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find closest matching label in label space.&quot;&quot;&quot;</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># Exact match</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_space</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">prediction</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">label</span>

        <span class="c1"># Partial match</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_space</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prediction</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">prediction</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">label</span>

        <span class="c1"># Word overlap</span>
        <span class="n">pred_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">prediction</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">best_match</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">max_overlap</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">label_space</span><span class="p">:</span>
            <span class="n">label_words</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">overlap</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_words</span> <span class="o">&amp;</span> <span class="n">label_words</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">overlap</span> <span class="o">&gt;</span> <span class="n">max_overlap</span><span class="p">:</span>
                <span class="n">max_overlap</span> <span class="o">=</span> <span class="n">overlap</span>
                <span class="n">best_match</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">return</span> <span class="n">best_match</span> <span class="k">if</span> <span class="n">max_overlap</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>
</div>
</section>
</section>
<section id="meta-learning-for-xml">
<h3>Meta-Learning for XML<a class="headerlink" href="#meta-learning-for-xml" title="Link to this heading">#</a></h3>
<section id="adaptation-to-new-domains">
<h4>Adaptation to New Domains<a class="headerlink" href="#adaptation-to-new-domains" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">XMLMetaLearner</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Meta-learning system for rapid adaptation to new XML domains.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">base_classifier</span><span class="p">:</span> <span class="n">DSPyXMLClassifier</span><span class="p">,</span>
                 <span class="n">adaptation_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize meta-learner.</span>

<span class="sd">        Args:</span>
<span class="sd">            base_classifier: Base XML classifier to adapt</span>
<span class="sd">            adaptation_steps: Number of adaptation steps</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_classifier</span> <span class="o">=</span> <span class="n">base_classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_steps</span> <span class="o">=</span> <span class="n">adaptation_steps</span>

        <span class="c1"># Meta-learning modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_analyzer</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;support_examples, query_example -&gt; task_characteristics&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_generator</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;base_model, task_characteristics -&gt; adapted_configuration&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">adapt_to_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">support_set</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">],</span>
                       <span class="n">query_example</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DSPyXMLClassifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adapt base classifier to new domain using few examples.</span>

<span class="sd">        Args:</span>
<span class="sd">            support_set: Small set of examples from new domain</span>
<span class="sd">            query_example: Example to classify</span>

<span class="sd">        Returns:</span>
<span class="sd">            Adapted classifier</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Analyze task characteristics</span>
        <span class="n">task_chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_analyzer</span><span class="p">(</span>
            <span class="n">support_examples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_support_set</span><span class="p">(</span><span class="n">support_set</span><span class="p">),</span>
            <span class="n">query_example</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">query_example</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Generate adaptation configuration</span>
        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptation_generator</span><span class="p">(</span>
            <span class="n">base_model</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_classifier</span><span class="p">),</span>
            <span class="n">task_characteristics</span><span class="o">=</span><span class="n">task_chars</span><span class="o">.</span><span class="n">task_characteristics</span>
        <span class="p">)</span>

        <span class="c1"># Apply adaptations</span>
        <span class="n">adapted_classifier</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_adaptations</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">adapted_classifier</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_format_support_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">support_set</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Format support set for analysis.&quot;&quot;&quot;</span>
        <span class="n">formatted</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ex</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">support_set</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">formatted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Example </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">ex</span><span class="o">.</span><span class="n">labels</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_adaptations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DSPyXMLClassifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply configuration adaptations to base classifier.&quot;&quot;&quot;</span>
        <span class="c1"># Parse configuration and apply changes</span>
        <span class="c1"># This would modify thresholds, weights, etc.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_classifier</span>  <span class="c1"># Simplified</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="optimization-techniques-for-xml">
<h2>Optimization Techniques for XML<a class="headerlink" href="#optimization-techniques-for-xml" title="Link to this heading">#</a></h2>
<section id="efficient-training-strategies">
<h3>Efficient Training Strategies<a class="headerlink" href="#efficient-training-strategies" title="Link to this heading">#</a></h3>
<section id="hierarchical-bootstrap-optimization">
<h4>Hierarchical Bootstrap Optimization<a class="headerlink" href="#hierarchical-bootstrap-optimization" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">XMLBootstrapOptimizer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specialized optimizer for XML that leverages label hierarchy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">hierarchy</span><span class="p">:</span> <span class="n">XMLHierarchy</span><span class="p">,</span>
                 <span class="n">base_optimizer</span><span class="p">:</span> <span class="n">dspy</span><span class="o">.</span><span class="n">BootstrapFewShot</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with label hierarchy and base optimizer.</span>

<span class="sd">        Args:</span>
<span class="sd">            hierarchy: Label hierarchy structure</span>
<span class="sd">            base_optimizer: Base DSPy optimizer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_optimizer</span> <span class="o">=</span> <span class="n">base_optimizer</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">hierarchical_optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">module</span><span class="p">:</span> <span class="n">DSPyXMLClassifier</span><span class="p">,</span>
                            <span class="n">trainset</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DSPyXMLClassifier</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform hierarchical optimization of XML classifier.</span>

<span class="sd">        Optimizes in stages:</span>
<span class="sd">        1. Root level classifiers</span>
<span class="sd">        2. Branch level classifiers</span>
<span class="sd">        3. Leaf level classifiers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Group examples by hierarchy level</span>
        <span class="n">root_examples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">branch_examples</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">leaf_examples</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">trainset</span><span class="p">:</span>
            <span class="c1"># Determine hierarchy level for each label</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">depth_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Root level</span>
                    <span class="n">root_examples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Branch level</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">parent_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                    <span class="n">branch_examples</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># Leaf level</span>
                    <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hierarchy</span><span class="o">.</span><span class="n">parent_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                    <span class="n">leaf_examples</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>

        <span class="c1"># Optimize root level</span>
        <span class="k">if</span> <span class="n">root_examples</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_optimizer</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                <span class="n">module</span><span class="p">,</span> <span class="n">trainset</span><span class="o">=</span><span class="n">root_examples</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Optimize branch levels</span>
        <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">examples</span> <span class="ow">in</span> <span class="n">branch_examples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="c1"># Create specialized module for this branch</span>
                <span class="n">branch_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_branch_module</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
                <span class="n">branch_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_optimizer</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
                    <span class="n">branch_module</span><span class="p">,</span> <span class="n">trainset</span><span class="o">=</span><span class="n">examples</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">module</span><span class="o">.</span><span class="n">branch_modules</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="n">branch_module</span>

        <span class="c1"># Optimize leaf levels with few-shot</span>
        <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">examples</span> <span class="ow">in</span> <span class="n">leaf_examples</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1"># Fine-tune with specific examples</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fine_tune_leaf</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">examples</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">module</span>
</pre></div>
</div>
</section>
</section>
<section id="memory-efficient-inference">
<h3>Memory-Efficient Inference<a class="headerlink" href="#memory-efficient-inference" title="Link to this heading">#</a></h3>
<section id="streaming-label-processing">
<h4>Streaming Label Processing<a class="headerlink" href="#streaming-label-processing" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">StreamingXMLProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process labels in streams to handle massive label spaces efficiently.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">label_streams</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                 <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with label streams.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_streams: Dictionary mapping stream names to label lists</span>
<span class="sd">            batch_size: Number of labels to process in each batch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_streams</span> <span class="o">=</span> <span class="n">label_streams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">stream_classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">classifier</span><span class="p">:</span> <span class="n">DSPyXMLClassifier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform streaming classification.</span>

<span class="sd">        Processes labels in batches to manage memory usage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">stream_name</span><span class="p">,</span> <span class="n">labels</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_streams</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">stream_predictions</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Process labels in batches</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">):</span>
                <span class="n">batch_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">]</span>

                <span class="c1"># Classify batch</span>
                <span class="n">batch_result</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">(</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">candidates</span><span class="o">=</span><span class="n">batch_labels</span>
                <span class="p">)</span>

                <span class="c1"># Filter predictions by confidence</span>
                <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">batch_result</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span>
                    <span class="n">batch_result</span><span class="o">.</span><span class="n">confidence_scores</span>
                <span class="p">):</span>
                    <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># Confidence threshold</span>
                        <span class="n">stream_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">label</span><span class="p">,</span>
                            <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                            <span class="s1">&#39;stream&#39;</span><span class="p">:</span> <span class="n">stream_name</span>
                        <span class="p">})</span>

            <span class="n">all_predictions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">stream_predictions</span><span class="p">)</span>

        <span class="c1"># Sort by score and return top predictions</span>
        <span class="n">all_predictions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;predictions&#39;</span><span class="p">:</span> <span class="n">all_predictions</span><span class="p">[:</span><span class="mi">100</span><span class="p">],</span>  <span class="c1"># Top 100 predictions</span>
            <span class="s1">&#39;streams_processed&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_streams</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s1">&#39;total_labels_evaluated&#39;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
                                        <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_streams</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id1">
<h2>Real-World XML Applications<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<section id="wikipedia-article-tagging-system">
<h3>Wikipedia Article Tagging System<a class="headerlink" href="#wikipedia-article-tagging-system" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">WikipediaTagger</span><span class="p">(</span><span class="n">DSPyXMLClassifier</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    XML system for automatically tagging Wikipedia articles.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category_hierarchy</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize with Wikipedia category hierarchy.</span>

<span class="sd">        Args:</span>
<span class="sd">            category_hierarchy: Nested Wikipedia category structure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Build label index from Wikipedia categories</span>
        <span class="n">all_categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extract_categories</span><span class="p">(</span><span class="n">category_hierarchy</span><span class="p">)</span>
        <span class="n">label_index</span> <span class="o">=</span> <span class="n">XMLEmbeddingIndex</span><span class="p">(</span><span class="n">all_categories</span><span class="p">)</span>

        <span class="c1"># Build hierarchy</span>
        <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">XMLHierarchy</span><span class="p">(</span><span class="n">category_hierarchy</span><span class="p">)</span>

        <span class="c1"># Initialize base classifier</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">label_index</span><span class="o">=</span><span class="n">label_index</span><span class="p">,</span>
            <span class="n">hierarchy</span><span class="o">=</span><span class="n">hierarchy</span><span class="p">,</span>
            <span class="n">max_candidates</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
            <span class="n">max_predictions</span><span class="o">=</span><span class="mi">20</span>
        <span class="p">)</span>

        <span class="c1"># Wikipedia-specific modules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category_validator</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;article_text, category -&gt; is_valid_category, validation_reasoning&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">notability_checker</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;article_text, category -&gt; notability_score, explanation&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract all category names from hierarchy.&quot;&quot;&quot;</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">extract</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="n">extract</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">categories</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">extract</span><span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">categories</span><span class="p">))</span>  <span class="c1"># Remove duplicates</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tag_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">article_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">article_title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">existing_categories</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tag a Wikipedia article with appropriate categories.</span>

<span class="sd">        Args:</span>
<span class="sd">            article_text: Full article text</span>
<span class="sd">            article_title: Article title for context</span>
<span class="sd">            existing_categories: Already assigned categories</span>

<span class="sd">        Returns:</span>
<span class="sd">            Predictions with category tags</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare context</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">article_title</span><span class="p">,</span>
            <span class="s1">&#39;existing_categories&#39;</span><span class="p">:</span> <span class="n">existing_categories</span> <span class="ow">or</span> <span class="p">[],</span>
            <span class="s1">&#39;text_length&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">article_text</span><span class="p">),</span>
            <span class="s1">&#39;has_references&#39;</span><span class="p">:</span> <span class="s1">&#39;[References]&#39;</span> <span class="ow">in</span> <span class="n">article_text</span>
        <span class="p">}</span>

        <span class="c1"># Get initial predictions</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">article_text</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>

        <span class="c1"># Validate predictions</span>
        <span class="n">validated_predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predictions</span><span class="p">,</span>
                                 <span class="n">predictions</span><span class="o">.</span><span class="n">confidence_scores</span><span class="p">):</span>
            <span class="c1"># Validate category appropriateness</span>
            <span class="n">validation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_validator</span><span class="p">(</span>
                <span class="n">article_text</span><span class="o">=</span><span class="n">article_text</span><span class="p">[:</span><span class="mi">1000</span><span class="p">],</span>  <span class="c1"># First 1000 chars</span>
                <span class="n">category</span><span class="o">=</span><span class="n">category</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">validation</span><span class="o">.</span><span class="n">is_valid_category</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">:</span>
                <span class="c1"># Check notability</span>
                <span class="n">notability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notability_checker</span><span class="p">(</span>
                    <span class="n">article_text</span><span class="o">=</span><span class="n">article_text</span><span class="p">[:</span><span class="mi">1000</span><span class="p">],</span>
                    <span class="n">category</span><span class="o">=</span><span class="n">category</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">notability</span><span class="o">.</span><span class="n">notability_score</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">validated_predictions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">category</span><span class="p">,</span>
                        <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                        <span class="s1">&#39;validation&#39;</span><span class="p">:</span> <span class="n">validation</span><span class="o">.</span><span class="n">validation_reasoning</span><span class="p">,</span>
                        <span class="s1">&#39;notability&#39;</span><span class="p">:</span> <span class="n">notability</span><span class="o">.</span><span class="n">notability_score</span>
                    <span class="p">})</span>

        <span class="c1"># Sort by combined score</span>
        <span class="n">validated_predictions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;notability&#39;</span><span class="p">]),</span>
            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">validated_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]],</span>
            <span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">validated_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]],</span>
            <span class="n">validations</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">validated_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]],</span>
            <span class="n">notability_scores</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;notability&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">validated_predictions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
        <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="key-takeaways">
<h2>Key Takeaways<a class="headerlink" href="#key-takeaways" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>XML requires specialized approaches</strong> due to massive label spaces and computational challenges</p></li>
<li><p><strong>Efficient candidate selection</strong> is crucial for scalable XML inference</p></li>
<li><p><strong>Hierarchical organization</strong> of labels significantly improves performance and interpretability</p></li>
<li><p><strong>Zero-shot capabilities</strong> enable handling of new and emerging labels</p></li>
<li><p><strong>Specialized evaluation metrics</strong> account for label imbalance and XML-specific challenges</p></li>
<li><p><strong>In-context learning</strong> provides powerful adaptation capabilities for XML tasks</p></li>
<li><p><strong>Meta-learning</strong> enables rapid domain adaptation with few examples</p></li>
<li><p><strong>Memory-efficient processing</strong> is essential for production XML systems</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>In the next section, we’ll explore <strong>Entity Extraction</strong>, demonstrating how to build systems that can identify and extract structured information from unstructured text. We’ll see how DSPy’s modular approach extends to extraction tasks and learn optimization strategies for high-accuracy entity recognition.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/06_real_world_applications"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="07a_perspective_driven_research.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Perspective-Driven Research for Article Generation</p>
      </div>
    </a>
    <a class="right-next"
       href="08a_long_form_generation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Long-form Article Generation with DSPy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-xml-fundamentals-and-challenges">Understanding XML: Fundamentals and Challenges</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-makes-xml-extreme">What Makes XML “Extreme”?</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scale-dimensions">Scale Dimensions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-xml-applications">Real-World XML Applications</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-xml-challenges">Core XML Challenges</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#computational-complexity">1. Computational Complexity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-sparsity">2. Data Sparsity</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-constraints">3. Memory Constraints</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-complexity">4. Evaluation Complexity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#label-space-representation-and-indexing">Label Space Representation and Indexing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-label-representation">Efficient Label Representation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#label-embeddings">Label Embeddings</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-label-organization">Hierarchical Label Organization</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tree-based-label-structure">Tree-based Label Structure</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#label-clustering-for-scalability">Label Clustering for Scalability</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-label-clustering">Dynamic Label Clustering</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dspy-xml-implementation">DSPy XML Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#core-xml-classifier-architecture">Core XML Classifier Architecture</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#scalable-xml-classifier-with-dspy">Scalable XML Classifier with DSPy</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-xml-capabilities">Zero-Shot XML Capabilities</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#zero-shot-label-prediction">Zero-Shot Label Prediction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xml-evaluation-metrics-and-methodologies">XML Evaluation Metrics and Methodologies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specialized-xml-metrics">Specialized XML Metrics</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-of-xml-evaluation-metrics">Implementation of XML Evaluation Metrics</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#propensity-scored-evaluation">Propensity Scored Evaluation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#handling-label-imbalance-in-evaluation">Handling Label Imbalance in Evaluation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-xml-techniques">Advanced XML Techniques</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-context-learning-for-xml">In-Context Learning for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-in-context-example-selection">Dynamic In-Context Example Selection</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#meta-learning-for-xml">Meta-Learning for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#adaptation-to-new-domains">Adaptation to New Domains</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimization-techniques-for-xml">Optimization Techniques for XML</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-training-strategies">Efficient Training Strategies</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hierarchical-bootstrap-optimization">Hierarchical Bootstrap Optimization</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#memory-efficient-inference">Memory-Efficient Inference</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#streaming-label-processing">Streaming Label Processing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Real-World XML Applications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#wikipedia-article-tagging-system">Wikipedia Article Tagging System</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dustin Ober
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>