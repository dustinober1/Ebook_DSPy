
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Entity Extraction: Mining Structured Information from Text &#8212; DSPy: The Complete Guide</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/06_real_world_applications/04_entity_extraction';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Intelligent Agents: Building Autonomous Problem-Solving Systems" href="05_intelligent_agents.html" />
    <link rel="prev" title="Classification Tasks: Building Robust Text Categorization Systems" href="03_classification_tasks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../00_frontmatter/00_preface.html">
  
  
  
  
  
  
    <p class="title logo__title">DSPy: The Complete Guide</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/01_how_to_use_this_book.html">How to Use This Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/02_prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../00_frontmatter/03_setup_instructions.html">Setup Instructions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Fundamentals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01_fundamentals/00_chapter_intro.html">Chapter 1: DSPy Fundamentals</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/01_what_is_dspy.html">What is DSPy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/02_programming_vs_prompting.html">Programming vs. Prompting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/03_installation_setup.html">Installation and Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/04_first_dspy_program.html">Your First DSPy Program</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/05_language_models.html">Language Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_fundamentals/06_exercises.html">Chapter 1 Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Signatures</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../02_signatures/00_chapter_intro.html">Chapter 2: Signatures</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/01_understanding_signatures.html">Understanding Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/02_signature_syntax.html">Signature Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/03_typed_signatures.html">Typed Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/04_advanced_signatures.html">Advanced Signatures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/05_practical_examples.html">Practical Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02_signatures/06_exercises.html">Chapter 2 Exercises</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Modules</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../03_modules/00_chapter_intro.html">Chapter 3: Modules</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/01_module_basics.html">Module Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/02_predict_module.html">The Predict Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/02a_typed_predictor.html">TypedPredictor: Type-Safe Language Model Wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/03_chainofthought.html">Chain of Thought Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/04_react_agents.html">ReAct Agents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/05_custom_modules.html">Custom Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/06_composing_modules.html">Composing Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/07_exercises.html">Chapter 3 Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03_modules/08_assertions.html">Assertions Module</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 4 - Evaluation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../04_evaluation/00_chapter_intro.html">Chapter 4: Evaluation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/01_why_evaluation_matters.html">Why Evaluation Matters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/02_creating_datasets.html">Creating Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/03_defining_metrics.html">Defining Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/04_evaluation_loops.html">Evaluation Loops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/05_best_practices.html">Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/06_exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/07_structured_prompting.html">Structured Prompting for Robust Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/08_llm_as_a_judge.html">LLM-as-a-Judge for Context-Sensitive Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04_evaluation/09_human_aligned_evaluation.html">Human-Aligned Evaluation: Capturing What Really Matters</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 5 - Optimizers</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../05_optimizers/00_chapter_intro.html">Chapter 5: Optimizers &amp; Compilation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/01_compilation_concept.html">The Compilation Concept in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/02_bootstrapfewshot.html">BootstrapFewShot: Automatic Few-Shot Example Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/02a_copro.html">COPRO: Chain-of-Thought Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/03_mipro.html">MIPRO: Multi-step Instruction and Demonstration Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/04_knnfewshot.html">KNNFewShot: Similarity-Based Example Selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/05_finetuning.html">Fine-Tuning Small Language Models in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/06_choosing_optimizers.html">Choosing Optimizers: Decision Guide and Trade-offs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/07_constraint_driven_optimization.html">Constraint-Driven Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/07_exercises.html">Chapter 5 Exercises: Optimizers &amp; Compilation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/08_reflective_prompt_evolution.html">Reflective Prompt Evolution (RPE): Evolutionary Optimization Without Gradients</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/09_copa_compiler_method.html">COPA: Compiler and Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/09a_copa_method.html">COPA: Combined Fine-Tuning and Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/10_joint_optimization.html">Joint Optimization: Fine-Tuning and Prompt Synergy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/11_monte_carlo_optimization.html">Monte Carlo Optimization in DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/12_bayesian_optimization.html">Bayesian Optimization for Prompt Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/13_comprehensive_examples.html">Comprehensive Examples and Implementation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/14_multistage_optimization_theory.html">Multi-stage Optimization Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/15_instruction_tuning_frameworks.html">Instruction Tuning Frameworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/16_demonstration_optimization.html">Demonstration Optimization Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/17_multistage_architectures.html">Multi-stage Program Architectures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/18_complex_pipeline_optimization.html">Optimization Strategies for Complex Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/19_instruction_demonstration_interactions.html">Instruction and Demonstration Interaction Effects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/20_prompts_as_hyperparameters.html">Prompts as Auto-Optimized Hyperparameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/21_minimal_data_pipelines.html">Minimal Data Training Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/22_gepa_genetic_pareto_optimization.html">GEPA: Genetic-Pareto Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/23_state_space_prompt_optimization.html">State-Space Search for Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/24_inpars_plus_synthetic_data_ir.html">InPars+: Advanced Synthetic Data Generation for Information Retrieval</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/25_custom_mipro_enhanced_optimization.html">CustomMIPROv2: Enhanced Multi-Stage Prompt Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05_optimizers/26_automatic_prompt_optimization_research.html">Automatic Prompt Optimization: When AI Outperforms Humans</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 6 - Real-World Applications</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="00_chapter_intro.html">Chapter 6: Building Real-World Applications</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_rag_systems.html">RAG Systems: Building Intelligent Document Q&amp;A</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_multi_hop_search.html">Multi-hop Search: Complex Reasoning Across Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_classification_tasks.html">Classification Tasks: Building Robust Text Categorization Systems</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Entity Extraction: Mining Structured Information from Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_intelligent_agents.html">Intelligent Agents: Building Autonomous Problem-Solving Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_code_generation.html">Code Generation: Building Automated Programming Assistants</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_exercises.html">Chapter 6 Exercises: Building Real-World Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="07a_perspective_driven_research.html">Perspective-Driven Research for Article Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_extreme_multilabel_classification.html">Extreme Multi-Label Classification: Scaling to Millions of Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="08a_long_form_generation.html">Long-form Article Generation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_outline_generation.html">Outline Generation for Structured Article Writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_extreme_few_shot_learning.html">Extreme Few-Shot Learning: Training with 10 Gold Labels</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_ir_model_training_scratch.html">IR Model Training from Scratch: Methodology and Best Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_lingvarbench_healthcare_synthetic_data.html">LingVarBench: Synthetic Healthcare Transcript Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_scientific_figure_caption_generation.html">Scientific Figure Caption Generation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_retrieval_augmented_guardrails.html">Retrieval-Augmented Guardrails for AI Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="16_graphrag_wikipedia_tidb_tutorial.html">GraphRAG from Wikipedia: Building with DSPy, OpenAI, and TiDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="17_framework_comparisons_dspy_ecosystem.html">Framework Comparisons in the DSPy Ecosystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="18_multi_agent_rag_systems.html">Multi-Agent RAG Systems with DSPy</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 7 - Advanced Topics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../07_advanced_topics/00_chapter_intro.html">Chapter 7: Advanced Topics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/01_adapters_tools.html">Adapters and Tools: Extending DSPy Capabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/02_caching_performance.html">Caching and Performance: Building High-Performance DSPy Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/03_async_streaming.html">Async and Streaming: Building Real-Time DSPy Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/04_debugging_tracing.html">Debugging and Tracing: Mastering DSPy Application Diagnostics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/05_deployment_strategies.html">Deployment Strategies: Taking DSPy Applications to Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/06_exercises.html">Chapter 7 Exercises: Advanced Topics Mastery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/07_self_refining_pipelines.html">Self-Refining Pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07_advanced_topics/08_declarative_compilation.html">Declarative Language Model Compilation Techniques</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 8 - Case Studies</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../08_case_studies/00_introduction.html">Chapter 8: Case Studies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/01_enterprise_rag_system.html">Case Study 1: Building an Enterprise RAG System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/01a_healthcare_clinical_notes.html">Case Study 1: Clinical Notes Analysis with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/02_customer_support_chatbot.html">Case Study 2: Developing a Customer Support Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/03_ai_code_assistant.html">Case Study 3: Creating an AI-Powered Code Assistant</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/04_automated_data_analysis.html">Case Study 4: Building an Automated Data Analysis Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/05_exercises.html">Chapter 8 Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/05a_storm_writing_assistant.html">Case Study 5: STORM - AI-Powered Writing Assistant for Wikipedia-like Articles</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/06_assertion_driven_applications.html">Case Study: Assertion-Driven Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/07_databricks_jetblue_llm_optimization.html">Case Study 7: Databricks &amp; JetBlue LLM Pipeline Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/08_replit_code_repair_dspy.html">Case Study 8: Replit Code Repair with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/09_databricks_dspy_platform_integration.html">Case Study 9: Databricks Platform Integration with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/10_ddi_behavioral_simulation_automation.html">Case Study 10: DDI Behavioral Simulation Automation with DSPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08_case_studies/11_salomatic_medical_report_generation.html">Case Study 11: Salomatic Medical Report Generation with DSPy and Langtrace</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../09_appendices/00_introduction.html">Chapter 9: Appendices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/01_api_reference_quick.html">API Reference Quick Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/02_troubleshooting.html">Troubleshooting Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/03_resources.html">Additional Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/04_glossary.html">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09_appendices/05_community_resources.html">Community Resources and Perspectives</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/06_real_world_applications/04_entity_extraction.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Entity Extraction: Mining Structured Information from Text</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-entity-extraction">Understanding Entity Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-entity-types">Common Entity Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-applications">Real-World Applications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-entity-extractors">Building Entity Extractors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-entity-extractor">Basic Entity Extractor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-entity-extractor-with-context">Advanced Entity Extractor with Context</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-extractor">Relation Extractor</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specialized-entity-extraction-applications">Specialized Entity Extraction Applications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resume-cv-parser">Resume/CV Parser</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contract-analyzer">Contract Analyzer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#medical-record-processor">Medical Record Processor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#financial-document-analyzer">Financial Document Analyzer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizing-entity-extraction">Optimizing Entity Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-bootstrapfewshot-for-entity-extraction">Using BootstrapFewShot for Entity Extraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handle-entity-ambiguity">1. Handle Entity Ambiguity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-extracted-entities">2. Validate Extracted Entities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handle-nested-entities">3. Handle Nested Entities</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-techniques">Evaluation Techniques</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comprehensive-entity-evaluation">Comprehensive Entity Evaluation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="entity-extraction-mining-structured-information-from-text">
<h1>Entity Extraction: Mining Structured Information from Text<a class="headerlink" href="#entity-extraction-mining-structured-information-from-text" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Entity extraction (also known as Named Entity Recognition or NER) is the process of identifying and categorizing specific pieces of information from unstructured text. This critical technology powers everything from resume parsing and contract analysis to medical record processing and financial document extraction. DSPy provides robust tools for building sophisticated entity extraction systems that can handle complex, real-world scenarios.</p>
</section>
<section id="understanding-entity-extraction">
<h2>Understanding Entity Extraction<a class="headerlink" href="#understanding-entity-extraction" title="Link to this heading">#</a></h2>
<section id="common-entity-types">
<h3>Common Entity Types<a class="headerlink" href="#common-entity-types" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Person</strong>: Names of individuals (John Smith, Dr. Sarah Johnson)</p></li>
<li><p><strong>Organization</strong>: Companies, institutions (Google, Microsoft, Stanford University)</p></li>
<li><p><strong>Location</strong>: Places, addresses (New York, 123 Main Street)</p></li>
<li><p><strong>Date/Time</strong>: Temporal expressions (January 15, 2024, 3:30 PM)</p></li>
<li><p><strong>Money</strong>: Monetary values ($50,000, â‚¬1.2 million)</p></li>
<li><p><strong>Product</strong>: Commercial products (iPhone 15, Toyota Camry)</p></li>
<li><p><strong>Event</strong>: Named events (World War II, Olympics 2024)</p></li>
<li><p><strong>Custom</strong>: Domain-specific entities (Medical codes, Legal references)</p></li>
</ol>
</section>
<section id="real-world-applications">
<h3>Real-World Applications<a class="headerlink" href="#real-world-applications" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>Resume Processing</strong>: Extract skills, experience, education</p></li>
<li><p><strong>Contract Analysis</strong>: Identify parties, dates, clauses</p></li>
<li><p><strong>Medical Records</strong>: Extract diagnoses, medications, procedures</p></li>
<li><p><strong>Financial Documents</strong>: Extract amounts, dates, companies</p></li>
<li><p><strong>News Articles</strong>: Identify people, organizations, events</p></li>
<li><p><strong>Customer Reviews</strong>: Extract products, features, sentiments</p></li>
</ul>
</section>
</section>
<section id="building-entity-extractors">
<h2>Building Entity Extractors<a class="headerlink" href="#building-entity-extractors" title="Link to this heading">#</a></h2>
<section id="basic-entity-extractor">
<h3>Basic Entity Extractor<a class="headerlink" href="#basic-entity-extractor" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">BasicEntityExtractor</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span> <span class="o">=</span> <span class="n">entity_types</span>
        <span class="n">types_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;text, entity_types[</span><span class="si">{</span><span class="n">types_str</span><span class="si">}</span><span class="s2">] -&gt; entities&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">entity_types</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Parse the extracted entities</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_entities</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span>
            <span class="n">raw_output</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">entities</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse raw entity text into structured format.&quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entities_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entities</span>

        <span class="c1"># Simple parsing - assumes format: &quot;TYPE: entity1, entity2&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">entities_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">entity_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">entity</span><span class="p">:</span>
                        <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.8</span>  <span class="c1"># Default confidence</span>
                        <span class="p">})</span>

        <span class="k">return</span> <span class="n">entities</span>
</pre></div>
</div>
</section>
<section id="advanced-entity-extractor-with-context">
<h3>Advanced Entity Extractor with Context<a class="headerlink" href="#advanced-entity-extractor-with-context" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">AdvancedEntityExtractor</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">,</span> <span class="n">context_window</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span> <span class="o">=</span> <span class="n">entity_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context_window</span> <span class="o">=</span> <span class="n">context_window</span>
        <span class="n">types_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity_types</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">find_entities</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;text, context, entity_types[</span><span class="si">{</span><span class="n">types_str</span><span class="si">}</span><span class="s2">] -&gt; entities_with_positions&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_entities</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;entity, text_context -&gt; is_valid, corrected_entity, confidence&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;entity, context, possible_meanings -&gt; disambiguated_entity, reasoning&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">document_context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">document_context</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">document_context</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">context_window</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">text</span>

        <span class="c1"># Find entities with positions</span>
        <span class="n">extraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_entities</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">entity_types</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Parse and validate entities</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entity_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_entities_with_positions</span><span class="p">(</span><span class="n">extraction</span><span class="o">.</span><span class="n">entities_with_positions</span><span class="p">):</span>
            <span class="c1"># Validate each entity</span>
            <span class="n">validation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_entities</span><span class="p">(</span>
                <span class="n">entity</span><span class="o">=</span><span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span>
                <span class="n">text_context</span><span class="o">=</span><span class="n">text</span><span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">-</span><span class="mi">50</span><span class="p">):</span><span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span><span class="o">+</span><span class="mi">50</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">validation</span><span class="o">.</span><span class="n">is_valid</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
                <span class="c1"># Disambiguate if needed</span>
                <span class="k">if</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;PERSON&quot;</span><span class="p">,</span> <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">]:</span>
                    <span class="n">disambiguation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disambiguate</span><span class="p">(</span>
                        <span class="n">entity</span><span class="o">=</span><span class="n">validation</span><span class="o">.</span><span class="n">corrected_entity</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                        <span class="n">possible_meanings</span><span class="o">=</span><span class="s2">&quot;Multiple possible matches&quot;</span>
                    <span class="p">)</span>
                    <span class="n">final_entity</span> <span class="o">=</span> <span class="n">disambiguation</span><span class="o">.</span><span class="n">disambiguated_entity</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">final_entity</span> <span class="o">=</span> <span class="n">validation</span><span class="o">.</span><span class="n">corrected_entity</span>

                <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">final_entity</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">validation</span><span class="o">.</span><span class="n">confidence</span><span class="p">),</span>
                    <span class="s2">&quot;original&quot;</span><span class="p">:</span> <span class="n">entity_info</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span>
            <span class="n">extraction_reasoning</span><span class="o">=</span><span class="n">extraction</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_entities_with_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse entities with their positions.&quot;&quot;&quot;</span>
        <span class="c1"># Assuming format: &quot;TYPE: entity (start-end), entity (start-end)&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">entities_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">entity_type</span><span class="p">,</span> <span class="n">entities_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">entity_match</span> <span class="ow">in</span> <span class="n">entities_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">entity_match</span> <span class="o">=</span> <span class="n">entity_match</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">entity_match</span> <span class="ow">and</span> <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">entity_match</span><span class="p">:</span>
                        <span class="n">entity_text</span> <span class="o">=</span> <span class="n">entity_match</span><span class="p">[:</span><span class="n">entity_match</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">positions</span> <span class="o">=</span> <span class="n">entity_match</span><span class="p">[</span><span class="n">entity_match</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                                <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">entity_text</span><span class="p">,</span>
                                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                                <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="p">})</span>

        <span class="k">return</span> <span class="n">entities</span>
</pre></div>
</div>
</section>
<section id="relation-extractor">
<h3>Relation Extractor<a class="headerlink" href="#relation-extractor" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">RelationExtractor</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_relations</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;entities, text -&gt; relations&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">entities</span><span class="p">):</span>
        <span class="c1"># Prepare entities context</span>
        <span class="n">entities_context</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (position: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span>
        <span class="p">])</span>

        <span class="c1"># Extract relations between entities</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_relations</span><span class="p">(</span>
            <span class="n">entities</span><span class="o">=</span><span class="n">entities_context</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span>
        <span class="p">)</span>

        <span class="n">parsed_relations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_relations</span><span class="p">(</span><span class="n">relations</span><span class="o">.</span><span class="n">relations</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">relations</span><span class="o">=</span><span class="n">parsed_relations</span><span class="p">,</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">relations</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_relations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relations_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse relations text into structured format.&quot;&quot;&quot;</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">relations_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">relations</span>

        <span class="c1"># Assuming format: &quot;SUBJECT -&gt; RELATION -&gt; OBJECT&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">relations_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">relations</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s2">&quot;relation&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="n">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">relations</span>
</pre></div>
</div>
</section>
</section>
<section id="specialized-entity-extraction-applications">
<h2>Specialized Entity Extraction Applications<a class="headerlink" href="#specialized-entity-extraction-applications" title="Link to this heading">#</a></h2>
<section id="resume-cv-parser">
<h3>Resume/CV Parser<a class="headerlink" href="#resume-cv-parser" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ResumeParser</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contact_info</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;resume_text -&gt; name, email, phone, location, linkedin&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_sections</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;resume_text -&gt; work_experience, education, skills, certifications&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_experience</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;experience_section -&gt; detailed_experiences&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parse_education</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;education_section -&gt; schools, degrees, graduation_years&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resume_text</span><span class="p">):</span>
        <span class="c1"># Extract contact information</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contact_info</span><span class="p">(</span><span class="n">resume_text</span><span class="o">=</span><span class="n">resume_text</span><span class="p">)</span>

        <span class="c1"># Identify and extract sections</span>
        <span class="n">sections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_sections</span><span class="p">(</span><span class="n">resume_text</span><span class="o">=</span><span class="n">resume_text</span><span class="p">)</span>

        <span class="c1"># Parse work experience</span>
        <span class="n">experience_details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">sections</span><span class="o">.</span><span class="n">work_experience</span><span class="p">:</span>
            <span class="n">exp_parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_experience</span><span class="p">(</span><span class="n">experience_section</span><span class="o">=</span><span class="n">sections</span><span class="o">.</span><span class="n">work_experience</span><span class="p">)</span>
            <span class="n">experience_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_experience_details</span><span class="p">(</span><span class="n">exp_parsed</span><span class="o">.</span><span class="n">detailed_experiences</span><span class="p">)</span>

        <span class="c1"># Parse education</span>
        <span class="n">education_details</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">sections</span><span class="o">.</span><span class="n">education</span><span class="p">:</span>
            <span class="n">edu_parsed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_education</span><span class="p">(</span><span class="n">education_section</span><span class="o">=</span><span class="n">sections</span><span class="o">.</span><span class="n">education</span><span class="p">)</span>
            <span class="n">education_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_education_details</span><span class="p">(</span><span class="n">edu_parsed</span><span class="p">)</span>

        <span class="c1"># Parse skills</span>
        <span class="n">skills</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">sections</span><span class="o">.</span><span class="n">skills</span><span class="p">:</span>
            <span class="n">skills</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sections</span><span class="o">.</span><span class="n">skills</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">contact_info</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">contact</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">contact</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
                <span class="s2">&quot;phone&quot;</span><span class="p">:</span> <span class="n">contact</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">contact</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
                <span class="s2">&quot;linkedin&quot;</span><span class="p">:</span> <span class="n">contact</span><span class="o">.</span><span class="n">linkedin</span>
            <span class="p">},</span>
            <span class="n">work_experience</span><span class="o">=</span><span class="n">experience_details</span><span class="p">,</span>
            <span class="n">education</span><span class="o">=</span><span class="n">education_details</span><span class="p">,</span>
            <span class="n">skills</span><span class="o">=</span><span class="n">skills</span><span class="p">,</span>
            <span class="n">certifications</span><span class="o">=</span><span class="n">sections</span><span class="o">.</span><span class="n">certifications</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">sections</span><span class="o">.</span><span class="n">certifications</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_experience_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">experience_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse detailed work experience.&quot;&quot;&quot;</span>
        <span class="n">experiences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Parse each job entry</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">experience_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">job</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">experiences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_single_job</span><span class="p">(</span><span class="n">job</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">experiences</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_single_job</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">job_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse a single job entry.&quot;&quot;&quot;</span>
        <span class="c1"># Simple parsing - in practice, would be more sophisticated</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">job_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">title_company</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">lines</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;title_company&quot;</span><span class="p">:</span> <span class="n">title_company</span><span class="p">,</span>
            <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_education_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">education_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse education information.&quot;&quot;&quot;</span>
        <span class="n">schools</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">school</span> <span class="ow">in</span> <span class="n">education_text</span><span class="o">.</span><span class="n">schools</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
            <span class="n">schools</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">school</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
        <span class="k">return</span> <span class="n">schools</span>
</pre></div>
</div>
</section>
<section id="contract-analyzer">
<h3>Contract Analyzer<a class="headerlink" href="#contract-analyzer" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">ContractAnalyzer</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_parties</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;contract_text -&gt; parties, roles&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_dates</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;contract_text -&gt; effective_date, termination_date, key_dates&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_financials</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;contract_text -&gt; payment_terms, amounts, penalties&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">identify_clauses</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;contract_text -&gt; important_clauses, obligations&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract_text</span><span class="p">):</span>
        <span class="c1"># Extract parties involved</span>
        <span class="n">parties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_parties</span><span class="p">(</span><span class="n">contract_text</span><span class="o">=</span><span class="n">contract_text</span><span class="p">)</span>

        <span class="c1"># Extract important dates</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dates</span><span class="p">(</span><span class="n">contract_text</span><span class="o">=</span><span class="n">contract_text</span><span class="p">)</span>

        <span class="c1"># Extract financial information</span>
        <span class="n">financials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_financials</span><span class="p">(</span><span class="n">contract_text</span><span class="o">=</span><span class="n">contract_text</span><span class="p">)</span>

        <span class="c1"># Identify key clauses</span>
        <span class="n">clauses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_clauses</span><span class="p">(</span><span class="n">contract_text</span><span class="o">=</span><span class="n">contract_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">parties</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;entities&quot;</span><span class="p">:</span> <span class="n">parties</span><span class="o">.</span><span class="n">parties</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span>
                <span class="s2">&quot;roles&quot;</span><span class="p">:</span> <span class="n">parties</span><span class="o">.</span><span class="n">roles</span>
            <span class="p">},</span>
            <span class="n">dates</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;effective_date&quot;</span><span class="p">:</span> <span class="n">dates</span><span class="o">.</span><span class="n">effective_date</span><span class="p">,</span>
                <span class="s2">&quot;termination_date&quot;</span><span class="p">:</span> <span class="n">dates</span><span class="o">.</span><span class="n">termination_date</span><span class="p">,</span>
                <span class="s2">&quot;key_dates&quot;</span><span class="p">:</span> <span class="n">dates</span><span class="o">.</span><span class="n">key_dates</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">dates</span><span class="o">.</span><span class="n">key_dates</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">},</span>
            <span class="n">financials</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;payment_terms&quot;</span><span class="p">:</span> <span class="n">financials</span><span class="o">.</span><span class="n">payment_terms</span><span class="p">,</span>
                <span class="s2">&quot;amounts&quot;</span><span class="p">:</span> <span class="n">financials</span><span class="o">.</span><span class="n">amounts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">financials</span><span class="o">.</span><span class="n">amounts</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="s2">&quot;penalties&quot;</span><span class="p">:</span> <span class="n">financials</span><span class="o">.</span><span class="n">penalties</span>
            <span class="p">},</span>
            <span class="n">clauses</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;important&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_clauses</span><span class="p">(</span><span class="n">clauses</span><span class="o">.</span><span class="n">important_clauses</span><span class="p">),</span>
                <span class="s2">&quot;obligations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_obligations</span><span class="p">(</span><span class="n">clauses</span><span class="o">.</span><span class="n">obligations</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">clauses</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_clauses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clauses_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse contract clauses.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clauses_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_obligations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obligations_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse contractual obligations.&quot;&quot;&quot;</span>
        <span class="n">obligations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obligation</span> <span class="ow">in</span> <span class="n">obligations_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">obligation</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">obligations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obligation</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">obligations</span>
</pre></div>
</div>
</section>
<section id="medical-record-processor">
<h3>Medical Record Processor<a class="headerlink" href="#medical-record-processor" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">MedicalRecordProcessor</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_patient_info</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;medical_record -&gt; patient_name, age, gender, id&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_diagnoses</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;medical_record -&gt; diagnoses, icd_codes, symptoms&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_medications</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;medical_record -&gt; medications, dosages, frequencies&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_procedures</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;medical_record -&gt; procedures, dates, providers&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_vitals</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;medical_record -&gt; vital_signs, values, dates&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">medical_record</span><span class="p">):</span>
        <span class="c1"># Extract patient demographics</span>
        <span class="n">patient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_patient_info</span><span class="p">(</span><span class="n">medical_record</span><span class="o">=</span><span class="n">medical_record</span><span class="p">)</span>

        <span class="c1"># Extract medical information</span>
        <span class="n">diagnoses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_diagnoses</span><span class="p">(</span><span class="n">medical_record</span><span class="o">=</span><span class="n">medical_record</span><span class="p">)</span>
        <span class="n">medications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_medications</span><span class="p">(</span><span class="n">medical_record</span><span class="o">=</span><span class="n">medical_record</span><span class="p">)</span>
        <span class="n">procedures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_procedures</span><span class="p">(</span><span class="n">medical_record</span><span class="o">=</span><span class="n">medical_record</span><span class="p">)</span>
        <span class="n">vitals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_vitals</span><span class="p">(</span><span class="n">medical_record</span><span class="o">=</span><span class="n">medical_record</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">patient_info</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">patient</span><span class="o">.</span><span class="n">patient_name</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">patient</span><span class="o">.</span><span class="n">age</span><span class="p">,</span>
                <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="n">patient</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span>
                <span class="s2">&quot;medical_id&quot;</span><span class="p">:</span> <span class="n">patient</span><span class="o">.</span><span class="n">id</span>
            <span class="p">},</span>
            <span class="n">medical_info</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;diagnoses&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_medical_list</span><span class="p">(</span><span class="n">diagnoses</span><span class="o">.</span><span class="n">diagnoses</span><span class="p">),</span>
                <span class="s2">&quot;icd_codes&quot;</span><span class="p">:</span> <span class="n">diagnoses</span><span class="o">.</span><span class="n">icd_codes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">diagnoses</span><span class="o">.</span><span class="n">icd_codes</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="s2">&quot;symptoms&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_medical_list</span><span class="p">(</span><span class="n">diagnoses</span><span class="o">.</span><span class="n">symptoms</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">medications</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_medications</span><span class="p">(</span><span class="n">medications</span><span class="o">.</span><span class="n">medications</span><span class="p">,</span> <span class="n">medications</span><span class="o">.</span><span class="n">dosages</span><span class="p">,</span> <span class="n">medications</span><span class="o">.</span><span class="n">frequencies</span><span class="p">),</span>
            <span class="n">procedures</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_procedures</span><span class="p">(</span><span class="n">procedures</span><span class="o">.</span><span class="n">procedures</span><span class="p">,</span> <span class="n">procedures</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span> <span class="n">procedures</span><span class="o">.</span><span class="n">providers</span><span class="p">),</span>
            <span class="n">vitals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_vitals</span><span class="p">(</span><span class="n">vitals</span><span class="o">.</span><span class="n">vital_signs</span><span class="p">,</span> <span class="n">vitals</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">vitals</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_medical_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse comma-separated medical items.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_medications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meds_text</span><span class="p">,</span> <span class="n">dosages_text</span><span class="p">,</span> <span class="n">frequencies_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse medication information.&quot;&quot;&quot;</span>
        <span class="n">medications</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">meds</span> <span class="o">=</span> <span class="n">meds_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">meds_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">dosages</span> <span class="o">=</span> <span class="n">dosages_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">dosages_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">frequencies</span> <span class="o">=</span> <span class="n">frequencies_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">frequencies_text</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">med</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">meds</span><span class="p">):</span>
            <span class="n">medication</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">med</span><span class="o">.</span><span class="n">strip</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dosages</span><span class="p">):</span>
                <span class="n">medication</span><span class="p">[</span><span class="s2">&quot;dosage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dosages</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">):</span>
                <span class="n">medication</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">medications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">medication</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">medications</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_procedures</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">procedures_text</span><span class="p">,</span> <span class="n">dates_text</span><span class="p">,</span> <span class="n">providers_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse procedure information.&quot;&quot;&quot;</span>
        <span class="n">procedures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">proc_list</span> <span class="o">=</span> <span class="n">procedures_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">procedures_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">dates_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">dates_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">providers</span> <span class="o">=</span> <span class="n">providers_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">providers_text</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">proc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">proc_list</span><span class="p">):</span>
            <span class="n">procedure</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">proc</span><span class="o">.</span><span class="n">strip</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
                <span class="n">procedure</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">providers</span><span class="p">):</span>
                <span class="n">procedure</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">providers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">procedures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">procedure</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">procedures</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_vitals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vitals_text</span><span class="p">,</span> <span class="n">values_text</span><span class="p">,</span> <span class="n">dates_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse vital signs information.&quot;&quot;&quot;</span>
        <span class="n">vitals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">vitals_list</span> <span class="o">=</span> <span class="n">vitals_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">vitals_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">values_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">values_text</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vital</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vitals_list</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">vital</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                <span class="n">vitals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">vitals</span>
</pre></div>
</div>
</section>
<section id="financial-document-analyzer">
<h3>Financial Document Analyzer<a class="headerlink" href="#financial-document-analyzer" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">FinancialAnalyzer</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract_companies</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;document_text -&gt; companies, stock_symbols, exchanges&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_financials</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;document_text -&gt; revenues, profits, expenses, assets&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extract_transactions</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Predict</span><span class="p">(</span>
            <span class="s2">&quot;document_text -&gt; transactions, amounts, dates, parties&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">identify_risks</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="s2">&quot;document_text, financial_data -&gt; risk_factors, concerns&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_text</span><span class="p">):</span>
        <span class="c1"># Extract company information</span>
        <span class="n">companies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_companies</span><span class="p">(</span><span class="n">document_text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)</span>

        <span class="c1"># Extract financial data</span>
        <span class="n">financials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_financials</span><span class="p">(</span><span class="n">document_text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)</span>

        <span class="c1"># Extract transactions</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_transactions</span><span class="p">(</span><span class="n">document_text</span><span class="o">=</span><span class="n">document_text</span><span class="p">)</span>

        <span class="c1"># Identify risks</span>
        <span class="n">risks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_risks</span><span class="p">(</span>
            <span class="n">document_text</span><span class="o">=</span><span class="n">document_text</span><span class="p">,</span>
            <span class="n">financial_data</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">financials</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">entities</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;companies&quot;</span><span class="p">:</span> <span class="n">companies</span><span class="o">.</span><span class="n">companies</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">companies</span><span class="o">.</span><span class="n">companies</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="s2">&quot;stock_symbols&quot;</span><span class="p">:</span> <span class="n">companies</span><span class="o">.</span><span class="n">stock_symbols</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">companies</span><span class="o">.</span><span class="n">stock_symbols</span> <span class="k">else</span> <span class="p">[],</span>
                <span class="s2">&quot;exchanges&quot;</span><span class="p">:</span> <span class="n">companies</span><span class="o">.</span><span class="n">exchanges</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">companies</span><span class="o">.</span><span class="n">exchanges</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="p">},</span>
            <span class="n">financials</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;revenues&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_financial_amounts</span><span class="p">(</span><span class="n">financials</span><span class="o">.</span><span class="n">revenues</span><span class="p">),</span>
                <span class="s2">&quot;profits&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_financial_amounts</span><span class="p">(</span><span class="n">financials</span><span class="o">.</span><span class="n">profits</span><span class="p">),</span>
                <span class="s2">&quot;expenses&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_financial_amounts</span><span class="p">(</span><span class="n">financials</span><span class="o">.</span><span class="n">expenses</span><span class="p">),</span>
                <span class="s2">&quot;assets&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_financial_amounts</span><span class="p">(</span><span class="n">financials</span><span class="o">.</span><span class="n">assets</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">transactions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_transactions</span><span class="p">(</span>
                <span class="n">transactions</span><span class="o">.</span><span class="n">transactions</span><span class="p">,</span>
                <span class="n">transactions</span><span class="o">.</span><span class="n">amounts</span><span class="p">,</span>
                <span class="n">transactions</span><span class="o">.</span><span class="n">dates</span><span class="p">,</span>
                <span class="n">transactions</span><span class="o">.</span><span class="n">parties</span>
            <span class="p">),</span>
            <span class="n">risks</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;factors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list</span><span class="p">(</span><span class="n">risks</span><span class="o">.</span><span class="n">risk_factors</span><span class="p">),</span>
                <span class="s2">&quot;concerns&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_list</span><span class="p">(</span><span class="n">risks</span><span class="o">.</span><span class="n">concerns</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">risks</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_financial_amounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amounts_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse financial amounts.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">amounts_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">amount</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">amount</span> <span class="ow">in</span> <span class="n">amounts_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_transactions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trans_text</span><span class="p">,</span> <span class="n">amounts_text</span><span class="p">,</span> <span class="n">dates_text</span><span class="p">,</span> <span class="n">parties_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse transaction data.&quot;&quot;&quot;</span>
        <span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">trans_list</span> <span class="o">=</span> <span class="n">trans_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">trans_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">amounts</span> <span class="o">=</span> <span class="n">amounts_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">amounts_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="n">dates_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">dates_text</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="n">parties</span> <span class="o">=</span> <span class="n">parties_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">parties_text</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trans</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trans_list</span><span class="p">):</span>
            <span class="n">transaction</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">trans</span><span class="o">.</span><span class="n">strip</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">amounts</span><span class="p">):</span>
                <span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;amount&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">amounts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">):</span>
                <span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">parties</span><span class="p">):</span>
                <span class="n">transaction</span><span class="p">[</span><span class="s2">&quot;parties&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">transactions</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse semicolon-separated lists.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">list_text</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
</pre></div>
</div>
</section>
</section>
<section id="optimizing-entity-extraction">
<h2>Optimizing Entity Extraction<a class="headerlink" href="#optimizing-entity-extraction" title="Link to this heading">#</a></h2>
<section id="using-bootstrapfewshot-for-entity-extraction">
<h3>Using BootstrapFewShot for Entity Extraction<a class="headerlink" href="#using-bootstrapfewshot-for-entity-extraction" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">OptimizedEntityExtractor</span><span class="p">(</span><span class="n">dspy</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span> <span class="o">=</span> <span class="n">entity_types</span>
        <span class="n">types_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entity_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extract</span> <span class="o">=</span> <span class="n">dspy</span><span class="o">.</span><span class="n">ChainOfThought</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;text, entity_types[</span><span class="si">{</span><span class="n">types_str</span><span class="si">}</span><span class="s2">] -&gt; entities_with_confidence&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
            <span class="n">entity_types</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_types</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_entities_with_confidence</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">entities_with_confidence</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dspy</span><span class="o">.</span><span class="n">Prediction</span><span class="p">(</span>
            <span class="n">entities</span><span class="o">=</span><span class="n">entities</span><span class="p">,</span>
            <span class="n">reasoning</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">rationale</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_entities_with_confidence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entities_text</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse entities with confidence scores.&quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Format: &quot;ENTITY_TYPE: entity1 (0.9), entity2 (0.8)&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">entities_text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;:&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_list</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="n">entity_type</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">entity_match</span> <span class="ow">in</span> <span class="n">entity_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
                    <span class="n">entity_match</span> <span class="o">=</span> <span class="n">entity_match</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s1">&#39;(&#39;</span> <span class="ow">in</span> <span class="n">entity_match</span> <span class="ow">and</span> <span class="s1">&#39;)&#39;</span> <span class="ow">in</span> <span class="n">entity_match</span><span class="p">:</span>
                        <span class="n">entity_text</span> <span class="o">=</span> <span class="n">entity_match</span><span class="p">[:</span><span class="n">entity_match</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">confidence</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">entity_match</span><span class="p">[</span><span class="n">entity_match</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">entities</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="n">entity_text</span><span class="p">,</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">entity_type</span><span class="p">,</span>
                            <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="n">confidence</span>
                        <span class="p">})</span>

        <span class="k">return</span> <span class="n">entities</span>

<span class="c1"># Training data</span>
<span class="n">entity_trainset</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Apple Inc. announced Q2 earnings of $24.6 billion on April 27, 2023.&quot;</span><span class="p">,</span>
        <span class="n">entities</span><span class="o">=</span><span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Apple Inc.&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span> <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;$24.6 billion&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;MONEY&quot;</span><span class="p">,</span> <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;April 27, 2023&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">),</span>
    <span class="c1"># ... more examples</span>
<span class="p">]</span>

<span class="c1"># Evaluation metric</span>
<span class="k">def</span><span class="w"> </span><span class="nf">entity_extraction_metric</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate F1 score for entity extraction.&quot;&quot;&quot;</span>
    <span class="n">pred_entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pred</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>
    <span class="n">true_entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>

    <span class="c1"># Precision and Recall</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_entities</span> <span class="o">&amp;</span> <span class="n">true_entities</span><span class="p">)</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_entities</span> <span class="o">-</span> <span class="n">true_entities</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_entities</span> <span class="o">-</span> <span class="n">pred_entities</span><span class="p">)</span>

    <span class="n">precision</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># F1 Score</span>
    <span class="k">if</span> <span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>

<span class="c1"># Optimize</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">BootstrapFewShot</span><span class="p">(</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">entity_extraction_metric</span><span class="p">,</span>
    <span class="n">max_bootstrapped_demos</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">max_labeled_demos</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
<span class="n">optimized_extractor</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">OptimizedEntityExtractor</span><span class="p">([</span><span class="s2">&quot;PERSON&quot;</span><span class="p">,</span> <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span> <span class="s2">&quot;LOCATION&quot;</span><span class="p">,</span> <span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;MONEY&quot;</span><span class="p">]),</span>
    <span class="n">trainset</span><span class="o">=</span><span class="n">entity_trainset</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Link to this heading">#</a></h2>
<section id="handle-entity-ambiguity">
<h3>1. Handle Entity Ambiguity<a class="headerlink" href="#handle-entity-ambiguity" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">disambiguate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Disambiguate entities based on context.&quot;&quot;&quot;</span>
    <span class="c1"># Example: &quot;Apple&quot; could be company or fruit</span>
    <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;apple&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="s2">&quot;corp&quot;</span><span class="p">,</span> <span class="s2">&quot;company&quot;</span><span class="p">,</span> <span class="s2">&quot;stock&quot;</span><span class="p">,</span> <span class="s2">&quot;earnings&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="s2">&quot;Apple Inc.&quot;</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;fruit&quot;</span><span class="p">,</span> <span class="s2">&quot;food&quot;</span><span class="p">,</span> <span class="s2">&quot;eat&quot;</span><span class="p">,</span> <span class="s2">&quot;tree&quot;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="s2">&quot;apple (fruit)&quot;</span>
    <span class="k">return</span> <span class="n">entity</span>
</pre></div>
</div>
</section>
<section id="validate-extracted-entities">
<h3>2. Validate Extracted Entities<a class="headerlink" href="#validate-extracted-entities" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">validate_entity</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate entity based on type-specific rules.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;DATE&quot;</span><span class="p">:</span>
        <span class="c1"># Validate date format</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d{1,2}[/-]\d{1,2}[/-]\d{2,4}&#39;</span><span class="p">,</span> <span class="n">entity</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;EMAIL&quot;</span><span class="p">:</span>
        <span class="c1"># Validate email format</span>
        <span class="k">return</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">entity</span> <span class="ow">and</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">entity</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;PHONE&quot;</span><span class="p">:</span>
        <span class="c1"># Validate phone format</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\d\-\+\(\)\s]+&#39;</span><span class="p">,</span> <span class="n">entity</span><span class="p">))</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="handle-nested-entities">
<h3>3. Handle Nested Entities<a class="headerlink" href="#handle-nested-entities" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">resolve_nested_entities</span><span class="p">(</span><span class="n">entities</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resolve overlapping or nested entities.&quot;&quot;&quot;</span>
    <span class="c1"># Sort by start position, then by length (longer first)</span>
    <span class="n">sorted_entities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="n">entities</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]))</span>
    <span class="p">)</span>

    <span class="n">resolved</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">sorted_entities</span><span class="p">:</span>
        <span class="c1"># Check for overlap</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">existing</span> <span class="ow">in</span> <span class="n">resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span> <span class="ow">and</span>
                <span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">existing</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="n">overlap</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">overlap</span><span class="p">:</span>
            <span class="n">resolved</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resolved</span>
</pre></div>
</div>
</section>
</section>
<section id="evaluation-techniques">
<h2>Evaluation Techniques<a class="headerlink" href="#evaluation-techniques" title="Link to this heading">#</a></h2>
<section id="comprehensive-entity-evaluation">
<h3>Comprehensive Entity Evaluation<a class="headerlink" href="#comprehensive-entity-evaluation" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">evaluate_entity_extraction</span><span class="p">(</span><span class="n">extractor</span><span class="p">,</span> <span class="n">testset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Comprehensive evaluation of entity extraction.&quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;type_wise&quot;</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">example</span> <span class="ow">in</span> <span class="n">testset</span><span class="p">:</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">extractor</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">example</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

        <span class="c1"># Calculate precision, recall, F1</span>
        <span class="n">pred_entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">prediction</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>
        <span class="n">true_entities</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">entities</span><span class="p">)</span>

        <span class="n">tp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_entities</span> <span class="o">&amp;</span> <span class="n">true_entities</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_entities</span> <span class="o">-</span> <span class="n">true_entities</span><span class="p">)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_entities</span> <span class="o">-</span> <span class="n">pred_entities</span><span class="p">)</span>

        <span class="n">precision</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;recall&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall</span><span class="p">)</span>
        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>

        <span class="c1"># Type-wise evaluation</span>
        <span class="k">for</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">example</span><span class="o">.</span><span class="n">entities</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">]:</span>
                <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">][</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;fp&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;fn&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

            <span class="n">pred_type</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">pred_entities</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">entity_type</span><span class="p">)</span>
            <span class="n">true_type</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">true_entities</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">entity_type</span><span class="p">)</span>

            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">][</span><span class="n">entity_type</span><span class="p">][</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_type</span> <span class="o">&amp;</span> <span class="n">true_type</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">][</span><span class="n">entity_type</span><span class="p">][</span><span class="s2">&quot;fp&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_type</span> <span class="o">-</span> <span class="n">true_type</span><span class="p">)</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">][</span><span class="n">entity_type</span><span class="p">][</span><span class="s2">&quot;fn&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">true_type</span> <span class="o">-</span> <span class="n">pred_type</span><span class="p">)</span>

    <span class="c1"># Calculate averages</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">]:</span>
        <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="c1"># Calculate type-wise metrics</span>
    <span class="k">for</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">counts</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;fp&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;tp&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">counts</span><span class="p">[</span><span class="s2">&quot;fn&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">results</span><span class="p">[</span><span class="s2">&quot;type_wise&quot;</span><span class="p">][</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
            <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="n">f1</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</section>
</section>
<section id="key-takeaways">
<h2>Key Takeaways<a class="headerlink" href="#key-takeaways" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Entity extraction transforms</strong> unstructured text into structured data</p></li>
<li><p><strong>Different applications</strong> require different entity types and extraction strategies</p></li>
<li><p><strong>Context is crucial</strong> for accurate entity extraction and disambiguation</p></li>
<li><p><strong>Optimization improves</strong> extraction accuracy and consistency</p></li>
<li><p><strong>Real-world systems</strong> must handle ambiguity, validation, and edge cases</p></li>
<li><p><strong>Comprehensive evaluation</strong> includes precision, recall, and type-wise metrics</p></li>
</ol>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Link to this heading">#</a></h2>
<p>In the next section, weâ€™ll explore <strong>Intelligent Agents</strong>, showing how to build autonomous systems that can reason, plan, and execute complex tasks independently.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/06_real_world_applications"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03_classification_tasks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Classification Tasks: Building Robust Text Categorization Systems</p>
      </div>
    </a>
    <a class="right-next"
       href="05_intelligent_agents.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Intelligent Agents: Building Autonomous Problem-Solving Systems</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-entity-extraction">Understanding Entity Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-entity-types">Common Entity Types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-world-applications">Real-World Applications</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-entity-extractors">Building Entity Extractors</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-entity-extractor">Basic Entity Extractor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-entity-extractor-with-context">Advanced Entity Extractor with Context</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relation-extractor">Relation Extractor</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specialized-entity-extraction-applications">Specialized Entity Extraction Applications</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resume-cv-parser">Resume/CV Parser</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contract-analyzer">Contract Analyzer</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#medical-record-processor">Medical Record Processor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#financial-document-analyzer">Financial Document Analyzer</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizing-entity-extraction">Optimizing Entity Extraction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#using-bootstrapfewshot-for-entity-extraction">Using BootstrapFewShot for Entity Extraction</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#best-practices">Best Practices</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handle-entity-ambiguity">1. Handle Entity Ambiguity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validate-extracted-entities">2. Validate Extracted Entities</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#handle-nested-entities">3. Handle Nested Entities</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-techniques">Evaluation Techniques</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comprehensive-entity-evaluation">Comprehensive Entity Evaluation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-takeaways">Key Takeaways</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-steps">Next Steps</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dustin Ober
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>