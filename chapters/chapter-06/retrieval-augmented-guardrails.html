<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retrieval Augmented Guardrails | Chapter 6 | DSPy: The Comprehensive Guide</title>
    <meta name="description"
        content="Implement Retrieval-Augmented Guardrails to evaluate AI outputs against historical reference data. Learn to detect clinical errors and ensure safety in high-stakes domains with DSPy.">
    <link rel="stylesheet" href="../../assets/css/style.css?v=2">
    <link rel="stylesheet" href="../../assets/css/chapter.css?v=8">
    <link rel="stylesheet" href="../../assets/css/content.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>

<body class="chapter-page">
    <header>
        <div class="logo">
            <a href="../../index.html">
                <img src="../../src/assets/logos/logo.png" alt="DSPy Ebook Logo">
                <span>DSPy Ebook</span>
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="../../index.html">Home</a></li>
                <li><a href="../../index.html#chapters">Chapters</a></li>
                <li><a href="https://github.com/dustinober1/Ebook_DSPy" target="_blank">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <div class="chapter-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Chapter 6</h2>
                <span class="sidebar-subtitle">Real-World Apps</span>
            </div>
            <nav class="sidebar-nav">
                <ul class="section-list" id="section-list">
                    <li class="section-item" data-section="intro">
                        <a href="index.html">
                            <span class="section-number">1</span>
                            <span class="section-title">Chapter Overview</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="rag-systems">
                        <a href="rag-systems.html">
                            <span class="section-number">2</span>
                            <span class="section-title">RAG Systems</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="multi-hop-search">
                        <a href="multi-hop-search.html">
                            <span class="section-number">3</span>
                            <span class="section-title">Multi-hop Search</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="classification-tasks">
                        <a href="classification-tasks.html">
                            <span class="section-number">4</span>
                            <span class="section-title">Classification Tasks</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="entity-extraction">
                        <a href="entity-extraction.html">
                            <span class="section-number">5</span>
                            <span class="section-title">Entity Extraction</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="intelligent-agents">
                        <a href="intelligent-agents.html">
                            <span class="section-number">6</span>
                            <span class="section-title">Intelligent Agents</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="code-generation">
                        <a href="code-generation.html">
                            <span class="section-number">7</span>
                            <span class="section-title">Code Generation</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="perspective-driven-research">
                        <a href="perspective-driven-research.html">
                            <span class="section-number">8</span>
                            <span class="section-title">Perspective-Driven Research</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="extreme-multilabel-classification">
                        <a href="extreme-multilabel-classification.html">
                            <span class="section-number">9</span>
                            <span class="section-title">Extreme Multilabel Classification</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="long-form-generation">
                        <a href="long-form-generation.html">
                            <span class="section-number">10</span>
                            <span class="section-title">Long Form Generation</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="outline-generation">
                        <a href="outline-generation.html">
                            <span class="section-number">11</span>
                            <span class="section-title">Outline Generation</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="extreme-few-shot-learning">
                        <a href="extreme-few-shot-learning.html">
                            <span class="section-number">12</span>
                            <span class="section-title">Extreme Few-Shot Learning</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="ir-model-training-scratch">
                        <a href="ir-model-training-scratch.html">
                            <span class="section-number">13</span>
                            <span class="section-title">IR Model Training</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="lingvarbench-healthcare-synthetic-data">
                        <a href="lingvarbench-healthcare-synthetic-data.html">
                            <span class="section-number">14</span>
                            <span class="section-title">LingVarBench & Healthcare</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="scientific-figure-caption-generation">
                        <a href="scientific-figure-caption-generation.html">
                            <span class="section-number">15</span>
                            <span class="section-title">Scientific Figure Captions</span>
                        </a>
                    </li>
                    <li class="section-item active" data-section="retrieval-augmented-guardrails">
                        <a href="retrieval-augmented-guardrails.html">
                            <span class="section-number">16</span>
                            <span class="section-title">Retrieval Augmented Guardrails</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="exercises">
                        <a href="exercises.html">
                            <span class="section-number">20</span>
                            <span class="section-title">Exercises</span>
                        </a>
                    </li>
                    <li class="section-item" data-section="solutions">
                        <a href="solutions.html">
                            <span class="section-number">21</span>
                            <span class="section-title">Solutions</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="../chapter-07/index.html" class="next-chapter-btn">
                    Next: Chapter 07 â†’
                </a>
            </div>
        </aside>

        <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle Sidebar">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <main class="chapter-content">
            <div class="reading-progress" id="reading-progress">
                <div class="progress-bar"></div>
            </div>

            <section class="chapter-hero">
                <div class="chapter-hero-content is-visible fade-in-up">
                    <span class="chapter-label">Chapter 6</span>
                    <h1 class="chapter-title">Retrieval Augmented Guardrails</h1>
                    <p class="chapter-description">Enhancing AI safety in high-stakes domains by evaluating outputs
                        against retrieved historical contexts and similar cases.</p>
                </div>
            </section>

            <div class="content-wrapper">
                <article class="content-article" id="content-article">
                    <section class="content-section is-visible" id="retrieval-augmented-guardrails"
                        data-section="retrieval-augmented-guardrails">
                        <div class="markdown-content">

                            <!-- Overview -->
                            <div class="content-block">
                                <h2>Why Retrieval for Guardrails?</h2>
                                <p>Standard AI guardrails often check outputs against static rules ("Do not mention X").
                                    In complex fields like healthcare, this isn't enough. An answer might be safe in one
                                    context but dangerous in another.</p>
                                <p>Retrieval-Augmented Guardrails improve safety by retrieving <strong>similar past
                                        cases</strong> (e.g., previous patient messages and clinician responses) to use
                                    as a "ground truth" reference for evaluating the current output.</p>
                            </div>

                            <!-- Architecture -->
                            <div class="content-block">
                                <h2>The Evaluation Pipeline</h2>
                                <p>This system acts as a sophisticated judge:</p>
                                <ol type="1">
                                    <li><strong>Retrieve:</strong> Find historically similar interactions.</li>
                                    <li><strong>Compare:</strong> Use an <code>ErrorClassifier</code> module to check if
                                        the new AI response deviates from the clinical standards established in those
                                        historical examples.</li>
                                    <li><strong>Assess Severity:</strong> If an error is found, determine if it's a
                                        minor tone issue or a critical safety risk.</li>
                                </ol>

                                <h3>Implementation</h3>
                                <div class="command-box">
                                    <pre><code class="language-python">class RetrievalAugmentedEvaluator(dspy.Module):
    def forward(self, patient_message, ai_response):
        # 1. Get context
        similar_cases = self.retriever(query=patient_message, k=3)
        
        # 2. Check for errors against that context
        classification = self.error_classifier(
            message=patient_message,
            response=ai_response,
            context=similar_cases
        )
        
        return classification</code></pre>
                                </div>
                            </div>

                            <!-- Results -->
                            <div class="content-block">
                                <h2>Performance Gains</h2>
                                <p>Adding retrieval to the guardrail system resulted in:</p>
                                <ul>
                                    <li><strong>50% higher concordance</strong> with human reviewers compared to
                                        non-retrieval baselines.</li>
                                    <li><strong>42% better identification</strong> of safety concerns.</li>
                                </ul>
                            </div>

                            <!-- Next Steps -->
                            <div class="content-block">
                                <div class="continue-btn-container">
                                    <a href="graphrag-wikipedia-tidb-tutorial.html" class="continue-btn">
                                        <span>Next: GraphRAG with TiDB</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M5 12h14M12 5l7 7-7 7" />
                                        </svg>
                                    </a>
                                </div>
                            </div>

                        </div>
                    </section>
                </article>
            </div>
        </main>
    </div>

    <footer>
        <p>&copy; 2025 DSPy Ebook. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="../../assets/js/main.js?v=2"></script>
    <script src="../../assets/js/chapter_v2.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.initChapter) {
                window.initChapter({});
            }
            setTimeout(() => {
                if (window.Prism) window.Prism.highlightAll();
            }, 100);
        });
    </script>
</body>

</html>