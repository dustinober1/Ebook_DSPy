<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solutions | Chapter 4 | DSPy: The Comprehensive Guide</title>
    <meta name="description"
        content="Complete solutions for Chapter 4 exercises - metrics, datasets, and optimization implementations.">
    <link rel="stylesheet" href="../../assets/css/style.css?v=2">
    <link rel="stylesheet" href="../../assets/css/chapter.css?v=8">
    <link rel="stylesheet" href="../../assets/css/content.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>

<body class="chapter-page">
    <header>
        <div class="logo">
            <a href="../../index.html">
                <img src="../../src/assets/logos/logo.png" alt="DSPy Ebook Logo">
                <span>DSPy Ebook</span>
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="../../index.html">Home</a></li>
                <li><a href="../../index.html#chapters">Chapters</a></li>
                <li><a href="https://github.com/dustinober1/Ebook_DSPy" target="_blank">GitHub</a></li>
            </ul>
        </nav>
    </header>

    <div class="chapter-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Chapter 4</h2>
                <span class="sidebar-subtitle">Optimizers</span>
            </div>
            <nav class="sidebar-nav">
                <ul class="section-list" id="section-list">
                    <li class="section-item viewed" data-section="intro">
                        <a href="index.html">
                            <span class="section-number">1</span>
                            <span class="section-title">Chapter Overview</span>
                        </a>
                    </li>
                    <li class="section-item viewed" data-section="why-optimize">
                        <a href="why-optimize.html">
                            <span class="section-number">2</span>
                            <span class="section-title">Why Optimize?</span>
                        </a>
                    </li>
                    <li class="section-item viewed" data-section="metrics">
                        <a href="metrics.html">
                            <span class="section-number">3</span>
                            <span class="section-title">Metrics & Evaluation</span>
                        </a>
                    </li>
                    <li class="section-item viewed" data-section="bootstrap-fewshot">
                        <a href="bootstrap-fewshot.html">
                            <span class="section-number">4</span>
                            <span class="section-title">BootstrapFewShot</span>
                        </a>
                    </li>
                    <li class="section-item viewed" data-section="advanced-optimizers">
                        <a href="advanced-optimizers.html">
                            <span class="section-number">5</span>
                            <span class="section-title">Advanced Optimizers</span>
                        </a>
                    </li>
                    <li class="section-item viewed" data-section="exercises">
                        <a href="exercises.html">
                            <span class="section-number">6</span>
                            <span class="section-title">Exercises</span>
                        </a>
                    </li>
                    <li class="section-item active" data-section="solutions">
                        <a href="solutions.html">
                            <span class="section-number">7</span>
                            <span class="section-title">Solutions</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="../chapter-05/index.html" class="next-chapter-btn">
                    Next: Chapter 05 ‚Üí
                </a>
            </div>
        </aside>

        <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle Sidebar">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <main class="chapter-content">
            <div class="reading-progress" id="reading-progress">
                <div class="progress-bar"></div>
            </div>

            <section class="chapter-hero">
                <div class="chapter-hero-content is-visible fade-in-up">
                    <span class="chapter-label">Chapter 4 ¬∑ Section 7</span>
                    <h1 class="chapter-title">Solutions</h1>
                    <p class="chapter-description">Complete solutions with explanations for all Chapter 4 exercises.
                    </p>
                    <div class="chapter-meta">
                        <span class="meta-item">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            5 Solutions
                        </span>
                    </div>
                </div>
            </section>

            <div class="content-wrapper">
                <article class="content-article" id="content-article">
                    <section class="content-section is-visible" id="solutions" data-section="solutions">
                        <div class="markdown-content" id="solutions-content">

                            <!-- Warning -->
                            <div class="content-block">
                                <div class="tip-box warning">
                                    <span class="tip-icon">‚ö†Ô∏è</span>
                                    <p><strong>Spoiler Alert!</strong> Try to complete the exercises on your own before
                                        viewing these solutions.</p>
                                </div>
                            </div>

                            <!-- Solution 1 -->
                            <div class="content-block solution-block">
                                <div class="exercise-header">
                                    <span class="exercise-number">Solution 1</span>
                                    <span class="difficulty beginner">‚≠ê Beginner</span>
                                </div>
                                <h3>Write Your First Metric</h3>

                                <div class="command-box">
                                    <pre><code class="language-python">def exact_match(example, pred, trace=None):
    """Case-insensitive exact match."""
    expected = example.answer.strip().lower()
    predicted = pred.answer.strip().lower()
    return expected == predicted


def contains_answer(example, pred, trace=None):
    """Check if expected answer appears in prediction."""
    expected = example.answer.strip().lower()
    predicted = pred.answer.strip().lower()
    return expected in predicted


def word_f1(example, pred, trace=None):
    """F1 score based on word overlap."""
    expected_words = set(example.answer.lower().split())
    predicted_words = set(pred.answer.lower().split())
    
    if not expected_words or not predicted_words:
        return 0.0
    
    intersection = expected_words & predicted_words
    
    precision = len(intersection) / len(predicted_words)
    recall = len(intersection) / len(expected_words)
    
    if precision + recall == 0:
        return 0.0
    
    return 2 * (precision * recall) / (precision + recall)


# Test the metrics
class MockExample:
    def __init__(self, answer):
        self.answer = answer

class MockPred:
    def __init__(self, answer):
        self.answer = answer

test_cases = [
    ("Paris", "Paris"),
    ("Paris", "The answer is Paris"),
    ("William Shakespeare", "Shakespeare"),
]

print("Testing Metrics")
print("=" * 50)

for expected, predicted in test_cases:
    example = MockExample(expected)
    pred = MockPred(predicted)
    
    print(f"\nExpected: '{expected}' | Predicted: '{predicted}'")
    print(f"  exact_match: {exact_match(example, pred)}")
    print(f"  contains_answer: {contains_answer(example, pred)}")
    print(f"  word_f1: {word_f1(example, pred):.2f}")</code></pre>
                                </div>

                                <div class="chapter-sections-list">
                                    <div class="chapter-section-item">
                                        <span class="section-icon">üí°</span>
                                        <div class="section-content">
                                            <h4>Key Insight</h4>
                                            <p>Different metrics capture different aspects of correctness. Choose based
                                                on your task requirements.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Solution 2 -->
                            <div class="content-block solution-block">
                                <div class="exercise-header">
                                    <span class="exercise-number">Solution 2</span>
                                    <span class="difficulty beginner">‚≠ê Beginner</span>
                                </div>
                                <h3>Create a Training Dataset</h3>

                                <div class="command-box">
                                    <pre><code class="language-python">import dspy
import random

# Technology examples
tech_examples = [
    dspy.Example(
        text="Apple announced a new smartphone featuring an advanced AI chip.",
        topic="technology"
    ).with_inputs("text"),
    dspy.Example(
        text="The latest software update includes improved security features.",
        topic="technology"
    ).with_inputs("text"),
    dspy.Example(
        text="Cloud computing services are becoming increasingly popular.",
        topic="technology"
    ).with_inputs("text"),
    dspy.Example(
        text="Researchers developed a new machine learning algorithm.",
        topic="technology"
    ).with_inputs("text"),
    dspy.Example(
        text="The company unveiled its next-generation electric vehicle.",
        topic="technology"
    ).with_inputs("text"),
]

# Sports examples
sports_examples = [
    dspy.Example(
        text="The team won the championship after a thrilling final match.",
        topic="sports"
    ).with_inputs("text"),
    dspy.Example(
        text="The star player signed a new contract worth millions.",
        topic="sports"
    ).with_inputs("text"),
    dspy.Example(
        text="The Olympics will feature several new events this year.",
        topic="sports"
    ).with_inputs("text"),
    dspy.Example(
        text="The coach announced changes to the starting lineup.",
        topic="sports"
    ).with_inputs("text"),
    dspy.Example(
        text="The marathon runner broke the world record yesterday.",
        topic="sports"
    ).with_inputs("text"),
]

# Politics examples
politics_examples = [
    dspy.Example(
        text="The president announced new economic policies today.",
        topic="politics"
    ).with_inputs("text"),
    dspy.Example(
        text="Congress passed a new bill on healthcare reform.",
        topic="politics"
    ).with_inputs("text"),
    dspy.Example(
        text="The election results showed a close race between candidates.",
        topic="politics"
    ).with_inputs("text"),
    dspy.Example(
        text="International leaders met to discuss climate agreements.",
        topic="politics"
    ).with_inputs("text"),
    dspy.Example(
        text="The senator proposed new legislation on immigration.",
        topic="politics"
    ).with_inputs("text"),
]

# Combine all examples
all_examples = tech_examples + sports_examples + politics_examples

# Shuffle
random.shuffle(all_examples)

# Split into train (10) and dev (5)
trainset = all_examples[:10]
devset = all_examples[10:]

print(f"Training set: {len(trainset)} examples")
print(f"Dev set: {len(devset)} examples")

# Verify distribution
for split_name, split in [("Train", trainset), ("Dev", devset)]:
    topics = [ex.topic for ex in split]
    print(f"\n{split_name} distribution:")
    for topic in ["technology", "sports", "politics"]:
        count = topics.count(topic)
        print(f"  {topic}: {count}")</code></pre>
                                </div>
                            </div>

                            <!-- Solution 3 -->
                            <div class="content-block solution-block">
                                <div class="exercise-header">
                                    <span class="exercise-number">Solution 3</span>
                                    <span class="difficulty intermediate">‚≠ê‚≠ê Intermediate</span>
                                </div>
                                <h3>Basic BootstrapFewShot Optimization</h3>

                                <div class="command-box">
                                    <pre><code class="language-python">import dspy
from dspy.evaluate import Evaluate
from dotenv import load_dotenv
import random

load_dotenv()

# Configure
lm = dspy.LM("openai/gpt-4o-mini")
dspy.configure(lm=lm)

# Signature
class SentimentAnalysis(dspy.Signature):
    """Classify the sentiment of the text as positive, negative, or neutral."""
    text: str = dspy.InputField()
    sentiment: str = dspy.OutputField(desc="positive, negative, or neutral")

# Training data
examples = [
    dspy.Example(text="I love this product! Best purchase ever!", sentiment="positive"),
    dspy.Example(text="Terrible quality. Complete waste of money.", sentiment="negative"),
    dspy.Example(text="It's okay, nothing special.", sentiment="neutral"),
    dspy.Example(text="Amazing experience, highly recommend!", sentiment="positive"),
    dspy.Example(text="Worst customer service I've ever had.", sentiment="negative"),
    dspy.Example(text="Works as expected, no issues.", sentiment="neutral"),
    dspy.Example(text="Exceeded all my expectations!", sentiment="positive"),
    dspy.Example(text="Broke after one week. Very disappointed.", sentiment="negative"),
    dspy.Example(text="Average product for the price.", sentiment="neutral"),
    dspy.Example(text="Absolutely fantastic quality!", sentiment="positive"),
    dspy.Example(text="Would not recommend to anyone.", sentiment="negative"),
    dspy.Example(text="It does the job, nothing more.", sentiment="neutral"),
]

# Add inputs marker
for ex in examples:
    ex._input_keys = {"text"}

# Split
random.shuffle(examples)
trainset = examples[:9]
devset = examples[9:]

# Metric
def sentiment_metric(example, pred, trace=None):
    return pred.sentiment.strip().lower() == example.sentiment.strip().lower()

# Create module
classifier = dspy.Predict(SentimentAnalysis)

# Evaluate baseline
print("Evaluating Baseline...")
evaluator = Evaluate(devset=devset, metric=sentiment_metric, display_progress=True)
baseline_score = evaluator(classifier)
print(f"Baseline accuracy: {baseline_score:.2%}")

# Optimize
print("\nOptimizing...")
optimizer = dspy.BootstrapFewShot(
    metric=sentiment_metric,
    max_bootstrapped_demos=3,
    max_labeled_demos=3
)
optimized_classifier = optimizer.compile(classifier, trainset=trainset)

# Evaluate optimized
print("Evaluating Optimized...")
optimized_score = evaluator(optimized_classifier)
print(f"Optimized accuracy: {optimized_score:.2%}")

# Report
print("\n" + "=" * 50)
print("RESULTS")
print("=" * 50)
print(f"Baseline:    {baseline_score:.2%}")
print(f"Optimized:   {optimized_score:.2%}")
print(f"Improvement: {(optimized_score - baseline_score):.2%}")

# Save
optimized_classifier.save("optimized_sentiment_classifier.json")
print("\n‚úì Saved optimized module to 'optimized_sentiment_classifier.json'")</code></pre>
                                </div>
                            </div>

                            <!-- Solution 4 -->
                            <div class="content-block solution-block">
                                <div class="exercise-header">
                                    <span class="exercise-number">Solution 4</span>
                                    <span class="difficulty intermediate">‚≠ê‚≠ê Intermediate</span>
                                </div>
                                <h3>LM-as-Judge Metric</h3>

                                <div class="command-box">
                                    <pre><code class="language-python">import dspy
from dotenv import load_dotenv

load_dotenv()

lm = dspy.LM("openai/gpt-4o-mini")
dspy.configure(lm=lm)

# Judge signature
class SummaryEvaluator(dspy.Signature):
    """Evaluate the quality of a summary."""
    original_text: str = dspy.InputField()
    summary: str = dspy.InputField()
    accuracy: float = dspy.OutputField(
        desc="How accurately the summary reflects the original (0.0-1.0)"
    )
    completeness: float = dspy.OutputField(
        desc="How completely the summary covers key points (0.0-1.0)"
    )
    conciseness: float = dspy.OutputField(
        desc="How concise the summary is without losing meaning (0.0-1.0)"
    )

# Create judge
judge = dspy.ChainOfThought(SummaryEvaluator)

def summary_quality_metric(example, pred, trace=None):
    """LM-as-judge metric for summary quality."""
    try:
        evaluation = judge(
            original_text=example.text,
            summary=pred.summary
        )
        
        # Convert to floats and clamp to 0-1
        accuracy = max(0.0, min(1.0, float(evaluation.accuracy)))
        completeness = max(0.0, min(1.0, float(evaluation.completeness)))
        conciseness = max(0.0, min(1.0, float(evaluation.conciseness)))
        
        # Return average score
        return (accuracy + completeness + conciseness) / 3
        
    except Exception as e:
        print(f"Evaluation error: {e}")
        return 0.0

# Test the metric
class MockExample:
    def __init__(self, text):
        self.text = text

class MockPred:
    def __init__(self, summary):
        self.summary = summary

# Test cases
test_cases = [
    {
        "text": """
        Machine learning is a subset of artificial intelligence that enables 
        computers to learn from data without being explicitly programmed. 
        It uses algorithms to identify patterns and make predictions. 
        Common applications include image recognition, natural language 
        processing, and recommendation systems.
        """,
        "summary": "Machine learning allows computers to learn from data and make predictions using algorithms."
    },
    {
        "text": """
        The Eiffel Tower is a wrought-iron lattice tower in Paris, France. 
        It was constructed from 1887 to 1889 and stands 330 meters tall. 
        Named after engineer Gustave Eiffel, it has become a global cultural 
        icon of France and one of the most recognizable structures in the world.
        """,
        "summary": "Tower in Paris."
    },
    {
        "text": """
        Climate change is causing rising sea levels, more extreme weather events, 
        and shifts in ecosystems worldwide. Scientists agree that human activities, 
        particularly the burning of fossil fuels, are the primary cause.
        """,
        "summary": "Climate change, driven by human fossil fuel use, causes rising seas, extreme weather, and ecosystem changes globally."
    }
]

print("Testing LM-as-Judge Metric")
print("=" * 60)

for i, case in enumerate(test_cases, 1):
    example = MockExample(case["text"])
    pred = MockPred(case["summary"])
    
    score = summary_quality_metric(example, pred)
    
    print(f"\nTest {i}:")
    print(f"Summary: {case['summary'][:60]}...")
    print(f"Quality Score: {score:.2f}")</code></pre>
                                </div>
                            </div>

                            <!-- Solution 5 -->
                            <div class="content-block solution-block">
                                <div class="exercise-header">
                                    <span class="exercise-number">Solution 5</span>
                                    <span class="difficulty advanced">‚≠ê‚≠ê‚≠ê Advanced</span>
                                </div>
                                <h3>Complete Optimization Pipeline</h3>

                                <div class="command-box">
                                    <pre><code class="language-python">import dspy
from dspy.evaluate import Evaluate
from dspy.teleprompt import BootstrapFewShotWithRandomSearch
from dotenv import load_dotenv
import random

load_dotenv()

# Configure
lm = dspy.LM("openai/gpt-4o-mini")
dspy.configure(lm=lm)

print("=" * 60)
print("COMPLETE OPTIMIZATION PIPELINE")
print("=" * 60)

# ============================================
# Step 1: Data Preparation
# ============================================
print("\nüìä Step 1: Preparing Data...")

raw_data = [
    {"context": "Paris is the capital of France.", "question": "What is the capital of France?", "answer": "Paris"},
    {"context": "Python was created by Guido van Rossum in 1991.", "question": "Who created Python?", "answer": "Guido van Rossum"},
    {"context": "The Earth orbits the Sun.", "question": "What does Earth orbit?", "answer": "The Sun"},
    {"context": "Water boils at 100 degrees Celsius.", "question": "At what temperature does water boil?", "answer": "100 degrees Celsius"},
    {"context": "The Great Wall of China is over 13,000 miles long.", "question": "How long is the Great Wall?", "answer": "Over 13,000 miles"},
    {"context": "Shakespeare wrote Romeo and Juliet.", "question": "Who wrote Romeo and Juliet?", "answer": "Shakespeare"},
    {"context": "The Amazon is the largest rainforest.", "question": "What is the largest rainforest?", "answer": "The Amazon"},
    {"context": "Einstein developed the theory of relativity.", "question": "Who developed relativity?", "answer": "Einstein"},
    {"context": "Mount Everest is the tallest mountain.", "question": "What is the tallest mountain?", "answer": "Mount Everest"},
    {"context": "The Pacific is the largest ocean.", "question": "What is the largest ocean?", "answer": "The Pacific"},
    {"context": "DNA stands for deoxyribonucleic acid.", "question": "What does DNA stand for?", "answer": "Deoxyribonucleic acid"},
    {"context": "The Nile is the longest river.", "question": "What is the longest river?", "answer": "The Nile"},
    {"context": "Mars is called the Red Planet.", "question": "What is Mars called?", "answer": "The Red Planet"},
    {"context": "The heart pumps blood.", "question": "What does the heart do?", "answer": "Pumps blood"},
    {"context": "Tokyo is the capital of Japan.", "question": "What is the capital of Japan?", "answer": "Tokyo"},
    {"context": "Beethoven composed nine symphonies.", "question": "How many symphonies did Beethoven compose?", "answer": "Nine"},
    {"context": "Light travels at 299,792 km/s.", "question": "How fast does light travel?", "answer": "299,792 km/s"},
    {"context": "Oxygen makes up 21% of the atmosphere.", "question": "What percentage of atmosphere is oxygen?", "answer": "21%"},
    {"context": "The Mona Lisa was painted by da Vinci.", "question": "Who painted the Mona Lisa?", "answer": "Da Vinci"},
    {"context": "Diamonds are made of carbon.", "question": "What are diamonds made of?", "answer": "Carbon"},
]

# Convert to DSPy examples
examples = [
    dspy.Example(
        context=d["context"],
        question=d["question"],
        answer=d["answer"]
    ).with_inputs("context", "question")
    for d in raw_data
]

# Split
random.shuffle(examples)
trainset = examples[:14]
devset = examples[14:17]
testset = examples[17:]

print(f"  Train: {len(trainset)} | Dev: {len(devset)} | Test: {len(testset)}")

# ============================================
# Step 2: Module Creation
# ============================================
print("\nüß© Step 2: Creating Module...")

class QA(dspy.Signature):
    """Answer the question based on the context."""
    context: str = dspy.InputField()
    question: str = dspy.InputField()
    answer: str = dspy.OutputField()

qa_module = dspy.ChainOfThought(QA)
print("  ‚úì ChainOfThought QA module created")

# ============================================
# Step 3: Metrics
# ============================================
print("\nüìè Step 3: Defining Metrics...")

def exact_match(example, pred, trace=None):
    return pred.answer.strip().lower() == example.answer.strip().lower()

def word_overlap(example, pred, trace=None):
    expected = set(example.answer.lower().split())
    predicted = set(pred.answer.lower().split())
    if not expected or not predicted:
        return 0.0
    intersection = expected & predicted
    return len(intersection) / len(expected)

print("  ‚úì exact_match and word_overlap metrics defined")

# ============================================
# Step 4: Baseline Evaluation
# ============================================
print("\nüìä Step 4: Evaluating Baseline...")

evaluator_em = Evaluate(devset=devset, metric=exact_match, display_progress=False)
evaluator_wo = Evaluate(devset=devset, metric=word_overlap, display_progress=False)

baseline_em = evaluator_em(qa_module)
baseline_wo = evaluator_wo(qa_module)

print(f"  Baseline Exact Match: {baseline_em:.2%}")
print(f"  Baseline Word Overlap: {baseline_wo:.2%}")

# ============================================
# Step 5: BootstrapFewShot
# ============================================
print("\nüöÄ Step 5: BootstrapFewShot Optimization...")

optimizer1 = dspy.BootstrapFewShot(
    metric=exact_match,
    max_bootstrapped_demos=3
)
bootstrap_module = optimizer1.compile(qa_module, trainset=trainset)

bs_em = evaluator_em(bootstrap_module)
bs_wo = evaluator_wo(bootstrap_module)

print(f"  BootstrapFewShot Exact Match: {bs_em:.2%}")
print(f"  BootstrapFewShot Word Overlap: {bs_wo:.2%}")

# ============================================
# Step 6: BootstrapFewShotWithRandomSearch
# ============================================
print("\nüé≤ Step 6: RandomSearch Optimization...")

optimizer2 = BootstrapFewShotWithRandomSearch(
    metric=exact_match,
    max_bootstrapped_demos=3,
    num_candidate_programs=5,
    num_threads=2
)
random_search_module = optimizer2.compile(
    qa_module,
    trainset=trainset,
    valset=devset
)

rs_em = evaluator_em(random_search_module)
rs_wo = evaluator_wo(random_search_module)

print(f"  RandomSearch Exact Match: {rs_em:.2%}")
print(f"  RandomSearch Word Overlap: {rs_wo:.2%}")

# ============================================
# Step 7: Final Test Evaluation
# ============================================
print("\n‚úÖ Step 7: Final Test Set Evaluation...")

test_evaluator_em = Evaluate(devset=testset, metric=exact_match, display_progress=False)
test_evaluator_wo = Evaluate(devset=testset, metric=word_overlap, display_progress=False)

best_module = random_search_module if rs_em >= bs_em else bootstrap_module
best_name = "RandomSearch" if rs_em >= bs_em else "BootstrapFewShot"

final_em = test_evaluator_em(best_module)
final_wo = test_evaluator_wo(best_module)

# ============================================
# Results Summary
# ============================================
print("\n" + "=" * 60)
print("RESULTS SUMMARY")
print("=" * 60)

print("\n| Approach              | Exact Match | Word Overlap |")
print("|----------------------|-------------|--------------|")
print(f"| Baseline             | {baseline_em:>10.2%} | {baseline_wo:>11.2%} |")
print(f"| BootstrapFewShot     | {bs_em:>10.2%} | {bs_wo:>11.2%} |")
print(f"| RandomSearch         | {rs_em:>10.2%} | {rs_wo:>11.2%} |")
print(f"| Final Test ({best_name[:8]}) | {final_em:>10.2%} | {final_wo:>11.2%} |")

# Save best module
best_module.save("best_qa_module.json")
print(f"\nüíæ Saved best module ({best_name}) to 'best_qa_module.json'")

# Sample predictions
print("\nüìã Sample Predictions from Best Model:")
for ex in testset[:2]:
    result = best_module(context=ex.context, question=ex.question)
    print(f"\n  Q: {ex.question}")
    print(f"  Expected: {ex.answer}")
    print(f"  Predicted: {result.answer}")</code></pre>
                                </div>
                            </div>

                            <!-- Summary -->
                            <div class="content-block summary-block">
                                <h2>üìù Chapter Summary</h2>

                                <p>In this chapter, you learned:</p>

                                <div class="chapter-sections-list no-icons">
                                    <div class="chapter-section-item">
                                        <div class="section-content">
                                            <p><strong>Metrics define success</strong> ‚Äî optimizers maximize your
                                                metric</p>
                                        </div>
                                    </div>
                                    <div class="chapter-section-item">
                                        <div class="section-content">
                                            <p><strong>Training data</strong> ‚Äî dspy.Example with .with_inputs()</p>
                                        </div>
                                    </div>
                                    <div class="chapter-section-item">
                                        <div class="section-content">
                                            <p><strong>BootstrapFewShot</strong> ‚Äî finds successful examples as demos
                                            </p>
                                        </div>
                                    </div>
                                    <div class="chapter-section-item">
                                        <div class="section-content">
                                            <p><strong>Advanced optimizers</strong> ‚Äî MIPRO, COPRO, BootstrapFinetune
                                            </p>
                                        </div>
                                    </div>
                                    <div class="chapter-section-item">
                                        <div class="section-content">
                                            <p><strong>Always save</strong> optimized modules for production</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Continue to Chapter 5 -->
                            <div class="content-block">
                                <div class="success-content">
                                    <span class="success-icon-large">üéâ</span>
                                    <h2>Congratulations!</h2>
                                    <p>You've completed Chapter 4: Optimizers! You now know how to automatically
                                        improve your DSPy programs.</p>
                                </div>
                                <div class="continue-btn-container">
                                    <a href="../chapter-05/index.html" class="continue-btn next-chapter-main-btn">
                                        <span>Start Chapter 5: Retrieval</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M5 12h14M12 5l7 7-7 7" />
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </section>
                </article>
            </div>
        </main>
    </div>

    <footer>
        <p>&copy; 2025 DSPy Ebook. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="../../assets/js/main.js?v=1"></script>
    <script src="../../assets/js/chapter_v2.js" defer></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (window.initChapter) {
                window.initChapter({});
            }
            setTimeout(() => {
                if (window.Prism) window.Prism.highlightAll();
            }, 100);
        });
    </script>
</body>

</html>