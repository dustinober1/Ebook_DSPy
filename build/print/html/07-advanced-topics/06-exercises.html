<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Exercises - DSPy: A Practical Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The most comprehensive DSPy guide with complete coverage of 9 research papers, advanced optimization techniques, and production-ready applications">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../assets/print-only-ef201963.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-4ea68664.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">DSPy: A Practical Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="chapter-7-exercises-advanced-topics-mastery"><a class="header" href="#chapter-7-exercises-advanced-topics-mastery">Chapter 7 Exercises: Advanced Topics Mastery</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>These exercises challenge you to apply advanced DSPy concepts to solve complex, real-world problems. You’ll work with adapters, performance optimization, async programming, debugging, and deployment strategies to build production-ready applications.</p>
<h2 id="exercise-1-build-a-custom-database-adapter"><a class="header" href="#exercise-1-build-a-custom-database-adapter">Exercise 1: Build a Custom Database Adapter</a></h2>
<h3 id="objective"><a class="header" href="#objective">Objective</a></h3>
<p>Create a comprehensive database adapter for DSPy that can work with PostgreSQL and provide caching functionality.</p>
<h3 id="problem"><a class="header" href="#problem">Problem</a></h3>
<p>You need to build a database adapter that can store and retrieve DSPy predictions, handle connections efficiently, and provide automatic caching for frequently accessed data.</p>
<h3 id="starter-code"><a class="header" href="#starter-code">Starter Code</a></h3>
<pre><code class="language-python">import dspy
from typing import Any, Dict, List, Optional
import psycopg2
from psycopg2.pool import ThreadedConnectionPool
import json
import time

class DatabaseAdapter(dspy.Adapter):
    """TODO: Implement database adapter for DSPy."""

    def __init__(self, connection_string, pool_size=5):
        super().__init__()
        self.connection_string = connection_string
        self.pool_size = pool_size
        # TODO: Initialize connection pool and cache

    def store_prediction(self, prediction_id: str, prediction: dspy.Prediction):
        """TODO: Store prediction in database."""
        pass

    def get_prediction(self, prediction_id: str) -&gt; Optional[dspy.Prediction]:
        """TODO: Retrieve prediction from database."""
        pass

    def search_predictions(self, query: Dict[str, Any], limit: int = 10) -&gt; List[dspy.Prediction]:
        """TODO: Search predictions based on criteria."""
        pass

    def close(self):
        """TODO: Close all database connections."""
        pass

# TODO: Implement this function
def create_database_adapter(config: Dict[str, Any]) -&gt; DatabaseAdapter:
    """Create and configure database adapter."""
    pass
</code></pre>
<h3 id="tasks"><a class="header" href="#tasks">Tasks</a></h3>
<ol>
<li>Implement connection pooling with ThreadedConnectionPool</li>
<li>Add automatic caching with a configurable TTL</li>
<li>Implement table schema for storing DSPy predictions</li>
<li>Add search functionality with flexible query support</li>
<li>Implement connection health checks and auto-reconnection</li>
<li>Add metrics for monitoring performance</li>
</ol>
<h3 id="hints"><a class="header" href="#hints">Hints</a></h3>
<ul>
<li>Use context managers for safe database operations</li>
<li>Implement connection retry logic with exponential backoff</li>
<li>Store predictions as JSON in the database</li>
<li>Consider adding indexes for better query performance</li>
</ul>
<h3 id="expected-output"><a class="header" href="#expected-output">Expected Output</a></h3>
<pre><code>Database Adapter Statistics:
- Connections: 5/5
- Cache size: 45 entries
- Cache hit rate: 78%
- Average query time: 12ms
- Stored predictions: 156
</code></pre>
<hr>
<h2 id="exercise-2-implement-a-high-performance-caching-system"><a class="header" href="#exercise-2-implement-a-high-performance-caching-system">Exercise 2: Implement a High-Performance Caching System</a></h2>
<h3 id="objective-1"><a class="header" href="#objective-1">Objective</a></h3>
<p>Create a multi-level caching system with L1 (memory), L2 (Redis), and L3 (disk) layers, with intelligent cache promotion and eviction policies.</p>
<h3 id="problem-1"><a class="header" href="#problem-1">Problem</a></h3>
<p>You need to build a caching system that can handle high-throughput DSPy operations with minimal latency and maximum cache hit rates.</p>
<h3 id="starter-code-1"><a class="header" href="#starter-code-1">Starter Code</a></h3>
<pre><code class="language-python">import dspy
import redis
import pickle
import os
from typing import Any, Optional, Dict
import hashlib
import time

class AdvancedCacheSystem:
    """TODO: Implement multi-level caching system."""

    def __init__(self, config: Dict[str, Any]):
        super().__init__()
        # L1: Memory cache
        self.l1_cache = {}  # TODO: Implement LRU cache
        self.l1_size = config.get("l1_size", 1000)
        self.l1_ttl = config.get("l1_ttl", 300)

        # L2: Redis cache
        # TODO: Initialize Redis client
        self.l2_ttl = config.get("l2_ttl", 3600)

        # L3: Disk cache
        self.l3_path = config.get("l3_path", "./cache")
        self.l3_ttl = config.get("l3_ttl", 86400)

        # TODO: Initialize all cache layers

    def get(self, key: str) -&gt; Optional[Any]:
        """TODO: Get value from cache (check L1, then L2, then L3)."""
        pass

    def set(self, key: str, value: Any, ttl: Optional[int] = None):
        """TODO: Set value in all cache layers."""
        pass

    def promote_to_l1(self, key: str, value: Any):
        """TODO: Promote value to L1 cache with eviction."""
        pass

    def evict_from_l1(self):
        """TODO: Evict least recently used item from L1."""
        pass

    def get_statistics(self) -&gt; Dict[str, Any]:
        """TODO: Return cache statistics."""
        pass

# TODO: Implement this function
def benchmark_cache_system(cache: AdvancedCacheSystem):
    """Benchmark cache system performance."""
    pass
</code></pre>
<h3 id="tasks-1"><a class="header" href="#tasks-1">Tasks</a></h3>
<ol>
<li>Implement LRU cache for L1 memory layer</li>
<li>Set up Redis connection for L2 cache with connection pooling</li>
<li>Implement disk-based L3 cache with size limits</li>
<li>Add intelligent promotion policies between layers</li>
<li>Implement cache warming strategies</li>
<li>Add comprehensive statistics and monitoring</li>
<li>Create performance benchmark suite</li>
</ol>
<h3 id="hints-1"><a class="header" href="#hints-1">Hints</a></h3>
<ul>
<li>Use OrderedDict for LRU implementation</li>
<li>Implement serialization/deserialization carefully</li>
<li>Add cache warming for frequently accessed data</li>
<li>Consider memory pressure when managing L1 cache</li>
</ul>
<h3 id="expected-output-1"><a class="header" href="#expected-output-1">Expected Output</a></h3>
<pre><code>Cache Performance Report:
===================
Total requests: 10,000
L1 hits: 7,234 (72.34%)
L2 hits: 2,456 (24.56%)
L3 hits: 310 (3.10%)
Cache misses: 0 (0.00%)
Average latency: 2.3ms
Total cache size: 1.2GB
</code></pre>
<hr>
<h2 id="exercise-3-build-an-async-streaming-rag-system"><a class="header" href="#exercise-3-build-an-async-streaming-rag-system">Exercise 3: Build an Async Streaming RAG System</a></h2>
<h3 id="objective-2"><a class="header" href="#objective-2">Objective</a></h3>
<p>Create an asynchronous RAG system that can handle multiple concurrent queries, process document streams, and provide real-time responses.</p>
<h3 id="problem-2"><a class="header" href="#problem-2">Problem</a></h3>
<p>You need to build a streaming RAG system that can ingest documents in real-time, handle concurrent user queries, and provide low-latency responses with proper backpressure handling.</p>
<h3 id="starter-code-2"><a class="header" href="#starter-code-2">Starter Code</a></h3>
<pre><code class="language-python">import dspy
import asyncio
import aiohttp
from typing import AsyncGenerator, List, Dict, Any, Optional
from concurrent.futures import ThreadPoolExecutor
import time

class AsyncStreamingRAG(dspy.Module):
    """TODO: Implement async streaming RAG system."""

    def __init__(self, concurrent_limit=10, stream_buffer_size=100):
        super().__init__()
        # TODO: Initialize async components
        self.concurrent_limit = concurrent_limit
        self.stream_buffer_size = stream_buffer_size

    async def ingest_document_stream(self, document_stream: AsyncGenerator[str, None]):
        """TODO: Ingest documents from stream."""
        pass

    async def query_stream(self, query_stream: AsyncGenerator[str, None]) -&gt; AsyncGenerator[Dict[str, Any], None]:
        """TODO: Process queries from stream."""
        pass

    async def batch_query(self, queries: List[str]) -&gt; List[Dict[str, Any]]:
        """TODO: Process multiple queries concurrently."""
        pass

    async def get_stats(self) -&gt; Dict[str, Any]:
        """TODO: Return system statistics."""
        pass

# TODO: Implement this function
async def simulate_real_time_usage(rag_system: AsyncStreamingRAG):
    """Simulate real-time RAG system usage."""
    pass
</code></pre>
<h3 id="tasks-2"><a class="header" href="#tasks-2">Tasks</a></h3>
<ol>
<li>Implement document stream ingestion with buffering</li>
<li>Create concurrent query processing with semaphore control</li>
<li>Add backpressure handling for high throughput</li>
<li>Implement streaming response generation</li>
<li>Add real-time statistics and monitoring</li>
<li>Create graceful degradation under load</li>
<li>Test with high-concurrency scenarios</li>
</ol>
<h3 id="hints-2"><a class="header" href="#hints-2">Hints</a></h3>
<ul>
<li>Use asyncio.Semaphore for concurrency control</li>
<li>Implement circular buffers for stream processing</li>
<li>Add connection pooling for external APIs</li>
<li>Consider using asyncio.gather for concurrent operations</li>
</ul>
<h3 id="expected-output-2"><a class="header" href="#expected-output-2">Expected Output</a></h3>
<pre><code>Streaming RAG System Stats:
========================
Active streams: 3
Queries processed: 1,247
Average query time: 145ms
Concurrency utilization: 75%
Buffer utilization: 60%
Error rate: 0.1%
Throughput: 43 queries/second
</code></pre>
<hr>
<h2 id="exercise-4-build-a-comprehensive-debugging-toolkit"><a class="header" href="#exercise-4-build-a-comprehensive-debugging-toolkit">Exercise 4: Build a Comprehensive Debugging Toolkit</a></h2>
<h3 id="objective-3"><a class="header" href="#objective-3">Objective</a></h3>
<p>Create a debugging toolkit that can trace DSPy execution, profile performance, identify bottlenecks, and provide insights for optimization.</p>
<h3 id="problem-3"><a class="header" href="#problem-3">Problem</a></h3>
<p>You need to build a comprehensive debugging system that can trace DSPy module execution, profile performance metrics, visualize execution graphs, and provide actionable optimization recommendations.</p>
<h3 id="starter-code-3"><a class="header" href="#starter-code-3">Starter Code</a></h3>
<pre><code class="language-python">import dspy
import time
import cProfile
import pstats
import io
import networkx as nx
import matplotlib.pyplot as plt
from typing import Dict, List, Any, Optional, Callable
from functools import wraps
import inspect

class DSPyDebugToolkit:
    """TODO: Implement comprehensive debugging toolkit."""

    def __init__(self):
        super().__init__()
        # TODO: Initialize debugging components
        self.trace_history = []
        self.profiler = None
        self.execution_graph = nx.DiGraph()
        self.performance_metrics = {}

    def trace_function(self, level: str = "info"):
        """TODO: Return decorator for function tracing."""
        pass

    def start_profiling(self, name: str):
        """TODO: Start performance profiling."""
        pass

    def stop_profiling(self) -&gt; Dict[str, Any]:
        """TODO: Stop profiling and return results."""
        pass

    def add_execution_node(self, module_name: str, operation: str, data: Dict[str, Any]):
        """TODO: Add node to execution graph."""
        pass

    def add_execution_edge(self, source: str, target: str, relationship: str):
        """TODO: Add edge to execution graph."""
        pass

    def visualize_execution(self, save_path: Optional[str] = None):
        """TODO: Visualize execution graph."""
        pass

    def analyze_performance(self) -&gt; Dict[str, Any]:
        """TODO: Analyze performance and provide insights."""
        pass

    def generate_report(self) -&gt; str:
        """TODO: Generate comprehensive debugging report."""
        pass

# TODO: Implement this function
def debug_dspy_module(module: dspy.Module, test_inputs: List[Any]) -&gt; Dict[str, Any]:
    """Debug a DSPy module comprehensively."""
    pass
</code></pre>
<h3 id="tasks-3"><a class="header" href="#tasks-3">Tasks</a></h3>
<ol>
<li>Implement function tracing decorator with different levels</li>
<li>Add performance profiling with cProfile</li>
<li>Create execution graph visualization with NetworkX</li>
<li>Implement automatic bottleneck detection</li>
<li>Add memory usage tracking</li>
<li>Create optimization recommendations engine</li>
<li>Generate comprehensive debugging reports</li>
</ol>
<h3 id="hints-3"><a class="header" href="#hints-3">Hints</a></h3>
<ul>
<li>Use functools.wraps for decorator implementation</li>
<li>Implement hierarchical trace levels</li>
<li>Use NetworkX for graph visualization</li>
<li>Consider using memory_profiler for memory tracking</li>
</ul>
<h3 id="expected-output-3"><a class="header" href="#expected-output-3">Expected Output</a></h3>
<pre><code>DSPy Debugging Report
====================
Execution traced: 1,234 function calls
Total execution time: 2.45s
Peak memory usage: 512MB

Top 5 slowest functions:
1. retrieve_documents: 1.2s (49% of total)
2. generate_answer: 0.8s (33% of total)
3. process_context: 0.3s (12% of total)

Bottlenecks identified:
- Retrieval system needs caching
- Generate function can be optimized
- Consider async processing for I/O

Recommendations:
1. Implement LRU cache for document retrieval
2. Use batch processing for multiple queries
3. Add connection pooling for API calls
</code></pre>
<hr>
<h2 id="exercise-5-deploy-dspy-application-to-kubernetes"><a class="header" href="#exercise-5-deploy-dspy-application-to-kubernetes">Exercise 5: Deploy DSPy Application to Kubernetes</a></h2>
<h3 id="objective-4"><a class="header" href="#objective-4">Objective</a></h3>
<p>Create a complete Kubernetes deployment configuration for a DSPy application with proper resource management, autoscaling, and monitoring.</p>
<h3 id="problem-4"><a class="header" href="#problem-4">Problem</a></h3>
<p>You need to deploy a DSPy application to Kubernetes with production-grade configurations including horizontal pod autoscaling, resource limits, health checks, and monitoring setup.</p>
<h3 id="starter-code-4"><a class="header" href="#starter-code-4">Starter Code</a></h3>
<pre><code class="language-yaml"># TODO: Complete this Kubernetes manifest
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dspy-app
  namespace: dspy-prod
spec:
  replicas: 3  # TODO: Configure autoscaling
  selector:
    matchLabels:
      app: dspy-app
  template:
    metadata:
      labels:
        app: dspy-app
    spec:
      containers:
      - name: dspy-app
        image: dspy-app:latest  # TODO: Configure image
        ports:
        - containerPort: 8000
        env:
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              name: dspy-secrets
              key: openai-api-key
        # TODO: Add resource limits and requests
        # TODO: Add health checks

# TODO: Add Service, HPA, ConfigMap, Secret manifests
</code></pre>
<h3 id="tasks-4"><a class="header" href="#tasks-4">Tasks</a></h3>
<ol>
<li>Create complete deployment manifest with resource limits</li>
<li>Configure Horizontal Pod Autoscaler (HPA) with appropriate metrics</li>
<li>Add liveness and readiness probes</li>
<li>Create service with load balancer configuration</li>
<li>Set up ConfigMap for configuration management</li>
<li>Create Secret for sensitive data</li>
<li>Add monitoring with ServiceMonitor</li>
<li>Create network policies for security</li>
<li>Configure persistent volumes if needed</li>
</ol>
<h3 id="hints-4"><a class="header" href="#hints-4">Hints</a></h3>
<ul>
<li>Use appropriate resource requests and limits</li>
<li>Set meaningful health check endpoints</li>
<li>Configure HPA with custom metrics if needed</li>
<li>Use namespace isolation for different environments</li>
<li>Implement pod disruption budgets</li>
</ul>
<h3 id="expected-output-4"><a class="header" href="#expected-output-4">Expected Output</a></h3>
<pre><code>Kubernetes Deployment Status:
=========================
Namespace: dspy-prod
Deployment: dspy-app
Status: Running
Replicas: 3 (desired: 3, ready: 3, unavailable: 0)

Autoscaling:
- Min replicas: 3
- Max replicas: 20
- Current CPU: 45% (target: 70%)
- Current Memory: 60% (target: 80%)

Resources per Pod:
- CPU: 100m / 500m (20% utilization)
- Memory: 512Mi / 2Gi (25% utilization)

Health Status:
- Liveness probe: Passing
- Readiness probe: Passing
- Startup probe: Passing

Services:
- dspy-service: LoadBalancer (External IP: 203.0.113.42)
- Health endpoint: /health
</code></pre>
<hr>
<h2 id="exercise-6-implement-production-monitoring-and-alerting"><a class="header" href="#exercise-6-implement-production-monitoring-and-alerting">Exercise 6: Implement Production Monitoring and Alerting</a></h2>
<h3 id="objective-5"><a class="header" href="#objective-5">Objective</a></h3>
<p>Create a comprehensive monitoring and alerting system for a DSPy application using Prometheus, Grafana, and AlertManager.</p>
<h3 id="problem-5"><a class="header" href="#problem-5">Problem</a></h3>
<p>You need to set up monitoring that tracks key DSPy application metrics, creates meaningful dashboards, and provides proactive alerting for issues.</p>
<h3 id="starter-code-5"><a class="header" href="#starter-code-5">Starter Code</a></h3>
<pre><code class="language-python"># monitoring.py
import time
from prometheus_client import Counter, Histogram, Gauge, start_http_server
import logging
from typing import Dict, Any
import asyncio

class DSPyMonitoring:
    """TODO: Implement comprehensive monitoring."""

    def __init__(self):
        super().__init__()
        # TODO: Define Prometheus metrics
        self.metrics = {}

    def setup_metrics(self):
        """TODO: Setup Prometheus metrics."""
        pass

    def record_request(self, endpoint: str, duration: float, status: str):
        """TODO: Record request metrics."""
        pass

    def record_cache_hit(self, backend: str):
        """TODO: Record cache hit."""
        pass

    def record_token_usage(self, prompt_tokens: int, completion_tokens: int):
        """TODO: Record token usage."""
        pass

    def record_error(self, error_type: str, component: str):
        """TODO: Record error occurrence."""
        pass

# TODO: Implement this function
def setup_grafana_dashboards():
    """Setup Grafana dashboards for DSPy monitoring."""
    pass

# TODO: Implement this function
def setup_alertmanager_rules():
    """Setup AlertManager rules for proactive alerting."""
    pass
</code></pre>
<h3 id="tasks-5"><a class="header" href="#tasks-5">Tasks</a></h3>
<ol>
<li>Define comprehensive Prometheus metrics for DSPy operations</li>
<li>Create Grafana dashboard JSON configurations</li>
<li>Set up AlertManager with meaningful alert rules</li>
<li>Implement distributed tracing with Jaeger</li>
<li>Create structured logging with ELK stack</li>
<li>Add custom health checks and metrics</li>
<li>Set up log aggregation and analysis</li>
</ol>
<h3 id="hints-5"><a class="header" href="#hints-5">Hints</a></h3>
<ul>
<li>Use appropriate metric types (Counter, Histogram, Gauge)</li>
<li>Create dashboard panels for different aspects (performance, errors, usage)</li>
<li>Set up multi-level alerting (warning, critical)</li>
<li>Consider using OpenTelemetry for distributed tracing</li>
<li>Implement structured logging with correlation IDs</li>
</ul>
<h3 id="expected-output-5"><a class="header" href="#expected-output-5">Expected Output</a></h3>
<pre><code>Monitoring Setup Complete:
======================
Prometheus server: http://prometheus:9090
Grafana dashboards:
  - DSPy Overview: http://grafana:3000/d/dspy-overview
  - Performance Metrics: http://grafana:3000/d/performance
  - Error Analysis: http://grafana:3000/d/errors

Metrics Exported:
- dspy_requests_total
- dspy_request_duration_seconds
- dspy_cache_hits_total
- dspy_token_usage
- dspy_errors_total
- dspy_active_connections

AlertManager Rules:
- High error rate (&gt;5% in 5 minutes)
- High latency (P95 &gt; 2s)
- High memory usage (&gt;80%)
- API rate limiting
</code></pre>
<hr>
<h2 id="exercise-7-complete-production-grade-dspy-system"><a class="header" href="#exercise-7-complete-production-grade-dspy-system">Exercise 7: Complete Production-Grade DSPy System</a></h2>
<h3 id="objective-6"><a class="header" href="#objective-6">Objective</a></h3>
<p>Integrate all advanced concepts into a complete production-grade DSPy system with adapters, caching, async processing, debugging, and deployment.</p>
<h3 id="problem-6"><a class="header" href="#problem-6">Problem</a></h3>
<p>You need to build a complete DSPy application that demonstrates mastery of all advanced topics covered in this chapter, suitable for production deployment.</p>
<h3 id="starter-code-6"><a class="header" href="#starter-code-6">Starter Code</a></h3>
<pre><code class="language-python">import dspy
import asyncio
import logging
from typing import AsyncGenerator, Dict, Any, List, Optional

class ProductionDSPySystem:
    """TODO: Implement complete production DSPy system."""

    def __init__(self, config: Dict[str, Any]):
        super().__init__()
        self.config = config
        # TODO: Initialize all components
        # - Database adapter
        # - Cache system
        # - Monitoring
        # - Debugging toolkit
        # - Performance optimization

    async def initialize(self):
        """TODO: Initialize all system components."""
        pass

    async def process_streaming_query(self, query_stream: AsyncGenerator[str, None]) -&gt; AsyncGenerator[Dict[str, Any], None]:
        """TODO: Process streaming queries with all optimizations."""
        pass

    async def batch_process(self, queries: List[str], batch_size: int = 10) -&gt; List[Dict[str, Any]]:
        """TODO: Process batch of queries efficiently."""
        pass

    async def get_system_status(self) -&gt; Dict[str, Any]:
        """TODO: Get comprehensive system status."""
        pass

    async def shutdown(self):
        """TODO: Graceful shutdown of all components."""
        pass

# TODO: Implement this function
async def test_production_system():
    """Test production system comprehensively."""
    pass
</code></pre>
<h3 id="tasks-6"><a class="header" href="#tasks-6">Tasks</a></h3>
<ol>
<li>Integrate all previously built components</li>
<li>Implement proper error handling and recovery</li>
<li>Add comprehensive logging and monitoring</li>
<li>Create performance benchmarks</li>
<li>Implement health checks and self-healing</li>
<li>Add configuration management</li>
<li>Create deployment scripts and documentation</li>
<li>Test scalability and reliability</li>
</ol>
<h3 id="hints-6"><a class="header" href="#hints-6">Hints</a></h3>
<ul>
<li>Use dependency injection for component management</li>
<li>Implement proper async context managers</li>
<li>Add comprehensive error handling with retry logic</li>
<li>Use structured logging with correlation IDs</li>
<li>Implement circuit breakers for external services</li>
<li>Create comprehensive health checks</li>
</ul>
<h3 id="expected-output-6"><a class="header" href="#expected-output-6">Expected Output</a></h3>
<pre><code>Production DSPy System Status:
=============================
System Health: HEALTHY
Uptime: 99.99%
Last restart: 7 days ago

Component Status:
- Database Adapter: Connected (Pool: 8/10)
- Cache System: Active (L1: 89%, L2: 76%, L3: 92% hit rates)
- Monitoring: Online
- Debugging: Enabled (Verbose level)
- Performance: Optimized

Recent Metrics:
- Queries processed: 1,234,567
- Average response time: 145ms
- Error rate: 0.02%
- Throughput: 8,507 queries/hour
- Cache efficiency: 87%

Resource Usage:
- CPU: 35%
- Memory: 4.2GB
- Network: 125 Mbps
- Storage: 23.5GB

Alerts:
- None active
- Last alert: 3 days ago (High memory usage - resolved)
</code></pre>
<hr>
<h2 id="exercise-solutions-approach"><a class="header" href="#exercise-solutions-approach">Exercise Solutions Approach</a></h2>
<p>After completing these exercises, you’ll have:</p>
<ol>
<li><strong>Custom Adapters</strong>: Database integration with caching</li>
<li><strong>High-Performance Caching</strong>: Multi-level caching systems</li>
<li><strong>Async Streaming</strong>: Real-time data processing</li>
<li><strong>Debugging Tools</strong>: Comprehensive debugging capabilities</li>
<li><strong>Kubernetes Deployment</strong>: Production deployment configuration</li>
<li><strong>Monitoring Systems</strong>: Complete observability stack</li>
<li><strong>Production System</strong>: Fully integrated, production-ready application</li>
</ol>
<h3 id="key-learning-achievements"><a class="header" href="#key-learning-achievements">Key Learning Achievements</a></h3>
<ul>
<li><strong>System Integration</strong>: Combining multiple advanced techniques</li>
<li><strong>Performance Engineering</strong>: Optimizing for speed and efficiency</li>
<li><strong>Production Readiness</strong>: Understanding deployment requirements</li>
<li><strong>Observability</strong>: Comprehensive monitoring and debugging</li>
<li><strong>Scalability</strong>: Building systems that handle growth</li>
<li><strong>Reliability</strong>: Implementing robust error handling</li>
</ul>
<h3 id="production-readiness-checklist"><a class="header" href="#production-readiness-checklist">Production Readiness Checklist</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Application handles high concurrent load</li>
<li><input disabled="" type="checkbox"> Comprehensive error handling and recovery</li>
<li><input disabled="" type="checkbox"> Monitoring and alerting configured</li>
<li><input disabled="" type="checkbox"> Security best practices implemented</li>
<li><input disabled="" type="checkbox"> Documentation complete</li>
<li><input disabled="" type="checkbox"> Backup and disaster recovery planned</li>
<li><input disabled="" type="checkbox"> Load testing completed</li>
<li><input disabled="" type="checkbox"> Performance benchmarks established</li>
</ul>
<p>Good luck mastering advanced DSPy concepts! These exercises will prepare you for building enterprise-grade applications that can handle real-world challenges.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../07-advanced-topics/08-declarative-compilation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../08-case-studies/00-introduction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../07-advanced-topics/08-declarative-compilation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../08-case-studies/00-introduction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>






        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
