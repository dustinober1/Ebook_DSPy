<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>STORM Writing Assistant - DSPy: A Practical Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The most comprehensive DSPy guide with complete coverage of 9 research papers, advanced optimization techniques, and production-ready applications">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../assets/print-only-ef201963.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-4ea68664.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">DSPy: A Practical Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="case-study-5-storm---ai-powered-writing-assistant-for-wikipedia-like-articles"><a class="header" href="#case-study-5-storm---ai-powered-writing-assistant-for-wikipedia-like-articles">Case Study 5: STORM - AI-Powered Writing Assistant for Wikipedia-like Articles</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>STORM (Synthesis of Topic Outlines through Retrieval and Multi-perspective questioning) is a sophisticated AI writing assistant that helps users create comprehensive, well-researched articles from scratch. Inspired by the research paper “Assisting in Writing Wikipedia-like Articles From Scratch with Large Language Models,” this case study demonstrates how DSPy can be used to build a complete writing system that simulates human research and writing processes.</p>
<h2 id="problem-definition"><a class="header" href="#problem-definition">Problem Definition</a></h2>
<h3 id="the-challenge"><a class="header" href="#the-challenge">The Challenge</a></h3>
<p>Writing comprehensive, encyclopedic articles requires:</p>
<ol>
<li><strong>Thorough Research</strong>: Gathering information from multiple perspectives</li>
<li><strong>Structured Organization</strong>: Creating logical outlines from scattered information</li>
<li><strong>Coherent Writing</strong>: Maintaining consistency across thousands of words</li>
<li><strong>Factual Accuracy</strong>: Ensuring all claims are supported by evidence</li>
<li><strong>Citation Management</strong>: Properly attributing sources</li>
</ol>
<h3 id="key-requirements"><a class="header" href="#key-requirements">Key Requirements</a></h3>
<ol>
<li><strong>Two-Stage Process</strong>: Pre-writing (research and outlining) and writing stages</li>
<li><strong>Multi-perspective Research</strong>: Comprehensive coverage from different angles</li>
<li><strong>Iterative Refinement</strong>: Continuous improvement of content quality</li>
<li><strong>Human-AI Collaboration</strong>: Assist rather than replace human writers</li>
<li><strong>Scalability</strong>: Handle topics of varying complexity</li>
</ol>
<h2 id="system-architecture"><a class="header" href="#system-architecture">System Architecture</a></h2>
<h3 id="high-level-design"><a class="header" href="#high-level-design">High-Level Design</a></h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                    STORM Writing System                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   User Input    │───▶│   Topic         │                │
│  │   (Topic)       │    │   Analysis      │                │
│  └─────────────────┘    └─────────────────┘                │
│           │                       │                         │
│           ▼                       ▼                         │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Perspective   │    │   Question      │                │
│  │   Generator     │───▶│   Generator     │                │
│  └─────────────────┘    └─────────────────┘                │
│           │                       │                         │
│           ▼                       ▼                         │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Information   │    │   Outline       │                │
│  │   Retrieval     │───▶│   Generator     │                │
│  └─────────────────┘    └─────────────────┘                │
│                                   │                         │
│                                   ▼                         │
│  ┌─────────────────────────────────────────────────┐       │
│  │              Pre-writing Stage                   │       │
│  └─────────────────────────────────────────────────┘       │
│                                   │                         │
│                                   ▼                         │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Section       │    │   Citation      │                │
│  │   Generator     │───▶│   Manager       │                │
│  └─────────────────┘    └─────────────────┘                │
│           │                       │                         │
│           ▼                       ▼                         │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Coherence     │    │   Quality       │                │
│  │   Checker       │───▶   Assurance     │                │
│  └─────────────────┘    └─────────────────┘                │
│                                   │                         │
│                                   ▼                         │
│  ┌─────────────────────────────────────────────────┐       │
│  │               Writing Stage                      │       │
│  └─────────────────────────────────────────────────┘       │
│                                   │                         │
│                                   ▼                         │
│  ┌─────────────────────────────────────────────────┐       │
│  │              Final Article                       │       │
│  └─────────────────────────────────────────────────┘       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h2 id="implementation-with-dspy"><a class="header" href="#implementation-with-dspy">Implementation with DSPy</a></h2>
<h3 id="core-system-components"><a class="header" href="#core-system-components">Core System Components</a></h3>
<pre><code class="language-python">import dspy
import asyncio
from typing import List, Dict, Any, Optional
from dataclasses import dataclass
from concurrent.futures import ThreadPoolExecutor, as_completed

# Helper classes for STORM implementation
class ParallelProcessor:
    """Simple parallel processing helper."""
    def __init__(self, max_workers: int = 4):
        self.max_workers = max_workers

    def process_parallel(self, tasks: List, function):
        """Process tasks in parallel."""
        with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
            futures = [executor.submit(function, task) for task in tasks]
            return [future.result() for future in as_completed(futures)]

class BatchRetriever:
    """Batch retrieval helper for efficient document retrieval."""
    def __init__(self, batch_size: int = 10):
        self.batch_size = batch_size

    def retrieve_batch(self, queries: List[str]):
        """Retrieve documents for multiple queries."""
        # This would integrate with dspy.Retrieve or similar
        results = []
        for query in queries:
            # Simulate retrieval
            results.append([f"Document for {query}"])
        return results

class RateLimiter:
    """Simple rate limiter for API calls."""
    def __init__(self, requests_per_minute: int = 10):
        self.requests_per_minute = requests_per_minute
        self.requests = []

    async def acquire(self, user_id: str):
        """Acquire rate limit slot."""
        # Simple implementation - in production use proper rate limiting
        await asyncio.sleep(60 / self.requests_per_minute)

@dataclass
class StormConfig:
    """Configuration for STORM system."""
    max_perspectives: int = 5
    questions_per_perspective: int = 4
    retrieval_documents_per_query: int = 8
    max_outline_sections: int = 10
    words_per_section: int = 500
    citation_style: str = "wikipedia"

class StormWritingAssistant(dspy.Module):
    """Complete STORM writing assistant implementation."""

    def __init__(self, config: Optional[StormConfig] = None):
        super().__init__()
        self.config = config or StormConfig()

        # Stage 1: Pre-writing components
        self.perspective_generator = PerspectiveDrivenResearch()
        self.outline_generator = ArticleOutlineGenerator()
        self.research_synthesizer = ResearchSynthesizer()

        # Stage 2: Writing components
        self.section_writer = LongFormArticleGenerator()
        self.citation_manager = CitationManager()
        self.quality_checker = ArticleQA()

        # Human-AI interaction
        self.human_review_prompter = HumanReviewInterface()

    def forward(self,
               topic: str,
               human_feedback: Optional[Dict] = None) -&gt; dspy.Prediction:
        """
        Generate a complete article using STORM methodology.

        Args:
            topic: The article topic
            human_feedback: Optional feedback from human reviewer

        Returns:
            Complete article with metadata
        """
        # Stage 1: Pre-writing Phase
        prewriting_result = self._prewriting_phase(topic)

        # Stage 2: Writing Phase
        writing_result = self._writing_phase(
            topic=topic,
            outline=prewriting_result.outline,
            research_data=prewriting_result.research_synthesis
        )

        # Stage 3: Quality Assurance
        qa_result = self._quality_assurance(
            article=writing_result.article,
            research_data=prewriting_result.research_synthesis
        )

        # Stage 4: Human Review Integration (if feedback provided)
        if human_feedback:
            final_article = self._incorporate_feedback(
                article=writing_result.article,
                feedback=human_feedback
            )
        else:
            final_article = writing_result.article

        return dspy.Prediction(
            topic=topic,
            article=final_article,
            outline=prewriting_result.outline,
            research_perspectives=prewriting_result.perspectives,
            quality_score=qa_result.overall_quality,
            total_citations=writing_result.total_citations,
            word_count=writing_result.total_word_count,
            human_feedback_applied=bool(human_feedback)
        )

    def _prewriting_phase(self, topic: str) -&gt; dspy.Prediction:
        """Execute the pre-writing phase (research and outlining)."""
        print(f"\n=== Pre-writing Phase for: {topic} ===")

        # Step 1: Multi-perspective research
        print("1. Conducting multi-perspective research...")
        research = self.perspective_generator(
            topic=topic,
            max_perspectives=self.config.max_perspectives,
            questions_per_perspective=self.config.questions_per_perspective
        )

        # Step 2: Synthesize research findings
        print("2. Synthesizing research findings...")
        synthesis = self.research_synthesizer(
            topic=topic,
            research_data=research.research_results
        )

        # Step 3: Generate structured outline
        print("3. Generating structured outline...")
        outline = self.outline_generator(
            topic=topic,
            research_data=synthesis.synthesized_data,
            constraints={
                'word_count_target': self.config.words_per_section * self.config.max_outline_sections,
                'intended_audience': 'general',
                'complexity': 'medium'
            }
        )

        return dspy.Prediction(
            perspectives=research.perspectives_researched,
            research_synthesis=synthesis.synthesized_data,
            outline=outline.outline
        )

    def _writing_phase(self,
                      topic: str,
                      outline: List[Dict],
                      research_data: Dict) -&gt; dspy.Prediction:
        """Execute the writing phase."""
        print(f"\n=== Writing Phase ===")

        # Generate the complete article
        article_result = self.section_writer(
            topic=topic,
            outline=outline,
            research_data=research_data
        )

        print(f"Generated article with {article_result.total_word_count} words")
        print(f"Included {article_result.total_citations} citations")

        return article_result

    def _quality_assurance(self,
                          article: str,
                          research_data: Dict) -&gt; Dict:
        """Perform quality assurance on generated article."""
        print("\n=== Quality Assurance ===")

        qa_result = self.quality_checker.validate_article(
            article=article,
            research_data=research_data,
            outline=[]  # Would pass outline if available
        )

        print(f"Quality Score: {qa_result['overall_quality']:.2f}")
        print(f"Factual Claims Verified: {sum(1 for fc in qa_result['fact_check'] if fc['is_factual'])}/{len(qa_result['fact_check'])}")

        return qa_result

    def _incorporate_feedback(self,
                            article: str,
                            feedback: Dict) -&gt; str:
        """Incorporate human feedback into the article."""
        print("\n=== Incorporating Human Feedback ===")

        feedback_processor = dspy.ChainOfThought(
            "article, feedback -&gt; revised_article"
        )

        result = feedback_processor(
            article=article,
            feedback=str(feedback)
        )

        print("Applied human feedback to article")
        return result.revised_article


class ResearchSynthesizer(dspy.Module):
    """Synthesizes research from multiple perspectives."""

    def __init__(self):
        super().__init__()
        self.identify_connections = dspy.ChainOfThought(
            "perspective_research -&gt; connections, contradictions"
        )
        self.resolve_conflicts = dspy.Predict(
            "contradictions, evidence -&gt; resolutions"
        )
        self.create_synthesis = dspy.ChainOfThought(
            "topic, all_perspectives, connections, resolutions -&gt; synthesized_data"
        )

    def forward(self, topic: str, research_data: Dict) -&gt; dspy.Prediction:
        """Synthesize research from multiple perspectives."""
        # Find connections between perspectives
        connections = self.identify_connections(
            perspective_research=str(research_data)
        )

        # Resolve contradictions
        if connections.contradictions:
            resolutions = self.resolve_conflicts(
                contradictions=connections.contradictions,
                evidence=str(research_data)
            )
        else:
            resolutions = dspy.Prediction(resolutions="No contradictions found")

        # Create final synthesis
        synthesis = self.create_synthesis(
            topic=topic,
            all_perspectives=str(research_data),
            connections=connections.connections,
            resolutions=resolutions.resolutions
        )

        return dspy.Prediction(
            synthesized_data=self._parse_synthesis(synthesis.synthesized_data),
            key_connections=connections.connections,
            conflicts_resolved=len(connections.contradictions) &gt; 0
        )

    def _parse_synthesis(self, synthesis_text: str) -&gt; Dict:
        """Parse synthesis into structured format."""
        # Simplified parsing - in practice would be more sophisticated
        return {
            'unified_findings': synthesis_text,
            'consensus_points': [],
            'open_questions': []
        }


class HumanReviewInterface(dspy.Module):
    """Interface for human review and feedback integration."""

    def __init__(self):
        super().__init__()
        self.generate_review_questions = dspy.Predict(
            "article, topic -&gt; review_questions"
        )
        self.summarize_feedback = dspy.Predict(
            "human_responses -&gt; feedback_summary"
        )

    def generate_review_prompts(self, article: str, topic: str) -&gt; Dict:
        """Generate prompts for human review."""
        questions = self.generate_review_questions(
            article=article[:2000],  # First 2000 chars for context
            topic=topic
        )

        return {
            'accuracy_questions': [
                "Are all factual claims accurate?",
                "Are citations appropriate and correctly formatted?",
                "Is the information up-to-date?"
            ],
            'completeness_questions': [
                "Are there any important aspects missing?",
                "Should any sections be expanded?",
                "Is the coverage balanced?"
            ],
            'readability_questions': [
                "Is the article well-structured?",
                "Are transitions between sections smooth?",
                "Is the language clear and appropriate?"
            ],
            'ai_generated_questions': self._parse_questions(questions.review_questions)
        }

    def process_human_feedback(self,
                             human_responses: Dict) -&gt; Dict:
        """Process and structure human feedback."""
        feedback = self.summarize_feedback(
            human_responses=str(human_responses)
        )

        return {
            'feedback_summary': feedback.feedback_summary,
            'priority_issues': self._identify_priorities(human_responses),
            'actionable_items': self._extract_actions(human_responses)
        }

    def _parse_questions(self, questions_text: str) -&gt; List[str]:
        """Parse questions from generated text."""
        return [q.strip() for q in questions_text.split('\n') if q.strip() and '?' in q]

    def _identify_priorities(self, responses: Dict) -&gt; List[str]:
        """Identify high-priority issues from feedback."""
        priorities = []
        for question, response in responses.items():
            if 'no' in response.lower() or 'missing' in response.lower():
                priorities.append(question)
        return priorities

    def _extract_actions(self, responses: Dict) -&gt; List[str]:
        """Extract actionable items from feedback."""
        actions = []
        for question, response in responses.items():
            if any(action in response.lower() for action in ['add', 'remove', 'expand', 'fix']):
                actions.append(f"For '{question}': {response}")
        return actions
</code></pre>
<h2 id="advanced-features"><a class="header" href="#advanced-features">Advanced Features</a></h2>
<h3 id="1-adaptive-research-depth"><a class="header" href="#1-adaptive-research-depth">1. Adaptive Research Depth</a></h3>
<pre><code class="language-python">class AdaptiveResearchDepth(dspy.Module):
    """Adjusts research depth based on topic complexity."""

    def __init__(self):
        super().__init__()
        self.assess_complexity = dspy.ChainOfThought(
            "topic, initial_research -&gt; complexity_level, research_depth_needed"
        )
        self.adjust_questions = dspy.Predict(
            "base_questions, complexity_level -&gt; adjusted_questions"
        )

    def forward(self, topic: str) -&gt; Dict:
        """Determine optimal research depth for topic."""
        # Get initial assessment
        complexity = self.assess_complexity(
            topic=topic,
            initial_research=""  # Would include preliminary research
        )

        # Adjust parameters based on complexity
        depth_params = {
            'complexity': complexity.complexity_level,
            'perspectives_needed': min(8, 2 + int(complexity.research_depth_needed) * 2),
            'questions_per_perspective': min(6, 2 + int(complexity.research_depth_needed)),
            'document_limit': min(15, 5 + int(complexity.research_depth_needed) * 3)
        }

        return depth_params
</code></pre>
<h3 id="2-dynamic-citation-strategy"><a class="header" href="#2-dynamic-citation-strategy">2. Dynamic Citation Strategy</a></h3>
<pre><code class="language-python">class DynamicCitationStrategy(dspy.Module):
    """Adapts citation strategy based on content type."""

    def __init__(self):
        super().__init__()
        self.classify_content = dspy.Predict(
            "content -&gt; content_type, citation_density"
        )
        self.select_citation_style = dspy.Predict(
            "content_type, audience -&gt; optimal_citation_style"
        )

    def get_citation_strategy(self, content: str, audience: str = "general") -&gt; Dict:
        """Determine optimal citation strategy."""
        classification = self.classify_content(content=content)
        style = self.select_citation_style(
            content_type=classification.content_type,
            audience=audience
        )

        return {
            'style': style.optimal_citation_style,
            'density': classification.citation_density,
            'placement_rules': self._get_placement_rules(classification.content_type),
            'verification_level': 'high' if 'controversial' in content.lower() else 'medium'
        }

    def _get_placement_rules(self, content_type: str) -&gt; List[str]:
        """Get citation placement rules for content type."""
        rules = {
            'factual': ["cite every statistic", "cite every direct quote"],
            'opinion': ["cite supporting arguments", "cite counterarguments"],
            'historical': ["cite primary sources", "cite scholarly interpretations"],
            'technical': ["cite specifications", "cite research papers"]
        }
        return rules.get(content_type, ["cite as needed"])
</code></pre>
<h2 id="example-implementation"><a class="header" href="#example-implementation">Example Implementation</a></h2>
<h3 id="complete-storm-workflow"><a class="header" href="#complete-storm-workflow">Complete STORM Workflow</a></h3>
<pre><code class="language-python"># Initialize STORM with custom configuration
config = StormConfig(
    max_perspectives=6,
    questions_per_perspective=5,
    retrieval_documents_per_query=10,
    max_outline_sections=12,
    words_per_section=600
)

storm = StormWritingAssistant(config)

# Example: Generate an article
topic = "The Impact of Quantum Computing on Cryptography"

print(f"\n{'='*60}")
print(f"STORM Writing Assistant")
print(f"Generating Article: {topic}")
print(f"{'='*60}\n")

# Generate the article
result = storm(topic=topic)

# Display results
print(f"\n{'='*60}")
print(f"ARTICLE GENERATED SUCCESSFULLY")
print(f"{'='*60}")
print(f"\nTopic: {result.topic}")
print(f"Total Word Count: {result.word_count:,}")
print(f"Total Citations: {result.total_citations}")
print(f"Quality Score: {result.quality_score:.2f}")
print(f"\nPerspectives Researched: {', '.join(result.perspectives)}")

# Show outline structure
print(f"\n=== Article Outline ===")
for i, section in enumerate(result.outline, 1):
    print(f"\n{i}. {section['title']}")
    if 'subsections' in section:
        for j, sub in enumerate(section['subsections'], 1):
            print(f"   {i}.{j} {sub['title']}")

# Simulate human review and feedback
print(f"\n{'='*60}")
print(f"HUMAN REVIEW SIMULATION")
print(f"{'='*60}")

review_interface = HumanReviewInterface()
review_prompts = review_interface.generate_review_prompts(
    article=result.article,
    topic=topic
)

print("\nReview Questions Generated:")
for category, questions in review_prompts.items():
    print(f"\n{category.replace('_', ' ').title()}:")
    for q in questions[:2]:  # Show first 2 questions per category
        print(f"  - {q}")

# Simulate human feedback
human_feedback = {
    "Are all factual claims accurate?": "Mostly, but need verification on quantum supremacy claims",
    "Are there any important aspects missing?": "Should add section on post-quantum cryptography",
    "Is the article well-structured?": "Yes, structure is good",
    "Should any sections be expanded?": "The impact on blockchain needs more detail"
}

# Incorporate feedback
print("\nIncorporating Human Feedback...")
final_result = storm(topic=topic, human_feedback=human_feedback)

print(f"\nArticle updated with human feedback!")
print(f"Human feedback applied: {final_result.human_feedback_applied}")
</code></pre>
<h2 id="performance-metrics-and-evaluation"><a class="header" href="#performance-metrics-and-evaluation">Performance Metrics and Evaluation</a></h2>
<h3 id="storm-specific-metrics"><a class="header" href="#storm-specific-metrics">STORM-Specific Metrics</a></h3>
<pre><code class="language-python">def storm_evaluation_metrics(storm_system, test_topics: List[str]) -&gt; Dict:
    """Comprehensive evaluation of STORM system performance."""
    results = {
        'research_coverage': [],
        'outline_quality': [],
        'article_quality': [],
        'generation_time': [],
        'citation_accuracy': []
    }

    for topic in test_topics:
        import time
        start_time = time.time()

        # Generate article
        result = storm_system(topic=topic)

        generation_time = time.time() - start_time

        # Evaluate research coverage
        research_score = evaluate_research_coverage(result, topic)
        results['research_coverage'].append(research_score)

        # Evaluate outline quality
        outline_score = evaluate_outline_quality(result.outline, topic)
        results['outline_quality'].append(outline_score)

        # Evaluate article quality
        article_score = result.quality_score
        results['article_quality'].append(article_score)

        # Record generation time
        results['generation_time'].append(generation_time)

        # Evaluate citation accuracy (simplified)
        citation_score = min(1.0, result.total_citations / (result.word_count / 100))
        results['citation_accuracy'].append(citation_score)

    # Calculate averages
    return {
        'avg_research_coverage': sum(results['research_coverage']) / len(results['research_coverage']),
        'avg_outline_quality': sum(results['outline_quality']) / len(results['outline_quality']),
        'avg_article_quality': sum(results['article_quality']) / len(results['article_quality']),
        'avg_generation_time': sum(results['generation_time']) / len(results['generation_time']),
        'avg_citation_accuracy': sum(results['citation_accuracy']) / len(results['citation_accuracy'])
    }

def evaluate_research_coverage(result: dspy.Prediction, topic: str) -&gt; float:
    """Evaluate how well research covers the topic."""
    # Check for multiple perspectives
    perspective_score = min(1.0, len(result.perspectives) / 5.0)

    # Check for comprehensive outline
    section_score = min(1.0, len(result.outline) / 8.0)

    return (perspective_score + section_score) / 2

def evaluate_outline_quality(outline: List[Dict], topic: str) -&gt; float:
    """Evaluate outline structure quality."""
    # Check for logical structure
    has_intro = any('introduction' in s['title'].lower() for s in outline)
    has_conclusion = any('conclusion' in s['title'].lower() for s in outline)

    structure_score = 1.0 if has_intro and has_conclusion else 0.5

    # Check for balance
    if outline:
        word_counts = [s.get('word_count', 500) for s in outline]
        avg = sum(word_counts) / len(word_counts)
        variance = sum((w - avg) ** 2 for w in word_counts) / len(word_counts)
        balance_score = max(0, 1 - variance / (avg ** 2))
    else:
        balance_score = 0

    return (structure_score + balance_score) / 2
</code></pre>
<h2 id="real-world-deployment-considerations"><a class="header" href="#real-world-deployment-considerations">Real-World Deployment Considerations</a></h2>
<h3 id="1-scalability-optimizations"><a class="header" href="#1-scalability-optimizations">1. Scalability Optimizations</a></h3>
<pre><code class="language-python">class ScalableSTORM(dspy.Module):
    """Optimized STORM for large-scale deployment."""

    def __init__(self):
        super().__init__()
        self.cache = {}  # Simple cache for research results
        self.parallel_processor = ParallelProcessor()
        self.batch_retriever = BatchRetriever()

    def forward(self, topics: List[str]) -&gt; List[dspy.Prediction]:
        """Process multiple topics in parallel."""
        # Batch research for similar topics
        research_batches = self._batch_similar_topics(topics)

        # Process in parallel
        results = []
        for batch in research_batches:
            batch_results = self._process_batch(batch)
            results.extend(batch_results)

        return results

    def _batch_similar_topics(self, topics: List[str]) -&gt; List[List[str]]:
        """Group similar topics for batch processing."""
        # Simplified batching - in practice would use similarity metrics
        return [[topic] for topic in topics]  # Process individually for now

    def _process_batch(self, batch: List[str]) -&gt; List[dspy.Prediction]:
        """Process a batch of topics."""
        # Implementation would use parallel processing
        storm = StormWritingAssistant()
        return [storm(topic=topic) for topic in batch]
</code></pre>
<h3 id="2-integration-with-external-systems"><a class="header" href="#2-integration-with-external-systems">2. Integration with External Systems</a></h3>
<pre><code class="language-python">class STORMAPI:
    """API wrapper for STORM system."""

    def __init__(self):
        self.storm = StormWritingAssistant()
        self.rate_limiter = RateLimiter(requests_per_minute=10)

    async def generate_article(self,
                             topic: str,
                             user_id: str,
                             options: Optional[Dict] = None) -&gt; Dict:
        """Async API endpoint for article generation."""
        # Rate limiting
        await self.rate_limiter.acquire(user_id)

        # Generate article
        result = self.storm(topic=topic)

        # Format for API response
        return {
            'article_id': self._generate_id(),
            'topic': result.topic,
            'article': result.article,
            'metadata': {
                'word_count': result.word_count,
                'citations': result.total_citations,
                'quality_score': result.quality_score,
                'perspectives': result.perspectives,
                'generation_time': datetime.now().isoformat()
            },
            'status': 'completed'
        }

    def _generate_id(self) -&gt; str:
        """Generate unique article ID."""
        import uuid
        return str(uuid.uuid4())
</code></pre>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<p>The STORM writing assistant demonstrates how DSPy can be used to build sophisticated AI systems that:</p>
<ol>
<li><strong>Simulate Human Research Processes</strong> through multi-perspective investigation</li>
<li><strong>Generate Comprehensive Outlines</strong> that organize information logically</li>
<li><strong>Produce High-Quality Articles</strong> with proper citations and structure</li>
<li><strong>Incorporate Human Feedback</strong> for collaborative writing</li>
<li><strong>Scale to Production</strong> with proper optimization and APIs</li>
</ol>
<h3 id="key-achievements"><a class="header" href="#key-achievements">Key Achievements</a></h3>
<ul>
<li><strong>Two-Stage Architecture</strong>: Clear separation of research and writing phases</li>
<li><strong>Quality Assurance</strong>: Comprehensive validation of generated content</li>
<li><strong>Human-AI Collaboration</strong>: Seamless integration of human feedback</li>
<li><strong>Modular Design</strong>: Components can be customized and extended</li>
<li><strong>Production Ready</strong>: Scalable and API-accessible implementation</li>
</ul>
<h3 id="lessons-learned"><a class="header" href="#lessons-learned">Lessons Learned</a></h3>
<ol>
<li><strong>Research Quality Directly Impacts Article Quality</strong></li>
<li><strong>Outline Generation is Critical for Coherence</strong></li>
<li><strong>Citation Management Requires Sophisticated Logic</strong></li>
<li><strong>Human Feedback Enhances, Not Replaces, AI Writing</strong></li>
<li><strong>System Architecture Must Support Iterative Improvement</strong></li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<ul>
<li><a href="../06-real-world-applications/02-multi-hop-search.html">Multi-hop Search</a> - Advanced retrieval techniques</li>
<li><a href="../../04-evaluation/05-best-practices.html">Evaluation Best Practices</a> - System evaluation frameworks</li>
<li><a href="../09-appendices/02-production-deployment.html">Production Deployment</a> - Deploying DSPy applications</li>
</ul>
<h2 id="further-reading"><a class="header" href="#further-reading">Further Reading</a></h2>
<ul>
<li><a href="https://arxiv.org/abs/2401.05454">Original STORM Paper</a></li>
<li><a href="https://example.com/human-ai-writing">Human-AI Collaboration in Writing</a></li>
<li><a href="https://example.com/scalable-ai">Scalable AI System Architecture</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../08-case-studies/04-automated-data-analysis.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../08-case-studies/06-assertion-driven-applications.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../08-case-studies/04-automated-data-analysis.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../08-case-studies/06-assertion-driven-applications.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>






        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
