<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MIPRO - DSPy: A Practical Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="The most comprehensive DSPy guide with complete coverage of 9 research papers, advanced optimization techniques, and production-ready applications">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../assets/custom-5fe0be54.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-8a4736e7.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-90eb277b.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">DSPy: A Practical Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/dustinober1/Ebook_DSPy" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>
                        <a href="https://github.com/dustinober1/Ebook_DSPy/edit/main/src/05-optimizers/03-mipro.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <span class=fa-svg id="git-edit-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="mipro-multi-step-instruction-and-demonstration-optimization"><a class="header" href="#mipro-multi-step-instruction-and-demonstration-optimization">MIPRO: Multi-step Instruction and Demonstration Optimization</a></h1>
<h2 id="learning-objectives"><a class="header" href="#learning-objectives">Learning Objectives</a></h2>
<p>By the end of this chapter, you will be able to:</p>
<ul>
<li>Understand MIPRO’s dual-component optimization approach</li>
<li>Implement meta-prompting for instruction generation</li>
<li>Configure simulated annealing for efficient prompt search</li>
<li>Apply module-specific demonstration selection strategies</li>
<li>Optimize multi-stage pipelines effectively</li>
<li>Interpret and replicate MIPRO benchmark results</li>
</ul>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>MIPRO (Multi-step Instruction and demonstration PRompt Optimization) represents a significant advancement in automated prompt optimization for language model programs. Unlike simpler approaches that only optimize examples, MIPRO simultaneously optimizes both the instructions (prompts) and demonstrations (examples) for each module in a multi-stage pipeline.</p>
<p>Research demonstrates MIPRO’s effectiveness across diverse benchmarks:</p>
<ul>
<li><strong>HotpotQA</strong>: 52.3 F1 vs 32.0 F1 manual prompting (63% improvement)</li>
<li><strong>GSM8K</strong>: 33.8% vs 28.5% manual prompting (19% improvement)</li>
<li><strong>CodeAlpaca</strong>: 64.8% vs 63.1% manual prompting</li>
</ul>
<p>These results highlight MIPRO’s ability to discover optimized prompts that generalize better than hand-crafted alternatives, often achieving zero-shot superiority through optimized instructions alone.</p>
<h2 id="core-architecture-dual-component-optimization"><a class="header" href="#core-architecture-dual-component-optimization">Core Architecture: Dual-Component Optimization</a></h2>
<p>MIPRO’s power comes from its dual-component approach that jointly optimizes two key elements:</p>
<h3 id="component-1-instruction-generation"><a class="header" href="#component-1-instruction-generation">Component 1: Instruction Generation</a></h3>
<p>MIPRO generates candidate instructions using <strong>meta-prompting</strong>, where a language model is prompted to create task-specific instructions conditioned on:</p>
<ul>
<li>The program’s overall structure and purpose</li>
<li>Individual module signatures and roles</li>
<li>Relationships between pipeline stages</li>
<li>Dataset characteristics and examples</li>
</ul>
<h3 id="component-2-demonstration-selection"><a class="header" href="#component-2-demonstration-selection">Component 2: Demonstration Selection</a></h3>
<p>For few-shot learning, MIPRO selects demonstrations using:</p>
<ul>
<li>Data-driven selection from bootstrapped examples (via BootstrapFewShot)</li>
<li>Module-specific demonstration counts</li>
<li>Utility scoring based on validation performance</li>
<li>Greedy selection algorithms</li>
</ul>
<pre><code>┌──────────────────────────────────────────────────────────────────┐
│                     MIPRO Optimization Loop                       │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────┐      ┌────────────────┐                      │
│  │  Meta-Prompt   │      │  Demonstration │                      │
│  │  Generation    │      │  Selection     │                      │
│  └───────┬────────┘      └───────┬────────┘                      │
│          │                       │                               │
│          ▼                       ▼                               │
│  ┌────────────────────────────────────────┐                      │
│  │        Candidate Configurations        │                      │
│  │   (Instruction + Demonstration Pairs)  │                      │
│  └───────────────────┬────────────────────┘                      │
│                      │                                           │
│                      ▼                                           │
│  ┌────────────────────────────────────────┐                      │
│  │      Simulated Annealing Search        │                      │
│  │   - Evaluate on validation set         │                      │
│  │   - Accept/reject based on temperature │                      │
│  │   - Gradually reduce temperature       │                      │
│  └───────────────────┬────────────────────┘                      │
│                      │                                           │
│                      ▼                                           │
│  ┌────────────────────────────────────────┐                      │
│  │         Best Configuration             │                      │
│  └────────────────────────────────────────┘                      │
└──────────────────────────────────────────────────────────────────┘
</code></pre>
<h2 id="meta-prompting-for-instruction-generation"><a class="header" href="#meta-prompting-for-instruction-generation">Meta-Prompting for Instruction Generation</a></h2>
<p>Meta-prompting is MIPRO’s technique for generating candidate instructions automatically. Instead of requiring human-written prompts, MIPRO uses a language model to generate diverse, task-specific instructions.</p>
<h3 id="how-meta-prompting-works"><a class="header" href="#how-meta-prompting-works">How Meta-Prompting Works</a></h3>
<pre><code class="language-python">class MIPROMetaPromptGenerator:
    """
    Generates candidate instructions using meta-prompting.

    Meta-prompts condition on:
    1. Program structure (modules and their connections)
    2. Dataset characteristics (input/output types, examples)
    3. Task description (what the program should accomplish)
    """

    def generate_instruction_candidates(
        self,
        module_signature: str,
        program_description: str,
        dataset_summary: str,
        num_candidates: int = 10,
        temperature: float = 0.7
    ) -&gt; list[str]:
        """
        Generate diverse instruction candidates for a module.

        Args:
            module_signature: The module's input/output signature
            program_description: Overall program purpose
            dataset_summary: Summary of training data characteristics
            num_candidates: Number of candidates to generate
            temperature: Sampling temperature (0.7 recommended for diversity)

        Returns:
            List of candidate instruction strings
        """
        meta_prompt = f"""
You are designing instructions for a language model module in a larger program.

PROGRAM PURPOSE: {program_description}

MODULE SIGNATURE: {module_signature}

DATASET CHARACTERISTICS: {dataset_summary}

Generate {num_candidates} diverse instruction variations for this module.
Each instruction should:
1. Clearly specify the task
2. Guide the model toward high-quality outputs
3. Be self-contained and unambiguous
4. Vary in phrasing, structure, and emphasis

Instructions:
"""

        candidates = []
        for _ in range(num_candidates):
            # Temperature sampling enables diversity
            response = self.lm(meta_prompt, temperature=temperature)
            candidates.append(response)

        return candidates
</code></pre>
<h3 id="temperature-sampling-for-diversity"><a class="header" href="#temperature-sampling-for-diversity">Temperature Sampling for Diversity</a></h3>
<p>MIPRO uses temperature sampling (T=0.7 by default) to generate diverse instruction candidates:</p>
<pre><code class="language-python"># Low temperature (T=0.3): More deterministic, similar instructions
# Medium temperature (T=0.7): Good diversity while maintaining quality
# High temperature (T=1.2): Maximum diversity, may reduce quality

optimizer = MIPRO(
    metric=your_metric,
    num_candidates=10,
    init_temperature=0.7  # Controls instruction generation diversity
)
</code></pre>
<h3 id="self-reflection-for-instruction-refinement"><a class="header" href="#self-reflection-for-instruction-refinement">Self-Reflection for Instruction Refinement</a></h3>
<p>MIPRO can optionally use self-reflection to refine generated instructions:</p>
<pre><code class="language-python">class InstructionRefiner:
    """
    Refines candidate instructions through self-reflection.
    """

    def __init__(self):
        self.reflect = dspy.Predict(
            "instruction, task_description, failure_cases -&gt; improved_instruction"
        )

    def refine(self, instruction: str, task_desc: str, failures: list) -&gt; str:
        """
        Improve an instruction based on observed failures.
        """
        result = self.reflect(
            instruction=instruction,
            task_description=task_desc,
            failure_cases="\n".join(failures)
        )
        return result.improved_instruction
</code></pre>
<h2 id="demonstration-selection-strategy"><a class="header" href="#demonstration-selection-strategy">Demonstration Selection Strategy</a></h2>
<p>MIPRO’s demonstration selection builds on BootstrapFewShot but adds sophisticated selection mechanisms.</p>
<h3 id="data-driven-selection"><a class="header" href="#data-driven-selection">Data-Driven Selection</a></h3>
<pre><code class="language-python">class MIPRODemonstrationSelector:
    """
    Selects demonstrations using data-driven strategies.
    """

    def __init__(self, trainset, metric, max_demos_per_module=8):
        self.trainset = trainset
        self.metric = metric
        self.max_demos_per_module = max_demos_per_module

    def bootstrap_demonstrations(self, program):
        """
        Generate candidate demonstrations using BootstrapFewShot.
        """
        # First, bootstrap potential demonstrations
        bootstrap = BootstrapFewShot(
            metric=self.metric,
            max_bootstrapped_demos=self.max_demos_per_module * 2
        )
        bootstrapped = bootstrap.compile(program, trainset=self.trainset)
        return bootstrapped.demos

    def score_demonstration_utility(self, demo, module, valset):
        """
        Score a demonstration's utility for a specific module.

        Utility is measured by validation set performance improvement
        when the demonstration is included.
        """
        # Test with and without this demonstration
        score_with = self._evaluate_with_demo(module, demo, valset)
        score_without = self._evaluate_without_demo(module, demo, valset)

        return score_with - score_without

    def greedy_select(self, candidates, module, valset, k):
        """
        Greedy selection of top-k demonstrations.

        Args:
            candidates: List of candidate demonstrations
            module: The module to optimize
            valset: Validation set for scoring
            k: Number of demonstrations to select

        Returns:
            List of k selected demonstrations
        """
        selected = []
        remaining = candidates.copy()

        for _ in range(k):
            if not remaining:
                break

            # Score each remaining candidate
            scores = [
                (demo, self.score_demonstration_utility(demo, module, valset))
                for demo in remaining
            ]

            # Select the best
            best_demo, best_score = max(scores, key=lambda x: x[1])
            selected.append(best_demo)
            remaining.remove(best_demo)

        return selected
</code></pre>
<h3 id="module-specific-demonstration-counts"><a class="header" href="#module-specific-demonstration-counts">Module-Specific Demonstration Counts</a></h3>
<p>Different modules may benefit from different numbers of demonstrations:</p>
<pre><code class="language-python">def determine_demo_count(module_type, context_budget=16000):
    """
    Determine optimal demonstration count per module.

    Args:
        module_type: Type of module (e.g., 'retrieval', 'reasoning', 'generation')
        context_budget: Available context window in tokens

    Returns:
        Recommended number of demonstrations
    """
    # Simple modules need fewer demos
    if module_type == 'classification':
        return min(4, context_budget // 500)

    # Reasoning tasks benefit from more demos
    elif module_type == 'reasoning':
        return min(8, context_budget // 1000)

    # Generation tasks need diverse examples
    elif module_type == 'generation':
        return min(6, context_budget // 800)

    # Default
    return min(5, context_budget // 600)
</code></pre>
<h2 id="simulated-annealing-for-prompt-search"><a class="header" href="#simulated-annealing-for-prompt-search">Simulated Annealing for Prompt Search</a></h2>
<p>MIPRO uses simulated annealing to efficiently search the space of possible prompt configurations.</p>
<h3 id="why-simulated-annealing"><a class="header" href="#why-simulated-annealing">Why Simulated Annealing?</a></h3>
<p>The prompt optimization landscape is:</p>
<ul>
<li><strong>High-dimensional</strong>: Many modules, each with instruction and demonstration choices</li>
<li><strong>Non-convex</strong>: Local optima are common</li>
<li><strong>Noisy</strong>: Validation scores have variance</li>
</ul>
<p>Simulated annealing handles these challenges by:</p>
<ol>
<li>Starting with high temperature (accepting many changes)</li>
<li>Gradually cooling (becoming more selective)</li>
<li>Allowing occasional “uphill” moves to escape local optima</li>
</ol>
<h3 id="implementation"><a class="header" href="#implementation">Implementation</a></h3>
<pre><code class="language-python">import math
import random

class SimulatedAnnealingOptimizer:
    """
    Simulated annealing for prompt configuration search.
    """

    def __init__(
        self,
        init_temperature: float = 1.0,
        cooling_rate: float = 0.95,
        min_temperature: float = 0.01,
        max_iter: int = 100
    ):
        self.init_temperature = init_temperature
        self.cooling_rate = cooling_rate
        self.min_temperature = min_temperature
        self.max_iter = max_iter

    def optimize(
        self,
        initial_config,
        neighbor_fn,
        score_fn,
        valset
    ):
        """
        Find optimal configuration using simulated annealing.

        Args:
            initial_config: Starting configuration
            neighbor_fn: Function to generate neighboring configurations
            score_fn: Function to score a configuration
            valset: Validation set for evaluation

        Returns:
            Best configuration found
        """
        current_config = initial_config
        current_score = score_fn(current_config, valset)

        best_config = current_config
        best_score = current_score

        temperature = self.init_temperature

        for iteration in range(self.max_iter):
            # Generate neighbor configuration
            neighbor = neighbor_fn(current_config)
            neighbor_score = score_fn(neighbor, valset)

            # Calculate acceptance probability
            delta = neighbor_score - current_score

            if delta &gt; 0:
                # Better solution: always accept
                accept_prob = 1.0
            else:
                # Worse solution: accept with probability
                accept_prob = math.exp(delta / temperature)

            # Accept or reject
            if random.random() &lt; accept_prob:
                current_config = neighbor
                current_score = neighbor_score

                # Update best
                if current_score &gt; best_score:
                    best_config = current_config
                    best_score = current_score

            # Cool down
            temperature = max(
                self.min_temperature,
                temperature * self.cooling_rate
            )

            # Optional: Log progress
            if iteration % 10 == 0:
                print(f"Iter {iteration}: Score={current_score:.3f}, "
                      f"Best={best_score:.3f}, T={temperature:.3f}")

        return best_config, best_score
</code></pre>
<h3 id="configuration-neighbor-generation"><a class="header" href="#configuration-neighbor-generation">Configuration Neighbor Generation</a></h3>
<pre><code class="language-python">def generate_neighbor(current_config, instruction_pool, demo_pool):
    """
    Generate a neighboring configuration by making small changes.

    Possible mutations:
    1. Change instruction for one module
    2. Add/remove/swap demonstration for one module
    3. Adjust demonstration count
    """
    neighbor = copy.deepcopy(current_config)

    # Choose mutation type
    mutation_type = random.choice([
        'change_instruction',
        'swap_demo',
        'add_demo',
        'remove_demo'
    ])

    # Choose random module to mutate
    module_idx = random.randint(0, len(neighbor.modules) - 1)

    if mutation_type == 'change_instruction':
        # Select new instruction from pool
        new_instruction = random.choice(instruction_pool[module_idx])
        neighbor.modules[module_idx].instruction = new_instruction

    elif mutation_type == 'swap_demo':
        # Swap one demonstration
        if neighbor.modules[module_idx].demos:
            demo_idx = random.randint(0, len(neighbor.modules[module_idx].demos) - 1)
            new_demo = random.choice(demo_pool[module_idx])
            neighbor.modules[module_idx].demos[demo_idx] = new_demo

    elif mutation_type == 'add_demo':
        # Add a demonstration if under limit
        if len(neighbor.modules[module_idx].demos) &lt; MAX_DEMOS:
            new_demo = random.choice(demo_pool[module_idx])
            neighbor.modules[module_idx].demos.append(new_demo)

    elif mutation_type == 'remove_demo':
        # Remove a demonstration if any exist
        if neighbor.modules[module_idx].demos:
            neighbor.modules[module_idx].demos.pop()

    return neighbor
</code></pre>
<h2 id="multi-stage-pipeline-optimization"><a class="header" href="#multi-stage-pipeline-optimization">Multi-Stage Pipeline Optimization</a></h2>
<p>MIPRO excels at optimizing multi-stage pipelines where modules depend on each other.</p>
<h3 id="module-coupling-considerations"><a class="header" href="#module-coupling-considerations">Module Coupling Considerations</a></h3>
<p>When optimizing pipelines, MIPRO considers how modules interact:</p>
<pre><code class="language-python">class MultiStagePipelineOptimizer:
    """
    Optimizes multi-stage pipelines considering module dependencies.
    """

    def analyze_module_coupling(self, program):
        """
        Analyze how modules in a pipeline are coupled.

        Returns dependency graph and coupling strength estimates.
        """
        modules = program.modules
        coupling = {}

        for i, module in enumerate(modules):
            coupling[i] = {
                'inputs_from': [],
                'outputs_to': [],
                'coupling_strength': 0.0
            }

            # Analyze dataflow
            for j, other in enumerate(modules):
                if i != j:
                    if self._has_dataflow(module, other):
                        coupling[i]['outputs_to'].append(j)
                        coupling[j]['inputs_from'].append(i)

        return coupling

    def optimize_pipeline(self, program, trainset, valset):
        """
        Optimize a multi-stage pipeline.

        Strategy:
        1. Start with later stages (less dependent)
        2. Progressively optimize earlier stages
        3. Use frozen later stages when optimizing earlier ones
        """
        modules = program.modules
        coupling = self.analyze_module_coupling(program)

        # Order modules by dependency depth (later stages first)
        optimization_order = self._topological_sort_reverse(coupling)

        for module_idx in optimization_order:
            print(f"Optimizing module {module_idx}...")

            # Freeze downstream modules
            frozen_modules = [i for i in optimization_order
                           if i != module_idx and
                           module_idx in coupling[i]['inputs_from']]

            # Optimize this module
            self._optimize_module(
                program,
                module_idx,
                trainset,
                valset,
                frozen_modules
            )

        return program
</code></pre>
<h3 id="generate-retrieve-generate-pipeline-example"><a class="header" href="#generate-retrieve-generate-pipeline-example">Generate-Retrieve-Generate Pipeline Example</a></h3>
<pre><code class="language-python">class GRGPipeline(dspy.Module):
    """
    Generate-Retrieve-Generate pipeline for complex QA.

    Stage 1 (Generate): Generate search queries from question
    Stage 2 (Retrieve): Retrieve relevant documents
    Stage 3 (Generate): Generate answer from retrieved context
    """

    def __init__(self):
        super().__init__()
        # Stage 1: Query generation
        self.generate_queries = dspy.Predict(
            "question -&gt; search_queries"
        )

        # Stage 2: Retrieval
        self.retrieve = dspy.Retrieve(k=5)

        # Stage 3: Answer generation
        self.generate_answer = dspy.ChainOfThought(
            "question, context -&gt; answer"
        )

    def forward(self, question):
        # Stage 1
        queries = self.generate_queries(question=question)

        # Stage 2
        all_passages = []
        for query in queries.search_queries.split('\n'):
            passages = self.retrieve(query=query.strip()).passages
            all_passages.extend(passages)

        # Stage 3
        context = '\n\n'.join(all_passages[:10])
        answer = self.generate_answer(
            question=question,
            context=context
        )

        return dspy.Prediction(
            answer=answer.answer,
            reasoning=answer.rationale,
            passages_used=len(all_passages)
        )

# Optimize with MIPRO
def optimize_grg_pipeline(trainset, valset):
    """
    Optimize GRG pipeline using MIPRO.
    """
    pipeline = GRGPipeline()

    def grg_metric(example, pred, trace=None):
        # Check answer correctness
        if hasattr(example, 'answer') and hasattr(pred, 'answer'):
            return example.answer.lower() in pred.answer.lower()
        return 0

    optimizer = MIPRO(
        metric=grg_metric,
        num_candidates=15,  # More candidates for multi-stage
        init_temperature=0.7,
        auto="medium"
    )

    optimized = optimizer.compile(
        pipeline,
        trainset=trainset,
        num_trials=5,
        max_bootstrapped_demos=6  # Per module
    )

    return optimized
</code></pre>
<h3 id="zero-shot-vs-few-shot-trade-offs"><a class="header" href="#zero-shot-vs-few-shot-trade-offs">Zero-Shot vs Few-Shot Trade-offs</a></h3>
<p>MIPRO research reveals important insights about zero-shot vs few-shot optimization:</p>
<pre><code class="language-python">def analyze_zeroshot_vs_fewshot(program, trainset, valset, testset):
    """
    Analyze when zero-shot optimized prompts outperform few-shot.

    Key findings from MIPRO research:
    1. Optimized zero-shot can beat manual few-shot
    2. Context window savings enable more reasoning
    3. Generalization is often better with zero-shot
    """
    results = {}

    # Zero-shot optimization
    mipro_zeroshot = MIPRO(
        metric=metric,
        num_candidates=20,
        init_temperature=0.7
    )
    zeroshot_compiled = mipro_zeroshot.compile(
        program,
        trainset=trainset,
        max_bootstrapped_demos=0  # Zero demonstrations
    )
    results['zeroshot'] = evaluate(zeroshot_compiled, testset)

    # Few-shot optimization
    mipro_fewshot = MIPRO(
        metric=metric,
        num_candidates=20,
        init_temperature=0.7
    )
    fewshot_compiled = mipro_fewshot.compile(
        program,
        trainset=trainset,
        max_bootstrapped_demos=8  # Include demonstrations
    )
    results['fewshot'] = evaluate(fewshot_compiled, testset)

    # Manual few-shot baseline
    bootstrap = BootstrapFewShot(metric=metric, max_bootstrapped_demos=8)
    manual_fewshot = bootstrap.compile(program, trainset=trainset)
    results['manual_fewshot'] = evaluate(manual_fewshot, testset)

    # Analysis
    print("\nZero-Shot vs Few-Shot Analysis:")
    print(f"  MIPRO Zero-Shot: {results['zeroshot']:.1%}")
    print(f"  MIPRO Few-Shot:  {results['fewshot']:.1%}")
    print(f"  Manual Few-Shot: {results['manual_fewshot']:.1%}")

    if results['zeroshot'] &gt; results['manual_fewshot']:
        print("\n  &gt; Optimized zero-shot outperforms manual few-shot!")
        print("  &gt; This indicates strong instruction optimization.")

    return results
</code></pre>
<h2 id="hyperparameter-configuration"><a class="header" href="#hyperparameter-configuration">Hyperparameter Configuration</a></h2>
<h3 id="recommended-settings"><a class="header" href="#recommended-settings">Recommended Settings</a></h3>
<p>Based on MIPRO research, here are recommended hyperparameter configurations:</p>
<pre><code class="language-python"># Standard configuration
optimizer = MIPRO(
    metric=your_metric,
    num_candidates=10,          # 10-20 instruction candidates
    init_temperature=0.7,       # T=0.7 for diverse but quality instructions
    verbose=True
)

# Compile with appropriate settings
compiled = optimizer.compile(
    program,
    trainset=trainset,
    num_trials=3,              # 3-5 optimization trials
    max_bootstrapped_demos=8,  # Up to 8 demos per module
    max_labeled_demos=4,       # Up to 4 labeled demos
)

# Context window management (important for large pipelines)
# Total context budget: 16k tokens typical
# Reserve: ~4k for reasoning
# Remaining: ~12k for instructions + demonstrations
# With 8 demos at ~300 tokens each: 2.4k tokens
# Leaves: ~9.6k for instructions and output
</code></pre>
<h3 id="configuration-table"><a class="header" href="#configuration-table">Configuration Table</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Default</th><th>Range</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>num_candidates</code></td><td>10</td><td>5-30</td><td>Instruction candidates per module</td></tr>
<tr><td><code>init_temperature</code></td><td>1.0</td><td>0.5-1.5</td><td>Meta-prompt sampling temperature</td></tr>
<tr><td><code>num_trials</code></td><td>3</td><td>1-10</td><td>Optimization iterations</td></tr>
<tr><td><code>max_bootstrapped_demos</code></td><td>8</td><td>0-16</td><td>Max demonstrations per module</td></tr>
<tr><td><code>max_labeled_demos</code></td><td>4</td><td>0-8</td><td>Max labeled (gold) demonstrations</td></tr>
<tr><td><code>auto</code></td><td>None</td><td>“light”/“medium”/“heavy”</td><td>Auto-configuration mode</td></tr>
</tbody>
</table>
</div>
<h3 id="auto-mode-configurations"><a class="header" href="#auto-mode-configurations">Auto Mode Configurations</a></h3>
<pre><code class="language-python"># Light mode: Quick optimization for simple tasks
# Equivalent to: num_candidates=5, init_temperature=0.8
optimizer = MIPRO(auto="light")

# Medium mode: Balanced optimization (recommended default)
# Equivalent to: num_candidates=10, init_temperature=1.0
optimizer = MIPRO(auto="medium")

# Heavy mode: Extensive optimization for complex tasks
# Equivalent to: num_candidates=20, init_temperature=1.2
optimizer = MIPRO(auto="heavy")
</code></pre>
<h2 id="performance-benchmarks"><a class="header" href="#performance-benchmarks">Performance Benchmarks</a></h2>
<h3 id="research-results"><a class="header" href="#research-results">Research Results</a></h3>
<p>MIPRO has been extensively benchmarked across diverse tasks:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Dataset</th><th>Task Type</th><th>Manual Prompt</th><th>MIPRO Optimized</th><th>Improvement</th></tr>
</thead>
<tbody>
<tr><td>HotpotQA</td><td>Multi-hop QA</td><td>32.0 F1</td><td>52.3 F1</td><td>+63.4%</td></tr>
<tr><td>GSM8K</td><td>Math Reasoning</td><td>28.5%</td><td>33.8%</td><td>+18.6%</td></tr>
<tr><td>CodeAlpaca</td><td>Code Generation</td><td>63.1%</td><td>64.8%</td><td>+2.7%</td></tr>
<tr><td>FEVER</td><td>Fact Verification</td><td>71.2%</td><td>78.9%</td><td>+10.8%</td></tr>
<tr><td>Natural Questions</td><td>Open-domain QA</td><td>45.3%</td><td>54.7%</td><td>+20.8%</td></tr>
</tbody>
</table>
</div>
<h3 id="reproducing-benchmarks"><a class="header" href="#reproducing-benchmarks">Reproducing Benchmarks</a></h3>
<pre><code class="language-python">def benchmark_mipro_hotpotqa(trainset, valset, testset):
    """
    Reproduce HotpotQA benchmark results.

    Expected: ~52.3 F1 with MIPRO optimization
    """
    # Define multi-hop QA program
    class HotpotQA(dspy.Module):
        def __init__(self):
            super().__init__()
            self.retrieve = dspy.Retrieve(k=5)
            self.hop1 = dspy.ChainOfThought("question, context -&gt; intermediate_answer")
            self.hop2 = dspy.ChainOfThought(
                "question, intermediate_answer, context -&gt; final_answer"
            )

        def forward(self, question):
            # First hop
            context1 = self.retrieve(question=question).passages
            hop1_result = self.hop1(
                question=question,
                context='\n'.join(context1)
            )

            # Second hop (refined query)
            refined_query = f"{question} {hop1_result.intermediate_answer}"
            context2 = self.retrieve(question=refined_query).passages

            final = self.hop2(
                question=question,
                intermediate_answer=hop1_result.intermediate_answer,
                context='\n'.join(context2)
            )

            return dspy.Prediction(
                answer=final.final_answer,
                reasoning=final.rationale
            )

    # F1 metric for evaluation
    def hotpot_f1(example, pred, trace=None):
        from collections import Counter

        pred_tokens = pred.answer.lower().split()
        gold_tokens = example.answer.lower().split()

        common = Counter(pred_tokens) &amp; Counter(gold_tokens)
        num_same = sum(common.values())

        if num_same == 0:
            return 0

        precision = num_same / len(pred_tokens)
        recall = num_same / len(gold_tokens)
        f1 = 2 * precision * recall / (precision + recall)

        return f1

    # MIPRO optimization
    optimizer = MIPRO(
        metric=hotpot_f1,
        num_candidates=15,
        init_temperature=0.7,
        auto="medium"
    )

    optimized = optimizer.compile(
        HotpotQA(),
        trainset=trainset,
        num_trials=5,
        max_bootstrapped_demos=6
    )

    # Evaluate
    from dspy.evaluate import Evaluate
    evaluator = Evaluate(devset=testset, metric=hotpot_f1)
    score = evaluator(optimized)

    print(f"HotpotQA F1 Score: {score:.1f}")
    return optimized, score
</code></pre>
<h2 id="what-makes-mipro-special"><a class="header" href="#what-makes-mipro-special">What Makes MIPRO Special?</a></h2>
<h3 id="dual-optimization"><a class="header" href="#dual-optimization">Dual Optimization</a></h3>
<ol>
<li><strong>Instruction Optimization</strong>: Rewrites and refines natural language instructions using meta-prompting</li>
<li><strong>Demonstration Optimization</strong>: Selects and generates optimal examples using utility-based scoring</li>
<li><strong>Joint Optimization</strong>: Optimizes instructions and examples together using simulated annealing</li>
</ol>
<h3 id="multi-step-process"><a class="header" href="#multi-step-process">Multi-Step Process</a></h3>
<p>MIPRO uses an iterative approach to progressively improve your program:</p>
<ol>
<li>Generate diverse instruction candidates via meta-prompting</li>
<li>Bootstrap and score potential demonstrations</li>
<li>Use simulated annealing to search configuration space</li>
<li>Evaluate candidates on validation set</li>
<li>Select best configuration based on metric performance</li>
</ol>
<h2 id="basic-mipro-usage"><a class="header" href="#basic-mipro-usage">Basic MIPRO Usage</a></h2>
<h3 id="simple-example"><a class="header" href="#simple-example">Simple Example</a></h3>
<pre><code class="language-python">import dspy
from dspy.teleprompter import MIPRO

# 1. Define your program
class AdvancedQA(dspy.Module):
    def __init__(self):
        super().__init__()
        self.generate = dspy.ChainOfThought("question -&gt; answer")

    def forward(self, question):
        return self.generate(question=question)

# 2. Define evaluation metric
def answer_em(example, pred, trace=None):
    return example.answer.lower() == pred.answer.lower()

# 3. Prepare data
trainset = [
    dspy.Example(question="What causes rain?", answer="Condensation of water vapor"),
    dspy.Example(question="Why is the sky blue?", answer="Rayleigh scattering of light"),
    # ... more examples
]

# 4. Create MIPRO optimizer
optimizer = MIPRO(
    metric=answer_em,
    num_candidates=10,      # Generate 10 candidate instructions
    init_temperature=1.0     # Start with high creativity
)

# 5. Compile the program
compiled_qa = optimizer.compile(
    AdvancedQA(),
    trainset=trainset,
    num_trials=3,          # Run optimization 3 times
    max_bootstrapped_demos=8
)

# 6. Use the optimized program
result = compiled_qa(question="How do airplanes fly?")
print(result.answer)
</code></pre>
<h2 id="advanced-configuration"><a class="header" href="#advanced-configuration">Advanced Configuration</a></h2>
<h3 id="customizing-mipro-parameters"><a class="header" href="#customizing-mipro-parameters">Customizing MIPRO Parameters</a></h3>
<pre><code class="language-python">optimizer = MIPRO(
    metric=your_metric,
    num_candidates=20,          # More instruction candidates
    init_temperature=1.2,       # Higher initial creativity
    verbose=True,               # Show optimization progress
    auto="medium",             # Auto mode: "light", "medium", "heavy"
    adapt_temperature=True,    # Adapt temperature during optimization
    logic_history=True         # Track optimization history
)
</code></pre>
<h3 id="multi-objective-optimization"><a class="header" href="#multi-objective-optimization">Multi-Objective Optimization</a></h3>
<pre><code class="language-python">def multi_metric(example, pred, trace=None):
    """Combines multiple metrics."""
    accuracy = exact_match(example, pred)
    efficiency = length_penalty(pred)
    coherence = coherence_score(pred)

    # Weighted combination
    return 0.5 * accuracy + 0.3 * efficiency + 0.2 * coherence

optimizer = MIPRO(metric=multi_metric, num_candidates=15)
</code></pre>
<h2 id="mipro-optimization-strategies"><a class="header" href="#mipro-optimization-strategies">MIPRO Optimization Strategies</a></h2>
<h3 id="1-instruction-evolution"><a class="header" href="#1-instruction-evolution">1. Instruction Evolution</a></h3>
<p>MIPRO evolves instructions through multiple generations:</p>
<pre><code class="language-python"># Generation 0: Original instruction
original_inst = "Answer the question based on your knowledge."

# Generation 1: MIPRO variations
gen1_variations = [
    "Carefully analyze the question and provide a precise answer.",
    "Think step by step before giving your final answer.",
    "Consider the context and nuances of the question.",
    # ... more variations
]

# Generation 2: Refined instructions
gen2_variations = [
    "Analyze the question step-by-step, consider all relevant information, and provide a precise, accurate answer.",
    "Break down the question into components, reason about each, then synthesize a comprehensive answer.",
    # ... even better instructions
]
</code></pre>
<h3 id="2-demonstration-synthesis"><a class="header" href="#2-demonstration-synthesis">2. Demonstration Synthesis</a></h3>
<p>MIPRO can create synthetic demonstrations:</p>
<pre><code class="language-python">class SyntheticExampleGenerator:
    def __init__(self, lm):
        self.lm = lm

    def generate_example(self, instruction, topic):
        """Generate a new example based on instruction."""
        prompt = f"""
        Instruction: {instruction}

        Generate a high-quality example for this instruction about: {topic}

        Example:
        """
        return self.lm.generate(prompt)

# MIPRO uses this internally to create diverse examples
</code></pre>
<h3 id="3-joint-optimization"><a class="header" href="#3-joint-optimization">3. Joint Optimization</a></h3>
<pre><code class="language-python"># MIPRO evaluates instruction-example pairs together
def evaluate_pair(instruction, examples, test_set):
    """Evaluate how well instruction and examples work together."""
    temp_program = dspy.Predict(instruction)
    temp_program.demos = examples

    score = 0
    for test_example in test_set:
        pred = temp_program(**test_example.inputs())
        score += evaluate_metric(test_example, pred)

    return score / len(test_set)
</code></pre>
<h2 id="using-mipro-with-complex-programs"><a class="header" href="#using-mipro-with-complex-programs">Using MIPRO with Complex Programs</a></h2>
<h3 id="multi-module-programs"><a class="header" href="#multi-module-programs">Multi-Module Programs</a></h3>
<pre><code class="language-python">class RAGSystem(dspy.Module):
    def __init__(self, num_passages=3):
        super().__init__()
        self.retrieve = dspy.Retrieve(k=num_passages)
        self.generate = dspy.ChainOfThought("context, question -&gt; answer")

    def forward(self, question):
        context = self.retrieve(question).passages
        return self.generate(context=context, question=question)

# MIPRO optimizes both modules
optimizer = MIPRO(metric=answer_em, num_candidates=15)
optimized_rag = optimizer.compile(
    RAGSystem(),
    trainset=trainset,
    max_bootstrapped_demos=5
)
</code></pre>
<h3 id="custom-module-optimization"><a class="header" href="#custom-module-optimization">Custom Module Optimization</a></h3>
<pre><code class="language-python">class CustomAnalyzer(dspy.Module):
    def __init__(self):
        super().__init__()
        self.extractor = dspy.Predict("text -&gt; entities, sentiment")
        self.summarizer = dspy.Predict("text, entities, sentiment -&gt; summary")

    def forward(self, text):
        extracted = self.extractor(text=text)
        return self.summarizer(
            text=text,
            entities=extracted.entities,
            sentiment=extracted.sentiment
        )

# MIPRO with custom evaluation
def analyzer_metric(example, pred, trace=None):
    entity_f1 = calculate_f1(example.entities, pred.entities)
    sentiment_match = example.sentiment == pred.sentiment
    summary_rouge = rouge_score(example.summary, pred.summary)

    return 0.4 * entity_f1 + 0.3 * sentiment_match + 0.3 * summary_rouge

optimizer = MIPRO(metric=analyzer_metric, num_candidates=12)
analyzer = optimizer.compile(CustomAnalyzer(), trainset=trainset)
</code></pre>
<h2 id="mipro-parameters-reference"><a class="header" href="#mipro-parameters-reference">MIPRO Parameters Reference</a></h2>
<h3 id="core-parameters"><a class="header" href="#core-parameters">Core Parameters</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Type</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>metric</code></td><td>Callable</td><td>Required</td><td>Evaluation function</td></tr>
<tr><td><code>num_candidates</code></td><td>int</td><td>10</td><td>Number of instruction candidates</td></tr>
<tr><td><code>init_temperature</code></td><td>float</td><td>1.0</td><td>Initial creativity temperature</td></tr>
<tr><td><code>verbose</code></td><td>bool</td><td>False</td><td>Show optimization details</td></tr>
<tr><td><code>auto</code></td><td>str</td><td>None</td><td>Auto mode: “light”, “medium”, “heavy”</td></tr>
</tbody>
</table>
</div>
<h3 id="advanced-parameters"><a class="header" href="#advanced-parameters">Advanced Parameters</a></h3>
<pre><code class="language-python">optimizer = MIPRO(
    metric=complex_metric,
    num_candidates=20,
    init_temperature=1.2,
    verbose=True,
    auto="heavy",
    adapt_temperature=True,
    logic_history=True,
    breadth=10,               # Search breadth
    depth=3,                  # Search depth
    max_labeled_demos=4,      # Max labeled examples
    max_bootstrapped_demos=8, # Max generated examples
    temperature_range=(0.7, 1.3),  # Temperature bounds
    instruction_penalty=0.1,  # Penalize long instructions
    example_diversity=0.2     # Encourage diverse examples
)
</code></pre>
<h2 id="mipro-auto-modes"><a class="header" href="#mipro-auto-modes">MIPRO Auto Modes</a></h2>
<h3 id="light-mode"><a class="header" href="#light-mode">Light Mode</a></h3>
<pre><code class="language-python"># Quick optimization for simple tasks
optimizer = MIPRO(auto="light")
# Equivalent to:
optimizer = MIPRO(num_candidates=5, init_temperature=0.8)
</code></pre>
<h3 id="medium-mode"><a class="header" href="#medium-mode">Medium Mode</a></h3>
<pre><code class="language-python"># Balanced optimization
optimizer = MIPRO(auto="medium")
# Equivalent to:
optimizer = MIPRO(num_candidates=10, init_temperature=1.0)
</code></pre>
<h3 id="heavy-mode"><a class="header" href="#heavy-mode">Heavy Mode</a></h3>
<pre><code class="language-python"># Extensive optimization for complex tasks
optimizer = MIPRO(auto="heavy")
# Equivalent to:
optimizer = MIPRO(num_candidates=20, init_temperature=1.2)
</code></pre>
<h2 id="monitoring-mipro-optimization"><a class="header" href="#monitoring-mipro-optimization">Monitoring MIPRO Optimization</a></h2>
<h3 id="progress-tracking"><a class="header" href="#progress-tracking">Progress Tracking</a></h3>
<pre><code class="language-python">import logging

# Enable detailed logging
logging.basicConfig(level=logging.INFO)

# MIPRO will log:
# - Generation 1 instructions
# - Performance scores
# - Best candidates
# - Convergence information

optimizer = MIPRO(metric=your_metric, verbose=True)
</code></pre>
<h3 id="custom-callbacks"><a class="header" href="#custom-callbacks">Custom Callbacks</a></h3>
<pre><code class="language-python">class MIPROTracker:
    def __init__(self):
        self.generation = 0
        self.best_score = 0
        self.history = []

    def __call__(self, program, metrics, traces):
        self.generation += 1
        current_score = metrics['score']

        if current_score &gt; self.best_score:
            self.best_score = current_score

        self.history.append({
            'generation': self.generation,
            'score': current_score,
            'best': self.best_score
        })

        print(f"Gen {self.generation}: Score={current_score:.3f}, Best={self.best_score:.3f}")

tracker = MIPROTracker()
optimizer = MIPRO(metric=your_metric, callbacks=[tracker])
</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-start-with-good-instructions"><a class="header" href="#1-start-with-good-instructions">1. Start with Good Instructions</a></h3>
<pre><code class="language-python"># Bad: Too vague
vague_instruction = "Answer the question."

# Good: Specific and clear
good_instruction = """
Analyze the question carefully, break it down into key components,
provide a comprehensive answer that addresses all aspects of the question.
"""

# Even better: Include examples of desired behavior
best_instruction = """
When answering questions:
1. Identify the core question being asked
2. Consider relevant context and background information
3. Provide a clear, direct answer
4. Include supporting details or explanations when helpful
5. Ensure the answer is accurate and complete
"""
</code></pre>
<h3 id="2-use-appropriate-temperature"><a class="header" href="#2-use-appropriate-temperature">2. Use Appropriate Temperature</a></h3>
<pre><code class="language-python"># For well-defined tasks with clear answers
optimizer = MIPRO(init_temperature=0.7, num_candidates=8)

# For creative or open-ended tasks
optimizer = MIPRO(init_temperature=1.3, num_candidates=15)

# For mixed tasks (most common case)
optimizer = MIPRO(init_temperature=1.0, num_candidates=10)
</code></pre>
<h3 id="3-provide-diverse-training-data"><a class="header" href="#3-provide-diverse-training-data">3. Provide Diverse Training Data</a></h3>
<pre><code class="language-python"># Ensure coverage of different question types
diverse_trainset = []

# Factual questions
diverse_trainset.extend(factual_questions)

# Reasoning questions
diverse_trainset.extend(reasoning_questions)

# Opinion questions
diverse_trainset.extend(opinion_questions)

# Domain-specific questions
diverse_trainset.extend(domain_questions)
</code></pre>
<h3 id="4-evaluate-progressively"><a class="header" href="#4-evaluate-progressively">4. Evaluate Progressively</a></h3>
<pre><code class="language-python">def progressive_evaluation(program, optimizer, trainset, valset):
    """Evaluate at different stages of optimization."""
    results = []

    for num_trials in [1, 3, 5, 10]:
        compiled = optimizer.compile(
            program,
            trainset=trainset,
            num_trials=num_trials
        )

        score = evaluate(compiled, valset)
        results.append((num_trials, score))

        print(f"Trials: {num_trials}, Score: {score:.3f}")

    return results
</code></pre>
<h2 id="common-pitfalls-and-solutions"><a class="header" href="#common-pitfalls-and-solutions">Common Pitfalls and Solutions</a></h2>
<h3 id="pitfall-1-over-optimization"><a class="header" href="#pitfall-1-over-optimization">Pitfall 1: Over-optimization</a></h3>
<pre><code class="language-python"># Problem: Too many candidates leading to diminishing returns
optimizer = MIPRO(num_candidates=50)  # May overfit

# Solution: Use reasonable limits and monitor performance
optimizer = MIPRO(num_candidates=15, auto="medium")
</code></pre>
<h3 id="pitfall-2-inadequate-evaluation-metric"><a class="header" href="#pitfall-2-inadequate-evaluation-metric">Pitfall 2: Inadequate Evaluation Metric</a></h3>
<pre><code class="language-python"># Problem: Metric doesn't capture important aspects
def simple_metric(example, pred):
    return example.answer in pred.answer  # Too simple

# Solution: Use comprehensive metrics
def comprehensive_metric(example, pred):
    accuracy = exact_match(example, pred)
    completeness = coverage_score(example, pred)
    clarity = clarity_score(pred)
    return 0.5 * accuracy + 0.3 * completeness + 0.2 * clarity
</code></pre>
<h3 id="pitfall-3-poor-training-data-quality"><a class="header" href="#pitfall-3-poor-training-data-quality">Pitfall 3: Poor Training Data Quality</a></h3>
<pre><code class="language-python"># Problem: Inconsistent or incorrect labels
noisy_data = [
    dspy.Example(question="What is 2+2?", answer="5"),  # Wrong!
    # ... more noisy examples
]

# Solution: Clean and validate data
def clean_data(data):
    cleaned = []
    for example in data:
        if validate_example(example):
            cleaned.append(example)
    return cleaned

clean_trainset = clean_data(raw_data)
</code></pre>
<h2 id="comparing-mipro-with-other-optimizers"><a class="header" href="#comparing-mipro-with-other-optimizers">Comparing MIPRO with Other Optimizers</a></h2>
<pre><code class="language-python">from dspy.teleprompter import BootstrapFewShot, MIPRO

# Compare optimizers on same task
def compare_optimizers(program, trainset, testset):
    optimizers = {
        'Baseline': None,
        'BootstrapFewShot': BootstrapFewShot(metric=exact_match),
        'MIPRO': MIPRO(metric=exact_match, num_candidates=10)
    }

    results = {}

    for name, optimizer in optimizers.items():
        if optimizer:
            compiled = optimizer.compile(program, trainset=trainset)
        else:
            compiled = program  # Baseline

        score = evaluate(compiled, testset)
        results[name] = score

    return results

results = compare_optimizers(my_program, trainset, testset)
print("Optimization Results:")
for name, score in results.items():
    print(f"{name}: {score:.3f}")
</code></pre>
<h2 id="key-takeaways"><a class="header" href="#key-takeaways">Key Takeaways</a></h2>
<ol>
<li>MIPRO optimizes both instructions and examples simultaneously</li>
<li>It uses an evolutionary approach to progressively improve programs</li>
<li>MIPRO achieves superior performance on complex tasks</li>
<li>Proper metric design is crucial for successful optimization</li>
<li>Start with good instructions and diverse training data</li>
<li>Monitor optimization progress to avoid overfitting</li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>In the next section, we’ll explore KNNFewShot, an optimizer that uses similarity-based example selection for efficient optimization.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../05-optimizers/02a-copro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../05-optimizers/04-knnfewshot.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../05-optimizers/02a-copro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../05-optimizers/04-knnfewshot.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>


        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace-2a3cd908.js"></script>
        <script src="../mode-rust-2c9d5c9a.js"></script>
        <script src="../editor-16ca416c.js"></script>
        <script src="../theme-dawn-4493f9c8.js"></script>
        <script src="../theme-tomorrow_night-9dbe62a9.js"></script>

        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
